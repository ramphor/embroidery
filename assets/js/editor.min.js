!function e(t,n,i){function o(s,l){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!l&&a)return a(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return o(n||e)},d,d.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){t.exports=Marionette.Behavior.extend({previewWindow:null,ui:function(){return{buttonPreview:"#embroidery-panel-saver-button-preview",buttonPublish:"#embroidery-panel-saver-button-publish",buttonPublishLabel:"#embroidery-panel-saver-button-publish-label",menuSaveDraft:"#embroidery-panel-saver-menu-save-draft",lastEditedWrapper:".embroidery-last-edited-wrapper"}},events:function(){return{"click @ui.buttonPreview":"onClickButtonPreview","click @ui.buttonPublish":"onClickButtonPublish","click @ui.menuSaveDraft":"onClickMenuSaveDraft"}},initialize:function(){embroidery.saver.on("before:save",this.onBeforeSave.bind(this)).on("after:save",this.onAfterSave.bind(this)).on("after:saveError",this.onAfterSaveError.bind(this)).on("page:status:change",this.onPageStatusChange),embroidery.settings.page.model.on("change",this.onPageSettingsChange.bind(this))},onRender:function(){this.setMenuItems(embroidery.settings.page.model.get("post_status")),this.addTooltip()},onPageSettingsChange:function(e){var t=e.changed;_.isUndefined(t.post_status)||(this.setMenuItems(t.post_status),this.refreshWpPreview(),"page_settings"===embroidery.getPanelView().getCurrentPageName()&&embroidery.getPanelView().getCurrentPageView().render())},onPageStatusChange:function(e){"publish"===e&&embroidery.notifications.showToast({message:embroidery.translate("publish_notification"),buttons:[{name:"view_page",text:embroidery.translate("have_a_look"),callback:function(){open(embroidery.config.post_link)}}]})},onBeforeSave:function(e){NProgress.start(),"autosave"===e.status?this.ui.lastEditedWrapper.addClass("embroidery-state-active"):this.ui.buttonPublish.addClass("embroidery-button-state")},onAfterSave:function(e){NProgress.done(),this.ui.buttonPublish.removeClass("embroidery-button-state"),this.ui.lastEditedWrapper.removeClass("embroidery-state-active"),this.refreshWpPreview(),this.setLastEdited(e)},setLastEdited:function(e){this.ui.lastEditedWrapper.removeClass("embroidery-button-state").find(".embroidery-last-edited").html(e.config.last_edited)},onAfterSaveError:function(){NProgress.done(),this.ui.buttonPublish.removeClass("embroidery-button-state")},onClickButtonPreview:function(){this.previewWindow=open(embroidery.config.wp_preview.url,embroidery.config.wp_preview.target),embroidery.saver.isEditorChanged()&&(embroidery.saver.xhr&&(embroidery.saver.xhr.abort(),embroidery.saver.isSaving=!1),embroidery.saver.doAutoSave())},onClickButtonPublish:function(){switch(embroidery.settings.page.model.get("post_status")){case"publish":case"private":embroidery.saver.update();break;case"draft":embroidery.config.current_user_can_publish?embroidery.saver.publish():embroidery.saver.savePending();break;case"pending":case void 0:embroidery.config.current_user_can_publish?embroidery.saver.publish():embroidery.saver.update()}},onClickMenuSaveDraft:function(){embroidery.saver.saveDraft()},setMenuItems:function(e){var t="publish";switch(e){case"publish":case"private":t="update";break;case"draft":embroidery.config.current_user_can_publish||(t="submit");break;case"pending":case void 0:embroidery.config.current_user_can_publish||(t="update")}this.ui.buttonPublishLabel.html(embroidery.translate(t))},addTooltip:function(){this.$el.find(".tooltip-target").tipsy({gravity:"s",title:function(){return this.getAttribute("data-tooltip")}})},refreshWpPreview:function(){if(this.previewWindow)try{this.previewWindow.location=embroidery.config.wp_preview.url}catch(e){}}})},{}],2:[function(e,t,n){var i=e("embroidery-utils/module");t.exports=i.extend({autoSaveTimer:null,autosaveInterval:1e3*embroidery.config.autosave_interval,isSaving:!1,isChangedDuringSave:!1,__construct:function(){this.setWorkSaver()},startTimer:function(e){clearTimeout(this.autoSaveTimer),e&&(this.autoSaveTimer=window.setTimeout(_.bind(this.doAutoSave,this),this.autosaveInterval))},saveDraft:function(){if(this.isEditorChanged()){switch(embroidery.settings.page.model.get("post_status")){case"publish":case"private":this.doAutoSave();break;default:this.update()}}},doAutoSave:function(){"edit"===embroidery.channels.dataEditMode.request("activeMode")&&this.saveAutoSave()},saveAutoSave:function(e){this.isEditorChanged()&&(e=_.extend({status:"autosave"},e),this.saveEditor(e))},savePending:function(e){e=_.extend({status:"pending"},e),this.saveEditor(e)},discard:function(){var e=this;embroidery.ajax.send("discard_changes",{data:{post_id:embroidery.config.post_id},success:function(){e.setFlagEditorChange(!1),location.href=embroidery.config.exit_to_dashboard_url}})},update:function(e){e=_.extend({status:embroidery.settings.page.model.get("post_status")},e),this.saveEditor(e)},publish:function(e){e=_.extend({status:"publish"},e),this.saveEditor(e)},setFlagEditorChange:function(e){e&&this.isSaving&&(this.isChangedDuringSave=!0),this.startTimer(e),embroidery.channels.editor.reply("status",e).trigger("status:change",e)},isEditorChanged:function(){return!0===embroidery.channels.editor.request("status")},setWorkSaver:function(){var e=this;embroidery.$window.on("beforeunload",function(){if(e.isEditorChanged())return embroidery.translate("before_unload_alert")})},saveEditor:function(e){if(!this.isSaving){e=_.extend({status:"draft",onSuccess:null},e);var t=this,n=embroidery.elements.toJSON({removeDefault:!0}),i=embroidery.settings.page.model.get("post_status"),o=i!==e.status;return t.trigger("before:save",e).trigger("before:save:"+e.status,e),t.isSaving=!0,t.isChangedDuringSave=!1,t.xhr=embroidery.ajax.send("save_builder",{data:{post_id:embroidery.config.post_id,status:e.status,data:JSON.stringify(n)},success:function(r){t.afterAjax(),t.isChangedDuringSave||t.setFlagEditorChange(!1),"autosave"!==e.status&&o&&embroidery.settings.page.model.set("post_status",e.status),r.config&&jQuery.extend(!0,embroidery.config,r.config),embroidery.config.data=n,embroidery.channels.editor.trigger("saved",r),t.trigger("after:save",r).trigger("after:save:"+e.status,r),o&&t.trigger("page:status:change",e.status,i),_.isFunction(e.onSuccess)&&e.onSuccess.call(this,r)},error:function(n){t.afterAjax(),t.trigger("after:saveError",n).trigger("after:saveError:"+e.status,n);var i;n.statusText?(i=embroidery.ajax.createErrorMessage(n),0===n.readyState&&(i+=" "+embroidery.translate("saving_disabled"))):n[0]&&n[0].code&&(i=embroidery.translate("server_error")+" "+n[0].code),embroidery.notifications.showToast({message:i})}}),t.xhr}},afterAjax:function(){this.isSaving=!1,this.xhr=null}})},{"embroidery-utils/module":123}],3:[function(e,t,n){var i=e("embroidery-utils/view-module"),o=e("embroidery-elements/models/base-settings"),r=e("embroidery-editor-utils/controls-css-parser");t.exports=i.extend({controlsCSS:null,model:null,hasChange:!1,changeCallbacks:{},addChangeCallback:function(e,t){this.changeCallbacks[e]=t},bindEvents:function(){embroidery.on("preview:loaded",this.onEmbroideryPreviewLoaded),this.model.on("change",this.onModelChange)},addPanelPage:function(){var e=this.getSettings("name");embroidery.getPanelView().addPage(e+"_settings",{view:embroidery.settings.panelPages[e]||embroidery.settings.panelPages.base,title:this.getSettings("panelPage.title"),options:{model:this.model,name:e}})},updateStylesheet:function(e){e||this.controlsCSS.stylesheet.empty(),this.controlsCSS.addStyleRules(this.model.getStyleControls(),this.model.attributes,this.model.controls,[/{{WRAPPER}}/g],[this.getSettings("cssWrapperSelector")]),this.controlsCSS.addStyleToDocument()},initModel:function(){this.model=new o(this.getSettings("settings"),{controls:this.getSettings("controls")})},initControlsCSSParser:function(){this.controlsCSS=new r({id:this.getSettings("name")})},getDataToSave:function(e){return e},save:function(e){var t=this;if(t.hasChange){var n=this.model.toJSON({removeDefault:!0}),i=this.getDataToSave({data:JSON.stringify(n)});NProgress.start(),embroidery.ajax.send("save_"+this.getSettings("name")+"_settings",{data:i,success:function(){NProgress.done(),t.setSettings("settings",n),t.hasChange=!1,e&&e.apply(t,arguments)},error:function(){alert("An error occurred")}})}},addPanelMenuItem:function(){var e=this.getSettings("panelPage.menu");if(e){var t={icon:e.icon,title:this.getSettings("panelPage.title"),type:"page",pageName:this.getSettings("name")+"_settings"};embroidery.modules.panel.Menu.addItem(t,"settings",e.beforeItem)}},onInit:function(){this.initModel(),this.initControlsCSSParser(),this.addPanelMenuItem(),this.debounceSave=_.debounce(this.save,3e3),i.prototype.onInit.apply(this,arguments)},onModelChange:function(e){var t=this;t.hasChange=!0,this.controlsCSS.stylesheet.empty(),_.each(e.changed,function(e,n){t.changeCallbacks[n]&&t.changeCallbacks[n].call(t,e)}),t.updateStylesheet(!0),t.debounceSave()},onEmbroideryPreviewLoaded:function(){this.updateStylesheet(),this.addPanelPage()}})},{"embroidery-editor-utils/controls-css-parser":103,"embroidery-elements/models/base-settings":61,"embroidery-utils/view-module":124}],4:[function(e,t,n){var i=e("embroidery-views/controls-stack");t.exports=i.extend({id:function(){return"embroidery-panel-"+this.getOption("name")+"-settings"},getTemplate:function(){return"#tmpl-embroidery-panel-"+this.getOption("name")+"-settings"},childViewContainer:function(){return"#embroidery-panel-"+this.getOption("name")+"-settings-controls"},childViewOptions:function(){return{elementSettingsModel:this.model}},initialize:function(){this.collection=new Backbone.Collection(_.values(this.model.controls))}})},{"embroidery-views/controls-stack":119}],5:[function(e,t,n){var i=e("embroidery-editor/components/settings/base/manager");t.exports=i.extend({changeCallbacks:{embroidery_page_title_selector:function(e){var t=e||"h1.entry-title";(embroidery.settings.page.model.controls.hide_title.selectors={})[t]="display: none",embroidery.settings.page.updateStylesheet()}}})},{"embroidery-editor/components/settings/base/manager":3}],6:[function(e,t,n){var i=e("embroidery-editor/components/settings/base/manager");t.exports=i.extend({changeCallbacks:{post_title:function(e){embroideryFrontend.getElements("$document").find(embroidery.config.page_title_selector).text(e)},template:function(){this.save(function(){embroidery.reloadPreview(),embroidery.once("preview:loaded",function(){embroidery.getPanelView().setPage("page_settings")})})}},bindEvents:function(){embroidery.channels.editor.on("embroidery:clearPage",function(){embroidery.clearPage()}),i.prototype.bindEvents.apply(this,arguments)},getDataToSave:function(e){return e.id=embroidery.config.post_id,e}})},{"embroidery-editor/components/settings/base/manager":3}],7:[function(e,t,n){var i=e("embroidery-utils/module");t.exports=i.extend({modules:{base:e("embroidery-editor/components/settings/base/manager"),general:e("embroidery-editor/components/settings/general/manager"),page:e("embroidery-editor/components/settings/page/manager")},panelPages:{base:e("embroidery-editor/components/settings/base/panel")},onInit:function(){this.initSettings()},initSettings:function(){var e=this;_.each(embroidery.config.settings,function(t,n){var i=e.modules[n]||e.modules.base;e[n]=new i(t)})}})},{"embroidery-editor/components/settings/base/manager":3,"embroidery-editor/components/settings/base/panel":4,"embroidery-editor/components/settings/general/manager":5,"embroidery-editor/components/settings/page/manager":6,"embroidery-utils/module":123}],8:[function(e,t,n){var i;i=Marionette.Behavior.extend({ui:{insertButton:".embroidery-template-library-template-insert"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){this.view.model.get("hasPageSettings")?i.showImportDialog(this.view.model):embroidery.templates.importTemplate(this.view.model)}},{dialog:null,showImportDialog:function(e){var t=i.getDialog();t.onConfirm=function(){embroidery.templates.importTemplate(e,{withPageSettings:!0})},t.onCancel=function(){embroidery.templates.importTemplate(e)},t.show()},initDialog:function(){i.dialog=embroidery.dialogsManager.createWidget("confirm",{id:"embroidery-insert-template-settings-dialog",headerMessage:embroidery.translate("import_template_dialog_header"),message:embroidery.translate("import_template_dialog_message")+"<br>"+embroidery.translate("import_template_dialog_message_attention"),strings:{confirm:embroidery.translate("yes"),cancel:embroidery.translate("no")}})},getDialog:function(){return i.dialog||i.initDialog(),i.dialog}}),t.exports=i},{}],9:[function(e,t,n){var i,o=e("embroidery-templates/models/template");i=Backbone.Collection.extend({model:o}),t.exports=i},{"embroidery-templates/models/template":11}],10:[function(e,t,n){var i,o=e("embroidery-templates/views/layout"),r=e("embroidery-templates/collections/templates");i=function(){var e,t,n,i,s,l=this,a={},c={},d={},m={};this.init=function(){!function(){var e={saveDialog:{description:embroidery.translate("save_your_template_description")},ajaxParams:{success:function(e){l.getTemplatesCollection().add(e),l.setTemplatesSource("local")},error:function(e){l.showErrorDialog(e)}}};_.each(["page","section"],function(t){var n=jQuery.extend(!0,{},e,{saveDialog:{title:embroidery.translate("save_your_template",[embroidery.translate(t)])}});l.registerTemplateType(t,n)})}(),embroidery.addBackgroundClickListener("libraryToggleMore",{element:".embroidery-template-library-template-more"})},this.getTemplateTypes=function(e){return e?d[e]:d},this.registerTemplateType=function(e,t){d[e]=t},this.deleteTemplate=function(e,t){var n=l.getDeleteDialog();n.onConfirm=function(){t.onConfirm&&t.onConfirm(),embroidery.ajax.send("delete_template",{data:{source:e.get("source"),template_id:e.get("template_id")},success:function(n){s.remove(e,{silent:!0}),t.onSuccess&&t.onSuccess(n)}})},n.show()},this.importTemplate=function(e,t){t=t||{},i.showLoadingView(),l.requestTemplateContent(e.get("source"),e.get("template_id"),{data:{page_settings:t.withPageSettings},success:function(n){l.closeModal(),embroidery.channels.data.trigger("template:before:insert",e),embroidery.sections.currentView.addChildModel(n.content,c.importOptions||{}),embroidery.channels.data.trigger("template:after:insert",e),t.withPageSettings&&embroidery.settings.page.model.set(n.page_settings)},error:function(e){l.showErrorDialog(e)}})},this.saveTemplate=function(e,t){var n=d[e];_.extend(t,{source:"local",type:e}),n.prepareSavedData&&(t=n.prepareSavedData(t)),t.content=JSON.stringify(t.content);var i={data:t};n.ajaxParams&&_.extend(i,n.ajaxParams),embroidery.ajax.send("save_template",i)},this.requestTemplateContent=function(e,t,n){var i={data:{source:e,edit_mode:!0,display:!0,template_id:t}};return n&&jQuery.extend(!0,i,n),embroidery.ajax.send("get_template_data",i)},this.markAsFavorite=function(e,t){var n={data:{source:e.get("source"),template_id:e.get("template_id"),favorite:t}};return embroidery.ajax.send("mark_template_as_favorite",n)},this.getDeleteDialog=function(){return t||(t=embroidery.dialogsManager.createWidget("confirm",{id:"embroidery-template-library-delete-dialog",headerMessage:embroidery.translate("delete_template"),message:embroidery.translate("delete_template_confirm"),strings:{confirm:embroidery.translate("delete")}})),t},this.getErrorDialog=function(){return n||(n=embroidery.dialogsManager.createWidget("alert",{id:"embroidery-template-library-error-dialog",headerMessage:embroidery.translate("an_error_occurred")})),n},this.getModal=function(){return e||(e=embroidery.dialogsManager.createWidget("lightbox",{id:"embroidery-template-library-modal",closeButton:!1,hide:{onOutsideClick:!1}})),e},this.getLayout=function(){return i},this.getTemplatesCollection=function(){return s},this.getConfig=function(e){return e?a[e]:a},this.requestLibraryData=function(e,t,n){if(!s||t){var i={data:{},success:function(t){s=new r(t.templates),a=t.config,e&&e()}};n&&(i.data.sync=!0),embroidery.ajax.send("get_library_data",i)}else e&&e()},this.startModal=function(e){c=e||{},m={text:{callback:function(e){return e=e.toLowerCase(),this.get("title").toLowerCase().indexOf(e)>=0||_.any(this.get("tags"),function(t){return t.toLowerCase().indexOf(e)>=0})}},favorite:{}},jQuery.each(c.filters,function(e){m[e]?jQuery.extend(m[e],this):m[e]=this}),l.getModal().show(),l.setTemplatesSource("remote",!0),i||(i=new o),i.showLoadingView(),l.requestLibraryData(function(){c.onReady&&c.onReady()})},this.closeModal=function(){l.getModal().hide()},this.getFilter=function(e){return embroidery.channels.templates.request("filter:"+e)},this.setFilter=function(e,t,n){embroidery.channels.templates.reply("filter:"+e,t),n||embroidery.channels.templates.trigger("filter:change")},this.getFilterTerms=function(e){return e?m[e]:m},this.setTemplatesSource=function(e,t){embroidery.channels.templates.stopReplying(),l.setFilter("source",e),t||l.showTemplates()},this.showTemplates=function(){var e=l.getFilter("source"),t=s.filter(function(t){if(e!==t.get("source"))return!1;var n=d[t.get("type")];return!n||!1!==n.showInLibrary});i.showTemplatesView(new r(t))},this.showTemplatesModal=function(){l.startModal({onReady:l.showTemplates})},this.showErrorDialog=function(e){if("object"==typeof e){var t="";_.each(e,function(e){t+="<div>"+e.message+".</div>"}),e=t}else e?e+=".":e="<i>&#60;The error message is empty&#62;</i>";l.getErrorDialog().setMessage(embroidery.translate("templates_request_error")+'<div id="embroidery-template-library-error-info">'+e+"</div>").show()}},t.exports=new i},{"embroidery-templates/collections/templates":9,"embroidery-templates/views/layout":12}],11:[function(e,t,n){var i;i=Backbone.Model.extend({defaults:{template_id:0,title:"",source:"",type:"",author:"",thumbnail:"",url:"",export_link:"",tags:[]}}),t.exports=i},{}],12:[function(e,t,n){var i,o=e("embroidery-templates/views/parts/header"),r=e("embroidery-templates/views/parts/header-parts/logo"),s=e("embroidery-templates/views/parts/header-parts/actions"),l=e("embroidery-templates/views/parts/header-parts/menu"),a=e("embroidery-templates/views/parts/header-parts/preview"),c=e("embroidery-templates/views/parts/header-parts/back"),d=e("embroidery-templates/views/parts/loading"),m=e("embroidery-templates/views/parts/templates"),u=e("embroidery-templates/views/parts/save-template"),h=e("embroidery-templates/views/parts/import"),p=e("embroidery-templates/views/parts/preview");i=Marionette.LayoutView.extend({el:"#embroidery-template-library-modal",regions:{modalContent:".dialog-message",modalHeader:".dialog-widget-header"},initialize:function(){this.getRegion("modalHeader").show(new o)},getHeaderView:function(){return this.getRegion("modalHeader").currentView},getTemplateActionButton:function(e){var t="#tmpl-embroidery-template-library-"+(e.isPro?"get-pro-button":"insert-button");t=embroidery.hooks.applyFilters("embroidery/editor/template-library/template/action-button",t,e);var n=Marionette.TemplateCache.get(t);return Marionette.Renderer.render(n)},showLoadingView:function(){this.modalContent.show(new d)},showTemplatesView:function(e){this.modalContent.show(new m({collection:e}));var t=this.getHeaderView();t.tools.show(new s),t.menuArea.show(new l),t.logoArea.show(new r)},showImportView:function(){this.getHeaderView().menuArea.reset(),this.modalContent.show(new h)},showSaveTemplateView:function(e){this.getHeaderView().menuArea.reset(),this.modalContent.show(new u({model:e}))},showPreviewView:function(e){this.modalContent.show(new p({url:e.get("url")}));var t=this.getHeaderView();t.menuArea.reset(),t.tools.show(new a({model:e})),t.logoArea.show(new c)}}),t.exports=i},{"embroidery-templates/views/parts/header":18,"embroidery-templates/views/parts/header-parts/actions":13,"embroidery-templates/views/parts/header-parts/back":14,"embroidery-templates/views/parts/header-parts/logo":15,"embroidery-templates/views/parts/header-parts/menu":16,"embroidery-templates/views/parts/header-parts/preview":17,"embroidery-templates/views/parts/import":19,"embroidery-templates/views/parts/loading":20,"embroidery-templates/views/parts/preview":21,"embroidery-templates/views/parts/save-template":22,"embroidery-templates/views/parts/templates":24}],13:[function(e,t,n){t.exports=Marionette.ItemView.extend({template:"#tmpl-embroidery-template-library-header-actions",id:"embroidery-template-library-header-actions",ui:{import:"#embroidery-template-library-header-import i",sync:"#embroidery-template-library-header-sync i",save:"#embroidery-template-library-header-save i"},events:{"click @ui.import":"onImportClick","click @ui.sync":"onSyncClick","click @ui.save":"onSaveClick"},onImportClick:function(){embroidery.templates.getLayout().showImportView()},onSyncClick:function(){var e=this;e.ui.sync.addClass("eicon-animation-spin"),embroidery.templates.requestLibraryData(function(){e.ui.sync.removeClass("eicon-animation-spin"),embroidery.templates.showTemplates()},!0,!0)},onSaveClick:function(){embroidery.templates.getLayout().showSaveTemplateView()}})},{}],14:[function(e,t,n){t.exports=Marionette.ItemView.extend({template:"#tmpl-embroidery-template-library-header-back",id:"embroidery-template-library-header-preview-back",events:{click:"onClick"},onClick:function(){embroidery.templates.showTemplates()}})},{}],15:[function(e,t,n){t.exports=Marionette.ItemView.extend({template:"#tmpl-embroidery-template-library-header-logo",id:"embroidery-template-library-header-logo",events:{click:"onClick"},onClick:function(){embroidery.templates.setTemplatesSource("remote")}})},{}],16:[function(e,t,n){t.exports=Marionette.ItemView.extend({options:{activeClass:"embroidery-active"},template:"#tmpl-embroidery-template-library-header-menu",id:"embroidery-template-library-header-menu",ui:{menuItems:".embroidery-template-library-menu-item"},events:{"click @ui.menuItems":"onMenuItemClick"},$activeItem:null,activateMenuItem:function(e){var t=this.getOption("activeClass");this.$activeItem!==e&&(this.$activeItem&&this.$activeItem.removeClass(t),e.addClass(t),this.$activeItem=e)},onRender:function(){var e=embroidery.templates.getFilter("source"),t=this.ui.menuItems.filter('[data-template-source="'+e+'"]');this.activateMenuItem(t)},onMenuItemClick:function(e){var t=e.currentTarget;this.activateMenuItem(jQuery(t)),embroidery.templates.setTemplatesSource(t.dataset.templateSource)}})},{}],17:[function(e,t,n){var i=e("embroidery-templates/behaviors/insert-template");t.exports=Marionette.ItemView.extend({template:"#tmpl-embroidery-template-library-header-preview",id:"embroidery-template-library-header-preview",behaviors:{insertTemplate:{behaviorClass:i}}})},{"embroidery-templates/behaviors/insert-template":8}],18:[function(e,t,n){var i;i=Marionette.LayoutView.extend({id:"embroidery-template-library-header",template:"#tmpl-embroidery-template-library-header",regions:{logoArea:"#embroidery-template-library-header-logo-area",tools:"#embroidery-template-library-header-tools",menuArea:"#embroidery-template-library-header-menu-area"},ui:{closeModal:"#embroidery-template-library-header-close-modal"},events:{"click @ui.closeModal":"onCloseModalClick"},onCloseModalClick:function(){embroidery.templates.closeModal()}}),t.exports=i},{}],19:[function(e,t,n){var i;i=Marionette.ItemView.extend({template:"#tmpl-embroidery-template-library-import",id:"embroidery-template-library-import",ui:{uploadForm:"#embroidery-template-library-import-form",fileInput:"#embroidery-template-library-import-form-input"},events:{"change @ui.fileInput":"onFileInputChange"},droppedFiles:null,submitForm:function(){var e=embroidery.templates.getLayout(),t=new FormData;this.droppedFiles?(t.append("file",this.droppedFiles[0]),this.droppedFiles=null):(t.append("file",this.ui.fileInput[0].files[0]),this.ui.uploadForm[0].reset());var n={data:t,processData:!1,contentType:!1,success:function(e){embroidery.templates.getTemplatesCollection().add(e),embroidery.templates.setTemplatesSource("local")},error:function(t){embroidery.templates.showErrorDialog(t),e.showImportView()}};embroidery.ajax.send("import_template",n),e.showLoadingView()},onRender:function(){this.ui.uploadForm.on({"drag dragstart dragend dragover dragenter dragleave drop":this.onFormActions.bind(this),dragenter:this.onFormDragEnter.bind(this),"dragleave drop":this.onFormDragLeave.bind(this),drop:this.onFormDrop.bind(this)})},onFormActions:function(e){e.preventDefault(),e.stopPropagation()},onFormDragEnter:function(){this.ui.uploadForm.addClass("embroidery-drag-over")},onFormDragLeave:function(e){jQuery(e.relatedTarget).closest(this.ui.uploadForm).length||this.ui.uploadForm.removeClass("embroidery-drag-over")},onFormDrop:function(e){this.droppedFiles=e.originalEvent.dataTransfer.files,this.submitForm()},onFileInputChange:function(){this.submitForm()}}),t.exports=i},{}],20:[function(e,t,n){var i;i=Marionette.ItemView.extend({id:"embroidery-template-library-loading",template:"#tmpl-embroidery-template-library-loading"}),t.exports=i},{}],21:[function(e,t,n){var i;i=Marionette.ItemView.extend({template:"#tmpl-embroidery-template-library-preview",id:"embroidery-template-library-preview",ui:{iframe:"> iframe"},onRender:function(){this.ui.iframe.attr("src",this.getOption("url"))}}),t.exports=i},{}],22:[function(e,t,n){var i;i=Marionette.ItemView.extend({id:"embroidery-template-library-save-template",template:"#tmpl-embroidery-template-library-save-template",ui:{form:"#embroidery-template-library-save-template-form",submitButton:"#embroidery-template-library-save-template-submit"},events:{"submit @ui.form":"onFormSubmit"},getSaveType:function(){return this.model?this.model.get("elType"):"page"},templateHelpers:function(){var e=this.getSaveType();return embroidery.templates.getTemplateTypes(e).saveDialog},onFormSubmit:function(e){e.preventDefault();var t=this.ui.form.embroiderySerializeObject(),n=this.model?this.model.get("elType"):"page",i={removeDefault:!0};t.content=this.model?[this.model.toJSON(i)]:embroidery.elements.toJSON(i),this.ui.submitButton.addClass("embroidery-button-state"),embroidery.templates.saveTemplate(n,t)}}),t.exports=i},{}],23:[function(e,t,n){var i;i=Marionette.ItemView.extend({id:"embroidery-template-library-templates-empty",template:"#tmpl-embroidery-template-library-templates-empty",ui:{title:".embroidery-template-library-blank-title",message:".embroidery-template-library-blank-message"},modesStrings:{empty:{title:embroidery.translate("templates_empty_title"),message:embroidery.translate("templates_empty_message")},noResults:{title:embroidery.translate("templates_no_results_title"),message:embroidery.translate("templates_no_results_message")},noFavorites:{title:embroidery.translate("templates_no_favorites_title"),message:embroidery.translate("templates_no_favorites_message")}},getCurrentMode:function(){return embroidery.templates.getFilter("text")?"noResults":embroidery.templates.getFilter("favorite")?"noFavorites":"empty"},onRender:function(){var e=this.modesStrings[this.getCurrentMode()];this.ui.title.html(e.title),this.ui.message.html(e.message)}}),t.exports=i},{}],24:[function(e,t,n){var i,o=e("embroidery-templates/views/template/local"),r=e("embroidery-templates/views/template/remote");i=Marionette.CompositeView.extend({template:"#tmpl-embroidery-template-library-templates",id:"embroidery-template-library-templates",childViewContainer:"#embroidery-template-library-templates-container",reorderOnSort:!0,emptyView:function(){return new(e("embroidery-templates/views/parts/templates-empty"))},ui:{filterText:"#embroidery-template-library-filter-text",myFavoritesFilter:"#embroidery-template-library-filter-my-favorites",orderInputs:".embroidery-template-library-order-input",orderLabels:".embroidery-template-library-order-label"},events:{"input @ui.filterText":"onFilterTextInput","change @ui.myFavoritesFilter":"onMyFavoritesFilterChange","mousedown @ui.orderLabels":"onOrderLabelsClick"},comparators:{title:function(e){return e.get("title").toLowerCase()},popularityIndex:function(e){var t=e.get("popularityIndex");return t||(t=e.get("date")),-t},trendIndex:function(e){var t=e.get("trendIndex");return t||(t=e.get("date")),-t}},getChildView:function(e){return"remote"===e.get("source")?r:o},initialize:function(){this.listenTo(embroidery.channels.templates,"filter:change",this._renderChildren)},filter:function(e){var t=embroidery.templates.getFilterTerms(),n=!0;return jQuery.each(t,function(t){var i=this.value||embroidery.templates.getFilter(t);if(i){if(this.callback){var o=this.callback.call(e,i);return o||(n=!1),o}var r=i===e.get(t);return r||(n=!1),r}}),n},order:function(e,t){var n=this.comparators[e]||e;t&&(n=this.reverseOrder(n)),this.collection.comparator=n,this.collection.sort()},reverseOrder:function(e){if("function"!=typeof e){var t=e;e=function(e){return e.get(t)}}return function(t,n){var i=e(t),o=e(n);return void 0===i?-1:void 0===o?1:i<o?1:i>o?-1:0}},addSourceData:function(){var e=this.children.isEmpty();this.$el.attr("data-template-source",e?"empty":embroidery.templates.getFilter("source"))},toggleFilterClass:function(){this.$el.toggleClass("embroidery-templates-filter-active",!(!embroidery.templates.getFilter("text")&&!embroidery.templates.getFilter("favorite")))},onRenderCollection:function(){this.addSourceData(),this.toggleFilterClass()},onBeforeRenderEmpty:function(){this.addSourceData()},onFilterTextInput:function(){embroidery.templates.setFilter("text",this.ui.filterText.val())},onMyFavoritesFilterChange:function(){embroidery.templates.setFilter("favorite",this.ui.myFavoritesFilter[0].checked)},onOrderLabelsClick:function(e){var t,n=jQuery(e.currentTarget.control);n[0].checked||(t="asc"!==n.data("default-ordering-direction")),n.toggleClass("embroidery-template-library-order-reverse",t),this.order(n.val(),n.hasClass("embroidery-template-library-order-reverse"))}}),t.exports=i},{"embroidery-templates/views/parts/templates-empty":23,"embroidery-templates/views/template/local":26,"embroidery-templates/views/template/remote":27}],25:[function(e,t,n){var i,o=e("embroidery-templates/behaviors/insert-template");i=Marionette.ItemView.extend({className:function(){var e="embroidery-template-library-template embroidery-template-library-template-"+this.model.get("source");return this.model.get("isPro")&&(e+=" embroidery-template-library-pro-template"),e},ui:function(){return{previewButton:".embroidery-template-library-template-preview"}},events:function(){return{"click @ui.previewButton":"onPreviewButtonClick"}},behaviors:{insertTemplate:{behaviorClass:o}}}),t.exports=i},{"embroidery-templates/behaviors/insert-template":8}],26:[function(e,t,n){var i,o=e("embroidery-templates/views/template/base");i=o.extend({template:"#tmpl-embroidery-template-library-template-local",ui:function(){return _.extend(o.prototype.ui.apply(this,arguments),{deleteButton:".embroidery-template-library-template-delete",morePopup:".embroidery-template-library-template-more",toggleMore:".embroidery-template-library-template-more-toggle",toggleMoreIcon:".embroidery-template-library-template-more-toggle i"})},events:function(){return _.extend(o.prototype.events.apply(this,arguments),{"click @ui.deleteButton":"onDeleteButtonClick","click @ui.toggleMore":"onToggleMoreClick"})},onDeleteButtonClick:function(){var e=this.ui.toggleMoreIcon;embroidery.templates.deleteTemplate(this.model,{onConfirm:function(){e.removeClass("eicon-ellipsis-h").addClass("fa fa-circle-o-notch fa-spin")},onSuccess:function(){embroidery.templates.showTemplates()}})},onToggleMoreClick:function(){this.ui.morePopup.show()},onPreviewButtonClick:function(){open(this.model.get("url"),"_blank")}}),t.exports=i},{"embroidery-templates/views/template/base":25}],27:[function(e,t,n){var i,o=e("embroidery-templates/views/template/base");i=o.extend({template:"#tmpl-embroidery-template-library-template-remote",ui:function(){return jQuery.extend(o.prototype.ui.apply(this,arguments),{favoriteCheckbox:".embroidery-template-library-template-favorite-input"})},events:function(){return jQuery.extend(o.prototype.events.apply(this,arguments),{"change @ui.favoriteCheckbox":"onFavoriteCheckboxChange"})},onPreviewButtonClick:function(){embroidery.templates.getLayout().showPreviewView(this.model)},onFavoriteCheckboxChange:function(){var e=this.ui.favoriteCheckbox[0].checked;this.model.set("favorite",e),embroidery.templates.markAsFavorite(this.model,e),!e&&embroidery.templates.getFilter("favorite")&&embroidery.channels.templates.trigger("filter:change")}}),t.exports=i},{"embroidery-templates/views/template/base":25}],28:[function(e,t,n){var i;i=e("embroidery-utils/module").extend({errors:[],__construct:function(e){var t=e.customValidationMethod;t&&(this.validationMethod=t)},getDefaultSettings:function(){return{validationTerms:{}}},isValid:function(){var e=this.validationMethod.apply(this,arguments);return!e.length||(this.errors=e,!1)},validationMethod:function(e){var t=[];return this.getSettings("validationTerms").required&&((""+e).length||t.push("Required value is empty")),t}}),t.exports=i},{"embroidery-utils/module":123}],29:[function(e,t,n){var i=e("embroidery-validator/base");t.exports=i.extend({validationMethod:function(e){var t=this.getSettings("validationTerms"),n=[];return _.isFinite(e)&&(void 0!==t.min&&e<t.min&&n.push("Value is less than minimum"),void 0!==t.max&&e>t.max&&n.push("Value is greater than maximum")),n}})},{"embroidery-validator/base":28}],30:[function(e,t,n){var i,o=e("embroidery-controls/base"),r=e("embroidery-validator/base");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return _.extend(e,{input:'input[data-setting][type!="checkbox"][type!="radio"]',checkbox:'input[data-setting][type="checkbox"]',radio:'input[data-setting][type="radio"]',select:"select[data-setting]",textarea:"textarea[data-setting]",responsiveSwitchers:".embroidery-responsive-switcher"}),e},templateHelpers:function(){var e=o.prototype.templateHelpers.apply(this,arguments);return e.data.controlValue=this.getControlValue(),e},events:function(){return{"input @ui.input":"onBaseInputChange","change @ui.checkbox":"onBaseInputChange","change @ui.radio":"onBaseInputChange","input @ui.textarea":"onBaseInputChange","change @ui.select":"onBaseInputChange","click @ui.responsiveSwitchers":"onSwitcherClick"}},initialize:function(e){o.prototype.initialize.apply(this,arguments),this.registerValidators(),this.listenTo(this.elementSettingsModel,"change:external:"+this.model.get("name"),this.onSettingsExternalChange)},getControlValue:function(){return this.elementSettingsModel.get(this.model.get("name"))},setValue:function(e){this.setSettingsModel(e)},setSettingsModel:function(e){this.elementSettingsModel.set(this.model.get("name"),e),this.triggerMethod("settings:change")},applySavedValue:function(){this.setInputValue('[data-setting="'+this.model.get("name")+'"]',this.getControlValue())},getEditSettings:function(e){var t=this.getOption("elementEditSettings").toJSON();return e?t[e]:t},setEditSetting:function(e,t){this.getOption("elementEditSettings").set(e,t)},getInputValue:function(e){var t=this.$(e),n=t.val(),i=t.attr("type");return-1!==["radio","checkbox"].indexOf(i)?t.prop("checked")?n:"":"number"===i&&_.isFinite(n)?+n:("SELECT"===e.tagName&&t.prop("multiple")&&null===n&&(n=[]),n)},setInputValue:function(e,t){var n=this.$(e),i=n.attr("type");"checkbox"===i?n.prop("checked",!!t):"radio"===i?n.filter('[value="'+t+'"]').prop("checked",!0):n.val(t)},addValidator:function(e){this.validators.push(e)},registerValidators:function(){this.validators=[];var e={};this.model.get("required")&&(e.required=!0),jQuery.isEmptyObject(e)||this.addValidator(new r({validationTerms:e}))},onSettingsError:function(){this.$el.addClass("embroidery-error")},onSettingsChange:function(){this.$el.removeClass("embroidery-error")},onRender:function(){o.prototype.onRender.apply(this,arguments),this.applySavedValue(),this.renderResponsiveSwitchers(),this.triggerMethod("ready"),this.toggleControlVisibility(),this.addTooltip()},onBaseInputChange:function(e){clearTimeout(this.correctionTimeout);var t=e.currentTarget,n=this.getInputValue(t),i=this.validators.slice(0),o=this.elementSettingsModel.validators[this.model.get("name")];if(o&&(i=i.concat(o)),i){var r=this.getControlValue(t.dataset.setting);if(!i.every(function(e){return e.isValid(n,r)}))return void(this.correctionTimeout=setTimeout(this.setInputValue.bind(this,t,r),1200))}this.updateElementModel(n,t),this.triggerMethod("input:change",e)},onSwitcherClick:function(e){var t=jQuery(e.currentTarget).data("device");embroidery.changeDeviceMode(t),this.triggerMethod("responsive:switcher:click",t)},onSettingsExternalChange:function(){this.applySavedValue(),this.triggerMethod("after:external:change")},renderResponsiveSwitchers:function(){if(!_.isEmpty(this.model.get("responsive"))){var e=Marionette.Renderer.render("#tmpl-embroidery-control-responsive-switchers",this.model.attributes);this.ui.controlTitle.after(e)}},onAfterExternalChange:function(){this.hideTooltip(),this.render()},addTooltip:function(){this.$(".tooltip-target").tipsy({gravity:function(){var e=jQuery(this).data("tooltip-pos");return void 0!==e?e:"n"},title:function(){return this.getAttribute("data-tooltip")}})},hideTooltip:function(){jQuery(".tipsy").hide()},updateElementModel:function(e){this.setValue(e)}},{getStyleValue:function(e,t){return t}}),t.exports=i},{"embroidery-controls/base":33,"embroidery-validator/base":28}],31:[function(e,t,n){var i;i=e("embroidery-controls/base-data").extend({applySavedValue:function(){var e=this.getControlValue(),t=this.$("[data-setting]"),n=this;_.each(e,function(e,i){var o=t.filter(function(){return i===this.dataset.setting});n.setInputValue(o,e)})},getControlValue:function(e){var t=this.elementSettingsModel.get(this.model.get("name"));if(!jQuery.isPlainObject(t))return{};if(e){var n=t[e];return void 0===n&&(n=""),n}return embroidery.helpers.cloneObject(t)},setValue:function(e,t){var n=this.getControlValue();"object"==typeof e?_.each(e,function(e,t){n[t]=e}):n[e]=t,this.setSettingsModel(n)},updateElementModel:function(e,t){var n=t.dataset.setting;this.setValue(n,e)}},{getStyleValue:function(e,t){return _.isObject(t)?t[e]:""}}),t.exports=i},{"embroidery-controls/base-data":30}],32:[function(e,t,n){var i;i=e("embroidery-controls/base-multiple").extend({getCurrentRange:function(){return this.getUnitRange(this.getControlValue("unit"))},getUnitRange:function(e){var t=this.model.get("range");return!(!t||!t[e])&&t[e]}}),t.exports=i},{"embroidery-controls/base-multiple":31}],33:[function(e,t,n){var i;i=Marionette.CompositeView.extend({ui:function(){return{controlTitle:".embroidery-control-title"}},behaviors:function(){return embroidery.hooks.applyFilters("controls/base/behaviors",{},this)},getBehavior:function(e){return this._behaviors[Object.keys(this.behaviors()).indexOf(e)]},className:function(){var e="embroidery-control embroidery-control-"+this.model.get("name")+" embroidery-control-type-"+this.model.get("type"),t=this.model.get("classes"),n=this.model.get("responsive");return _.isEmpty(t)||(e+=" "+t),_.isEmpty(n)||(e+=" embroidery-control-responsive-"+n.max),e},templateHelpers:function(){var e={_cid:this.model.cid};return{data:_.extend({},this.model.toJSON(),e)}},getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-embroidery-control-"+this.model.get("type")+"-content")},initialize:function(e){this.elementSettingsModel=e.elementSettingsModel;var t=this.model.get("type"),n=jQuery.extend(!0,{},embroidery.config.controls[t],this.model.attributes);this.model.set(n),this.listenTo(this.elementSettingsModel,"change",this.toggleControlVisibility)},toggleControlVisibility:function(){var e=embroidery.helpers.isActiveControl(this.model,this.elementSettingsModel.attributes);this.$el.toggleClass("embroidery-hidden-control",!e),embroidery.channels.data.trigger("scrollbar:update")},onRender:function(){var e=this.model.get("label_block")?"block":"inline",t=this.model.get("show_label"),n="embroidery-label-"+e;n+=" embroidery-control-separator-"+this.model.get("separator"),t||(n+=" embroidery-control-hidden-label"),this.$el.addClass(n),this.toggleControlVisibility()}}),t.exports=i},{}],34:[function(e,t,n){var i,o=e("embroidery-controls/base-multiple");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.sliders=".embroidery-slider",e.colors=".embroidery-shadow-color-picker",e},events:function(){return _.extend(o.prototype.events.apply(this,arguments),{"slide @ui.sliders":"onSlideChange"})},initSliders:function(){var e=this.getControlValue();this.ui.sliders.each(function(){var t=jQuery(this),n=t.next(".embroidery-slider-input").find("input");t.slider({value:e[this.dataset.input],min:+n.attr("min"),max:+n.attr("max")})})},initColors:function(){var e=this;embroidery.helpers.wpColorPicker(this.ui.colors,{change:function(){var t=jQuery(this),n=t.data("setting");e.setValue(n,t.wpColorPicker("color"))},clear:function(){e.setValue(this.dataset.setting,"")}})},onInputChange:function(e){var t=e.currentTarget.dataset.setting;this.ui.sliders.filter('[data-input="'+t+'"]').slider("value",this.getControlValue(t))},onReady:function(){this.initSliders(),this.initColors()},onSlideChange:function(e,t){var n=e.currentTarget.dataset.input;this.ui.input.filter('[data-setting="'+n+'"]').val(t.value),this.setValue(n,t.value)},onBeforeDestroy:function(){this.ui.colors.each(function(){var e=jQuery(this);e.wpColorPicker("instance")&&e.wpColorPicker("close")}),this.$el.remove()}}),t.exports=i},{"embroidery-controls/base-multiple":31}],35:[function(e,t,n){var i=e("embroidery-controls/base");t.exports=i.extend({ui:function(){var e=i.prototype.ui.apply(this,arguments);return e.button="button",e},events:{"click @ui.button":"onButtonClick"},onButtonClick:function(){var e=this.model.get("event");embroidery.channels.editor.trigger(e,this)}})},{"embroidery-controls/base":33}],36:[function(e,t,n){var i,o=e("embroidery-controls/base-data");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.inputs='[type="radio"]',e},events:function(){return _.extend(o.prototype.events.apply(this,arguments),{"mousedown label":"onMouseDownLabel","click @ui.inputs":"onClickInput","change @ui.inputs":"onBaseInputChange"})},onMouseDownLabel:function(e){var t=this.$(e.currentTarget),n=this.$("#"+t.attr("for"));n.data("checked",n.prop("checked"))},onClickInput:function(e){if(this.model.get("toggle")){var t=this.$(e.currentTarget);t.data("checked")&&t.prop("checked",!1).trigger("change")}},onRender:function(){o.prototype.onRender.apply(this,arguments);var e=this.getControlValue();e&&this.ui.inputs.filter('[value="'+e+'"]').prop("checked",!0)}}),t.exports=i},{"embroidery-controls/base-data":30}],37:[function(e,t,n){var i,o=e("embroidery-controls/base-data");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.editor=".embroidery-code-editor",e},onReady:function(){var e=this;if("undefined"!=typeof ace){var t=ace.require("ace/ext/language_tools");if(e.editor=ace.edit(this.ui.editor[0]),jQuery(e.editor.container).addClass("embroidery-input-style embroidery-code-editor"),e.editor.setOptions({mode:"ace/mode/"+e.model.attributes.language,minLines:10,maxLines:1/0,showGutter:!0,useWorker:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0}),e.editor.getSession().setUseWrapMode(!0),embroidery.panel.$el.on("resize.aceEditor",e.onResize.bind(this)),"css"===e.model.attributes.language){t.addCompleter({getCompletions:function(e,t,n,i,o){var r=[],s=t.getTokenAt(n.row,n.column);0<i.length&&"selector".match(i)&&"constant"===s.type&&(r=[{name:"selector",value:"selector",score:1,meta:"Embroidery"}]),o(null,r)}})}if(e.editor.setValue(e.getControlValue(),-1),e.editor.on("change",function(){e.setValue(e.editor.getValue())}),"html"===e.model.attributes.language){var n=e.editor.getSession();n.on("changeAnnotation",function(){for(var e=n.getAnnotations()||[],t=e.length,i=e.length;i--;)/doctype first\. Expected/.test(e[i].text)&&e.splice(i,1);t>e.length&&n.setAnnotations(e)})}}},onResize:function(){this.editor.resize()},onDestroy:function(){embroidery.panel.$el.off("resize.aceEditor")}}),t.exports=i},{"embroidery-controls/base-data":30}],38:[function(e,t,n){var i;i=e("embroidery-controls/base-data").extend({onReady:function(){var e=this;embroidery.helpers.wpColorPicker(e.ui.input,{change:function(){e.ui.input.val(e.ui.input.wpColorPicker("color")).trigger("input")},clear:function(){e.setValue("")}})},onBeforeDestroy:function(){this.ui.input.wpColorPicker("instance")&&this.ui.input.wpColorPicker("close"),this.$el.remove()}}),t.exports=i},{"embroidery-controls/base-data":30}],39:[function(e,t,n){var i;i=e("embroidery-controls/base-data").extend({onReady:function(){var e=this,t=_.extend({onClose:function(){e.saveValue()},enableTime:!0,minuteIncrement:1},this.model.get("picker_options"));this.ui.input.flatpickr(t)},saveValue:function(){this.setValue(this.ui.input.val())},onBeforeDestroy:function(){this.saveValue(),this.ui.input.flatpickr().destroy()}}),t.exports=i},{"embroidery-controls/base-data":30}],40:[function(e,t,n){var i,o=e("embroidery-controls/base-units");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.controls=".embroidery-control-dimension > input:enabled",e.link="button.embroidery-link-dimensions",e},events:function(){return _.extend(o.prototype.events.apply(this,arguments),{"click @ui.link":"onLinkDimensionsClicked"})},defaultDimensionValue:0,initialize:function(){o.prototype.initialize.apply(this,arguments),this.model.set("allowed_dimensions",this.filterDimensions(this.model.get("allowed_dimensions")))},getPossibleDimensions:function(){return["top","right","bottom","left"]},filterDimensions:function(e){e=e||"all";var t=this.getPossibleDimensions();return"all"===e?t:(_.isArray(e)||("horizontal"===e?e=["right","left"]:"vertical"===e&&(e=["top","bottom"])),e)},onReady:function(){var e=this,t=e.getControlValue();e.isLinkedDimensions()||(e.ui.link.addClass("unlinked"),e.ui.controls.each(function(n,i){var o=t[i.dataset.setting];_.isEmpty(o)&&(o=e.defaultDimensionValue),e.$(i).val(o)})),e.fillEmptyDimensions()},updateDimensionsValue:function(){var e={},t=this.getPossibleDimensions(),n=this.ui.controls,i=this.defaultDimensionValue;t.forEach(function(t){var o=n.filter('[data-setting="'+t+'"]');e[t]=o.length?o.val():i}),this.setValue(e)},fillEmptyDimensions:function(){var e=this.getPossibleDimensions(),t=this.model.get("allowed_dimensions"),n=this.ui.controls,i=this.defaultDimensionValue;this.isLinkedDimensions()||e.forEach(function(e){var o=n.filter('[data-setting="'+e+'"]');-1!==_.indexOf(t,e)&&o.length&&_.isEmpty(o.val())&&o.val(i)})},updateDimensions:function(){this.fillEmptyDimensions(),this.updateDimensionsValue()},resetDimensions:function(){this.ui.controls.val(""),this.updateDimensionsValue()},onInputChange:function(e){var t=e.target.dataset.setting;if("unit"===t&&this.resetDimensions(),_.contains(this.getPossibleDimensions(),t)){if(this.isLinkedDimensions()){var n=this.$(e.target);this.ui.controls.val(n.val())}this.updateDimensions()}},onLinkDimensionsClicked:function(e){e.preventDefault(),e.stopPropagation(),this.ui.link.toggleClass("unlinked"),this.setValue("isLinked",!this.ui.link.hasClass("unlinked")),this.isLinkedDimensions()&&this.ui.controls.val(this.ui.controls.eq(0).val()),this.updateDimensions()},isLinkedDimensions:function(){return this.getControlValue("isLinked")}}),t.exports=i},{"embroidery-controls/base-units":32}],41:[function(e,t,n){var i=e("embroidery-controls/select2");t.exports=i.extend({getSelect2Options:function(){return{dir:embroidery.config.is_rtl?"rtl":"ltr"}},templateHelpers:function(){var e=i.prototype.templateHelpers.apply(this,arguments),t=this.model.get("options");return e.getFontsByGroups=function(e){var n={};return _.each(t,function(t,i){(_.isArray(e)&&_.contains(e,t)||t===e)&&(n[i]=t)}),n},e}})},{"embroidery-controls/select2":52}],42:[function(e,t,n){var i,o=e("embroidery-controls/base-data");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.addImages=".embroidery-control-gallery-add",e.clearGallery=".embroidery-control-gallery-clear",e.galleryThumbnails=".embroidery-control-gallery-thumbnails",e},events:function(){return _.extend(o.prototype.events.apply(this,arguments),{"click @ui.addImages":"onAddImagesClick","click @ui.clearGallery":"onClearGalleryClick","click @ui.galleryThumbnails":"onGalleryThumbnailsClick"})},onReady:function(){var e=this.hasImages();this.$el.toggleClass("embroidery-gallery-has-images",e).toggleClass("embroidery-gallery-empty",!e),this.initRemoveDialog()},hasImages:function(){return!!this.getControlValue().length},openFrame:function(e){this.initFrame(e),this.frame.open()},initFrame:function(e){var t={frame:"post",multiple:!0,state:{create:"gallery",add:"gallery-library",edit:"gallery-edit"}[e],button:{text:embroidery.translate("insert_media")}};this.hasImages()&&(t.selection=this.fetchSelection()),this.frame=wp.media(t),this.frame.on({update:this.select,"menu:render:default":this.menuRender,"content:render:browse":this.gallerySettings},this)},menuRender:function(e){e.unset("insert"),e.unset("featured-image")},gallerySettings:function(e){e.sidebar.on("ready",function(){e.sidebar.unset("gallery")})},fetchSelection:function(){var e=wp.media.query({orderby:"post__in",order:"ASC",type:"image",perPage:-1,post__in:_.pluck(this.getControlValue(),"id")});return new wp.media.model.Selection(e.models,{props:e.props.toJSON(),multiple:!0})},select:function(e){var t=[];e.each(function(e){t.push({id:e.get("id"),url:e.get("url")})}),this.setValue(t),this.render()},onBeforeDestroy:function(){this.frame&&this.frame.off(),this.$el.remove()},resetGallery:function(){this.setValue(""),this.render()},initRemoveDialog:function(){var e;this.getRemoveDialog=function(){return e||(e=embroidery.dialogsManager.createWidget("confirm",{message:embroidery.translate("dialog_confirm_gallery_delete"),headerMessage:embroidery.translate("delete_gallery"),strings:{confirm:embroidery.translate("delete"),cancel:embroidery.translate("cancel")},defaultOption:"confirm",onConfirm:this.resetGallery.bind(this)})),e}},onAddImagesClick:function(){this.openFrame(this.hasImages()?"add":"create")},onClearGalleryClick:function(){this.getRemoveDialog().show()},onGalleryThumbnailsClick:function(){this.openFrame("edit")}}),t.exports=i},{"embroidery-controls/base-data":30}],43:[function(e,t,n){var i,o=e("embroidery-controls/select2");i=o.extend({initialize:function(){o.prototype.initialize.apply(this,arguments),this.filterIcons()},filterIcons:function(){var e=this.model.get("options"),t=this.model.get("include"),n=this.model.get("exclude");if(t){var i={};return _.each(t,function(t){i[t]=e[t]}),void this.model.set("options",i)}n&&_.each(n,function(t){delete e[t]})},iconsList:function(e){return e.id?jQuery('<span><i class="'+e.id+'"></i> '+e.text+"</span>"):e.text},getSelect2Options:function(){return{allowClear:!0,templateResult:this.iconsList.bind(this),templateSelection:this.iconsList.bind(this)}}}),t.exports=i},{"embroidery-controls/select2":52}],44:[function(e,t,n){var i;i=e("embroidery-controls/base-multiple").extend({ui:function(){return{inputWidth:'input[data-setting="width"]',inputHeight:'input[data-setting="height"]',btnApply:"button.embroidery-image-dimensions-apply-button"}},events:function(){return{"click @ui.btnApply":"onApplyClicked"}},onApplyClicked:function(e){e.preventDefault(),this.setValue({width:this.ui.inputWidth.val(),height:this.ui.inputHeight.val()})}}),t.exports=i},{"embroidery-controls/base-multiple":31}],45:[function(e,t,n){var i,o=e("embroidery-controls/base-multiple");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.controlMedia=".embroidery-control-media",e.frameOpeners=".embroidery-control-media-upload-button, .embroidery-control-media-image",e.deleteButton=".embroidery-control-media-delete",e},events:function(){return _.extend(o.prototype.events.apply(this,arguments),{"click @ui.frameOpeners":"openFrame","click @ui.deleteButton":"deleteImage"})},onReady:function(){_.isEmpty(this.getControlValue("url"))&&this.ui.controlMedia.addClass("media-empty")},openFrame:function(){this.frame||this.initFrame(),this.frame.open()},deleteImage:function(){this.setValue({url:"",id:""}),this.render()},initFrame:function(){this.frame=wp.media({button:{text:embroidery.translate("insert_media")},states:[new wp.media.controller.Library({title:embroidery.translate("insert_media"),library:wp.media.query({type:"image"}),multiple:!1,date:!1})]}),this.frame.on("insert select",this.select.bind(this))},select:function(){this.trigger("before:select");var e=this.frame.state().get("selection").first().toJSON();e.url&&(this.setValue({url:e.url,id:e.id}),this.render()),this.trigger("after:select")},onBeforeDestroy:function(){this.$el.remove()}}),t.exports=i},{"embroidery-controls/base-multiple":31}],46:[function(e,t,n){var i,o=e("embroidery-controls/base-data"),r=e("embroidery-validator/number");i=o.extend({registerValidators:function(){o.prototype.registerValidators.apply(this,arguments);var e={},t=this.model;["min","max"].forEach(function(n){var i=t.get(n);_.isFinite(i)&&(e[n]=i)}),jQuery.isEmptyObject(e)||this.addValidator(new r({validationTerms:e}))}}),t.exports=i},{"embroidery-controls/base-data":30,"embroidery-validator/number":29}],47:[function(e,t,n){var i,o=e("embroidery-controls/base-multiple");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.reverseOrderLabel=".embroidery-control-order-label",e},changeLabelTitle:function(){var e=this.getControlValue("reverse_order");this.ui.reverseOrderLabel.attr("title",embroidery.translate(e?"asc":"desc"))},onRender:function(){o.prototype.onRender.apply(this,arguments),this.changeLabelTitle()},onInputChange:function(){this.changeLabelTitle()}}),t.exports=i},{"embroidery-controls/base-multiple":31}],48:[function(e,t,n){var i,o=e("embroidery-controls/choose");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.popoverToggle=".embroidery-control-popover-toggle-toggle",e},events:function(){return _.extend(o.prototype.events.apply(this,arguments),{"click @ui.popoverToggle":"onPopoverToggleClick"})},onPopoverToggleClick:function(){this.$el.next(".embroidery-controls-popover").toggle()}}),t.exports=i},{"embroidery-controls/choose":36}],49:[function(e,t,n){var i,o=e("embroidery-controls/base-data");i=Marionette.CompositeView.extend({template:Marionette.TemplateCache.get("#tmpl-embroidery-repeater-row"),className:"repeater-fields",ui:{duplicateButton:".embroidery-repeater-tool-duplicate",editButton:".embroidery-repeater-tool-edit",removeButton:".embroidery-repeater-tool-remove",itemTitle:".embroidery-repeater-row-item-title"},behaviors:{HandleInnerTabs:{behaviorClass:e("embroidery-behaviors/inner-tabs")}},triggers:{"click @ui.removeButton":"click:remove","click @ui.duplicateButton":"click:duplicate","click @ui.itemTitle":"click:edit"},templateHelpers:function(){return{itemIndex:this.getOption("itemIndex")}},childViewContainer:".embroidery-repeater-row-controls",getChildView:function(e){var t=e.get("type");return embroidery.getControlView(t)},childViewOptions:function(){return{elementSettingsModel:this.model}},checkConditions:function(){var e=this;e.collection.each(function(t){var n=t.get("conditions"),i=t.get("parent_conditions"),o=!0;n&&(o=embroidery.conditions.check(n,e.model.attributes)),i&&(o=embroidery.conditions.check(i,e.getOption("parentModel").attributes));e.children.findByModelCid(t.cid).$el.toggleClass("embroidery-panel-hide",!o)})},updateIndex:function(e){this.itemIndex=e,this.setTitle()},setTitle:function(){var e=this.getOption("titleField"),t="";if(e){var n={};this.children.each(function(e){e instanceof o&&(n[e.model.get("name")]=e.getControlValue())}),t=Marionette.TemplateCache.prototype.compileTemplate(e)(n)}t||(t=embroidery.translate("Item #{0}",[this.getOption("itemIndex")])),this.ui.itemTitle.html(t)},initialize:function(e){this.elementSettingsModel=e.elementSettingsModel,this.itemIndex=0,this.collection=new Backbone.Collection(e.controlFields),this.listenTo(this.model,"change",this.checkConditions),this.listenTo(this.getOption("parentModel"),"change",this.checkConditions),e.titleField&&this.listenTo(this.model,"change",this.setTitle)},onRender:function(){this.setTitle(),this.checkConditions()},onChildviewResponsiveSwitcherClick:function(e,t){"desktop"===t&&embroidery.getPanelView().getCurrentPageView().$el.toggleClass("embroidery-responsive-switchers-open")}}),t.exports=i},{"embroidery-behaviors/inner-tabs":68,"embroidery-controls/base-data":30}],50:[function(e,t,n){var i,o=e("embroidery-controls/base-data"),r=e("embroidery-controls/repeater-row"),s=e("embroidery-elements/models/base-settings");i=o.extend({ui:{btnAddRow:".embroidery-repeater-add",fieldContainer:".embroidery-repeater-fields"},events:function(){return{"click @ui.btnAddRow":"onButtonAddRowClick","sortstart @ui.fieldContainer":"onSortStart","sortupdate @ui.fieldContainer":"onSortUpdate","sortstop @ui.fieldContainer":"onSortStop"}},childView:r,childViewContainer:".embroidery-repeater-fields",templateHelpers:function(){return{data:_.extend({},this.model.toJSON(),{controlValue:[]})}},childViewOptions:function(){return{controlFields:this.model.get("fields"),titleField:this.model.get("title_field"),parentModel:this.elementSettingsModel}},createItemModel:function(e,t,n){return(t=t||{}).controls=n.model.get("fields"),e._id||(e._id=embroidery.helpers.getUniqueID()),new s(e,t)},fillCollection:function(){var e=this.model.get("name");this.collection=this.elementSettingsModel.get(e),this.collection instanceof Backbone.Collection||(this.collection=new Backbone.Collection(this.collection,{model:_.partial(this.createItemModel,_,_,this)}),this.elementSettingsModel.set(e,this.collection,{silent:!0}),this.listenTo(this.collection,"change",this.onRowControlChange),this.listenTo(this.collection,"update",this.onRowUpdate,this))},initialize:function(e){o.prototype.initialize.apply(this,arguments),this.fillCollection(),this.listenTo(this.collection,"change",this.onRowControlChange),this.listenTo(this.collection,"update",this.onRowUpdate,this)},addRow:function(e,t){var n=embroidery.helpers.getUniqueID();return e instanceof Backbone.Model?e.set("_id",n):e._id=n,this.collection.add(e,t)},editRow:function(e){if(this.currentEditableChild){var t=this.currentEditableChild.getChildViewContainer(this.currentEditableChild);t.removeClass("editable"),t.find(".embroidery-wp-editor").each(function(){tinymce.get(this.id).fire("hide")})}this.currentEditableChild!==e?(e.getChildViewContainer(e).addClass("editable"),this.currentEditableChild=e,this.updateActiveRow()):delete this.currentEditableChild},toggleMinRowsClass:function(){this.model.get("prevent_empty")&&this.$el.toggleClass("embroidery-repeater-has-minimum-rows",1>=this.collection.length)},updateActiveRow:function(){var e=0;this.currentEditableChild&&(e=this.currentEditableChild.itemIndex),this.setEditSetting("activeItemIndex",e)},updateChildIndexes:function(){var e=this.collection;this.children.each(function(t){t.updateIndex(e.indexOf(t.model)+1)})},onRender:function(){o.prototype.onRender.apply(this,arguments),this.ui.fieldContainer.sortable({axis:"y",handle:".embroidery-repeater-row-tools"}),this.toggleMinRowsClass()},onSortStart:function(e,t){t.item.data("oldIndex",t.item.index())},onSortStop:function(e,t){var n=this;if(-1!==t.item.index()){var i=n.children.findByIndex(t.item.index()),o=i.children._views;jQuery.each(o,function(){if("wysiwyg"===this.model.get("type"))return i.render(),delete n.currentEditableChild,!1})}},onSortUpdate:function(e,t){var n=t.item.data("oldIndex"),i=this.collection.at(n),o=t.item.index();this.collection.remove(i),this.addRow(i,{at:o})},onAddChild:function(){this.updateChildIndexes(),this.updateActiveRow()},onRemoveChild:function(e){e===this.currentEditableChild&&delete this.currentEditableChild,this.updateChildIndexes(),this.updateActiveRow()},onRowUpdate:function(e,t){var n=this.elementSettingsModel,i=e.clone(),o=this.model.get("name");t.add?i.remove(t.changes.added[0]):i.add(t.changes.removed[0],{at:t.index}),n.changed={},n.changed[o]=e,n._previousAttributes={},n._previousAttributes[o]=i.toJSON(),n.trigger("change",n,n._pending),delete n.changed,delete n._previousAttributes,this.toggleMinRowsClass()},onRowControlChange:function(e){if(Object.keys(e.changed).length){var t=e.collection.toJSON(),n=e.collection.findIndex(e),i=this._parent.model.get("settings"),o=this.model.get("name");t[n]=e._previousAttributes,i.changed={},i.changed[o]=e.collection,i._previousAttributes={},i._previousAttributes[o]=t,i.trigger("change",i),delete i.changed,delete i._previousAttributes}},onButtonAddRowClick:function(){var e={};_.each(this.model.get("fields"),function(t){e[t.name]=t.default});var t=this.addRow(e),n=this.children.findByModel(t);this.editRow(n),this.render()},onChildviewClickRemove:function(e){e.model.destroy(),this.render()},onChildviewClickDuplicate:function(e){var t=this.createItemModel(e.model.toJSON(),{},this);this.addRow(t,{at:e.itemIndex}),this.render()},onChildviewClickEdit:function(e){this.editRow(e)},onAfterExternalChange:function(){this.fillCollection(),o.prototype.onAfterExternalChange.apply(this,arguments)}}),t.exports=i},{"embroidery-controls/base-data":30,"embroidery-controls/repeater-row":49,"embroidery-elements/models/base-settings":61}],51:[function(e,t,n){var i,o=e("embroidery-controls/base");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.heading=".embroidery-panel-heading",e},triggers:{click:"control:section:clicked"}}),t.exports=i},{"embroidery-controls/base":33}],52:[function(e,t,n){var i;i=e("embroidery-controls/base-data").extend({getSelect2Options:function(){return{allowClear:!0,placeholder:this.ui.select.children('option:first[value=""]').text()}},onReady:function(){this.ui.select.select2(this.getSelect2Options())},onBeforeDestroy:function(){this.ui.select.data("select2")&&this.ui.select.select2("destroy"),this.$el.remove()}}),t.exports=i},{"embroidery-controls/base-data":30}],53:[function(e,t,n){var i,o=e("embroidery-controls/base-units");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.slider=".embroidery-slider",e},events:function(){return _.extend(o.prototype.events.apply(this,arguments),{"slide @ui.slider":"onSlideChange"})},initSlider:function(){var e=this.getControlValue("size"),t=this.getCurrentRange();this.ui.input.attr(t).val(e),this.ui.slider.slider(_.extend({},t,{value:e}))},resetSize:function(){this.setValue("size",""),this.initSlider()},onReady:function(){this.initSlider()},onSlideChange:function(e,t){this.setValue("size",t.value),this.ui.input.val(t.value)},onInputChange:function(e){var t=e.currentTarget.dataset.setting;"size"===t?this.ui.slider.slider("value",this.getControlValue("size")):"unit"===t&&this.resetSize()},onBeforeDestroy:function(){this.ui.slider.data("uiSlider")&&this.ui.slider.slider("destroy"),this.$el.remove()}}),t.exports=i},{"embroidery-controls/base-units":32}],54:[function(e,t,n){var i,o=e("embroidery-controls/base-data");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.resetStructure=".embroidery-control-structure-reset",e},events:function(){return _.extend(o.prototype.events.apply(this,arguments),{"click @ui.resetStructure":"onResetStructureClick"})},templateHelpers:function(){var e=o.prototype.templateHelpers.apply(this,arguments);return e.getMorePresets=this.getMorePresets.bind(this),e},getCurrentEditedSection:function(){return embroidery.getPanelView().getCurrentPageView().getOption("editedElementView")},getMorePresets:function(){var e=embroidery.presetsFactory.getParsedStructure(this.getControlValue());return embroidery.presetsFactory.getPresets(e.columnsCount)},onInputChange:function(){this.getCurrentEditedSection().redefineLayout(),this.render()},onResetStructureClick:function(){this.getCurrentEditedSection().resetColumnsCustomSize()}}),t.exports=i},{"embroidery-controls/base-data":30}],55:[function(e,t,n){var i=e("embroidery-controls/base-data");t.exports=i.extend({setInputValue:function(e,t){t=""+t,this.$(e).prop("checked",this.model.get("return_value")===t)}})},{"embroidery-controls/base-data":30}],56:[function(e,t,n){var i;i=e("embroidery-controls/base").extend({triggers:{click:{event:"control:tab:clicked",stopPropagation:!1}}}),t.exports=i},{"embroidery-controls/base":33}],57:[function(e,t,n){var i,o=e("embroidery-controls/base-data");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.form="form",e.loading=".wp-widget-form-loading",e},events:function(){return{"keyup @ui.form :input":"onFormChanged","change @ui.form :input":"onFormChanged"}},onFormChanged:function(){var e="widget-"+this.model.get("id_base"),t=this.ui.form.embroiderySerializeObject()[e].REPLACE_TO_ID;this.setValue(t)},onReady:function(){var e=this;embroidery.ajax.send("editor_get_wp_widget_form",{data:{id:e.model.cid,widget_type:e.model.get("widget"),data:JSON.stringify(e.elementSettingsModel.toJSON())},success:function(t){if(e.ui.form.html(t),wp.textWidgets){e.ui.form.addClass("open");var n=new jQuery.Event("widget-added");wp.textWidgets.handleWidgetAdded(n,e.ui.form),wp.mediaWidgets.handleWidgetAdded(n,e.ui.form),wp.customHtmlWidgets&&wp.customHtmlWidgets.handleWidgetAdded(n,e.ui.form)}embroidery.hooks.doAction("panel/widgets/"+e.model.get("widget")+"/controls/wp_widget/loaded",e)}})}}),t.exports=i},{"embroidery-controls/base-data":30}],58:[function(e,t,n){var i,o=e("embroidery-controls/base-data");i=o.extend({events:function(){return _.extend(o.prototype.events.apply(this,arguments),{"keyup textarea.embroidery-wp-editor":"onBaseInputChange"})},buttons:{addToBasic:{underline:"italic"},addToAdvanced:{},moveToAdvanced:{blockquote:"removeformat",alignleft:"blockquote",aligncenter:"alignleft",alignright:"aligncenter"},moveToBasic:{},removeFromBasic:["unlink","wp_more"],removeFromAdvanced:[]},initialize:function(){o.prototype.initialize.apply(this,arguments);var e=this;if(e.editorID="embroiderywpeditor"+e.cid,_.defer(function(){quicktags({buttons:"strong,em,del,link,img,close",id:e.editorID}),embroidery.config.rich_editing_enabled&&switchEditors.go(e.editorID,"tmce"),delete QTags.instances[0]}),embroidery.config.rich_editing_enabled){var t={id:e.editorID,selector:"#"+e.editorID,setup:function(t){e.saveEditor=e.saveEditor.bind(e,t),t.on("keyup change undo redo SetContent",e.saveEditor)}};tinyMCEPreInit.mceInit[e.editorID]=_.extend(_.clone(tinyMCEPreInit.mceInit.embroiderywpeditor),t),embroidery.config.tinymceHasCustomConfig||e.rearrangeButtons()}else e.$el.addClass("embroidery-rich-editing-disabled")},saveEditor:function(e){e.save(),this.setValue(e.getContent())},attachElContent:function(){var e=embroidery.config.wp_editor.replace(/embroiderywpeditor/g,this.editorID).replace("%%EDITORCONTENT%%",this.getControlValue());return this.$el.html(e),this},moveButtons:function(e,t,n){n||(n=t,t=null),_.each(e,function(e,i){var o=n.indexOf(e);if(t){var r=t.indexOf(i);if(-1===r)throw new ReferenceError("Trying to move non-existing button `"+i+"`");t.splice(r,1)}if(-1===o)throw new ReferenceError("Trying to move button after non-existing button `"+e+"`");n.splice(o+1,0,i)})},rearrangeButtons:function(){var e=tinyMCEPreInit.mceInit[this.editorID],t=e.toolbar1.split(","),n=e.toolbar2.split(",");t=_.difference(t,this.buttons.removeFromBasic),n=_.difference(n,this.buttons.removeFromAdvanced),this.moveButtons(this.buttons.moveToBasic,n,t),this.moveButtons(this.buttons.moveToAdvanced,t,n),this.moveButtons(this.buttons.addToBasic,t),this.moveButtons(this.buttons.addToAdvanced,n),e.toolbar1=t.join(","),e.toolbar2=n.join(",")},onAfterExternalChange:function(){var e=this.getControlValue();tinymce.get(this.editorID).setContent(e),jQuery("#"+this.editorID).val(e)},onBeforeDestroy:function(){delete QTags.instances[this.editorID],embroidery.config.rich_editing_enabled&&(tinymce.EditorManager.execCommand("mceRemoveEditor",!0,this.editorID),delete tinyMCEPreInit.mceInit[this.editorID],delete tinyMCEPreInit.qtInit[this.editorID])}}),t.exports=i},{"embroidery-controls/base-data":30}],59:[function(e,t,n){var i;Marionette.TemplateCache.prototype.compileTemplate=function(e,t){return t={evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g},_.template(e,t)},i=Marionette.Application.extend({helpers:e("embroidery-editor-utils/helpers"),heartbeat:e("embroidery-editor-utils/heartbeat"),imagesManager:e("embroidery-editor-utils/images-manager"),debug:e("embroidery-editor-utils/debug"),schemes:e("embroidery-editor-utils/schemes"),presetsFactory:e("embroidery-editor-utils/presets-factory"),templates:e("embroidery-templates/manager"),ajax:e("embroidery-editor-utils/ajax"),conditions:e("embroidery-editor-utils/conditions"),hotKeys:e("embroidery-utils/hot-keys"),history:e("modules/history/assets/js/module"),channels:{editor:Backbone.Radio.channel("EMBROIDERY:editor"),data:Backbone.Radio.channel("EMBROIDERY:data"),panelElements:Backbone.Radio.channel("EMBROIDERY:panelElements"),dataEditMode:Backbone.Radio.channel("EMBROIDERY:editmode"),deviceMode:Backbone.Radio.channel("EMBROIDERY:deviceMode"),templates:Backbone.Radio.channel("EMBROIDERY:templates")},modules:{element:{Model:e("embroidery-elements/models/element")},ControlsStack:e("embroidery-views/controls-stack"),Module:e("embroidery-utils/module"),RepeaterRowView:e("embroidery-controls/repeater-row"),SettingsModel:e("embroidery-elements/models/base-settings"),WidgetView:e("embroidery-elements/views/widget"),panel:{Menu:e("embroidery-panel/pages/menu/menu")},controls:{Base:e("embroidery-controls/base"),BaseData:e("embroidery-controls/base-data"),BaseMultiple:e("embroidery-controls/base-multiple"),Button:e("embroidery-controls/button"),Color:e("embroidery-controls/color"),Dimensions:e("embroidery-controls/dimensions"),Image_dimensions:e("embroidery-controls/image-dimensions"),Media:e("embroidery-controls/media"),Slider:e("embroidery-controls/slider"),Wysiwyg:e("embroidery-controls/wysiwyg"),Choose:e("embroidery-controls/choose"),Url:e("embroidery-controls/base-multiple"),Font:e("embroidery-controls/font"),Section:e("embroidery-controls/section"),Tab:e("embroidery-controls/tab"),Repeater:e("embroidery-controls/repeater"),Wp_widget:e("embroidery-controls/wp_widget"),Icon:e("embroidery-controls/icon"),Gallery:e("embroidery-controls/gallery"),Select2:e("embroidery-controls/select2"),Date_time:e("embroidery-controls/date-time"),Code:e("embroidery-controls/code"),Box_shadow:e("embroidery-controls/box-shadow"),Text_shadow:e("embroidery-controls/box-shadow"),Structure:e("embroidery-controls/structure"),Animation:e("embroidery-controls/select2"),Hover_animation:e("embroidery-controls/select2"),Order:e("embroidery-controls/order"),Switcher:e("embroidery-controls/switcher"),Number:e("embroidery-controls/number"),Popover_toggle:e("embroidery-controls/popover-toggle")},saver:{footerBehavior:e("./components/saver/behaviors/footer-saver")},templateLibrary:{ElementsCollectionView:e("embroidery-panel/pages/elements/views/elements")}},backgroundClickListeners:{popover:{element:".embroidery-controls-popover",ignore:".embroidery-control-popover-toggle-toggle, .embroidery-control-popover-toggle-toggle-label"}},_defaultDeviceMode:"desktop",addControlView:function(e,t){this.modules.controls[e[0].toUpperCase()+e.slice(1)]=t},checkEnvCompatibility:function(){return this.envData.gecko||this.envData.webkit},getElementData:function(e){var t=e.get("elType");if("widget"===t){var n=e.get("widgetType");return!!this.config.widgets[n]&&this.config.widgets[n]}return!!this.config.elements[t]&&this.config.elements[t]},getElementControls:function(e){var t=this,n=t.getElementData(e);if(!n)return!1;var i=e.get("isInner"),o={};return _.each(n.controls,function(e,n){i&&e.hide_in_inner||!i&&e.hide_in_top||(o[n]=_.extend({},t.config.controls[e.type],e))}),o},getControlView:function(e){var t=e[0].toUpperCase()+e.slice(1),n=this.modules.controls[t];if(!n){var i=-1!==this.config.controls[e].features.indexOf("ui");n=this.modules.controls[i?"Base":"BaseData"]}return n},getPanelView:function(){return this.getRegion("panel").currentView},initEnvData:function(){this.envData=_.pick(tinymce.EditorManager.Env,["desktop","webkit","gecko","ie","opera"])},initComponents:function(){var t=e("embroidery-utils/hooks"),n=e("embroidery-editor/components/settings/settings"),i=e("embroidery-editor/components/saver/manager"),o=e("embroidery-editor-utils/notifications");this.hooks=new t,this.saver=new i,this.settings=new n,this.pageSettings=this.settings.page,this.templates.init(),this.initDialogsManager(),this.notifications=new o,this.ajax.init()},initDialogsManager:function(){this.dialogsManager=new DialogsManager.Instance},initElements:function(){var t=e("embroidery-elements/collections/elements"),n=this.config.data;this.elements&&(n=this.elements.toJSON()),this.elements=new t(n)},initPreview:function(){var e=jQuery;this.$previewWrapper=e("#embroidery-preview"),this.$previewResponsiveWrapper=e("#embroidery-preview-responsive-wrapper");this.$preview||(this.$preview=e("<iframe>",{id:"embroidery-preview-iframe",src:this.config.preview_link+"&"+(new Date).getTime(),allowfullscreen:1}),this.$previewResponsiveWrapper.append(this.$preview)),this.$preview.on("load",this.onPreviewLoaded.bind(this)).one("load",this.checkPageStatus.bind(this))},initFrontend:function(){var e=this.$preview[0].contentWindow;window.embroideryFrontend=e.embroideryFrontend,e.embroidery=this,embroideryFrontend.init(),embroideryFrontend.elementsHandler.initHandlers(),this.trigger("frontend:init")},initClearPageDialog:function(){var e,t=this;t.getClearPageDialog=function(){return e||(e=this.dialogsManager.createWidget("confirm",{id:"embroidery-clear-page-dialog",headerMessage:embroidery.translate("clear_page"),message:embroidery.translate("dialog_confirm_clear_page"),position:{my:"center center",at:"center center"},strings:{confirm:embroidery.translate("delete"),cancel:embroidery.translate("cancel")},onConfirm:function(){t.getRegion("sections").currentView.collection.reset()}}))}},initHotKeys:function(){var e=46,t=68,n=76,i=77,o=80,r=83,s=jQuery,l={},a=this.hotKeys;l[e]={deleteElement:{isWorthHandling:function(e){if(!("editor"===embroidery.getPanelView().getCurrentPageName()))return!1;var t=s(e.target);return!t.is(":input, .embroidery-input")&&!t.closest(".embroidery-inline-editing").length},handle:function(){embroidery.getPanelView().getCurrentPageView().getOption("editedElementView").removeElement()}}},l[t]={duplicateElement:{isWorthHandling:function(e){return a.isControlEvent(e)},handle:function(){var e=embroidery.getPanelView();"editor"===e.getCurrentPageName()&&e.getCurrentPageView().getOption("editedElementView").duplicate()}}},l[n]={showTemplateLibrary:{isWorthHandling:function(e){return a.isControlEvent(e)&&e.shiftKey},handle:function(){embroidery.templates.showTemplatesModal()}}},l[i]={changeDeviceMode:{devices:["desktop","tablet","mobile"],isWorthHandling:function(e){return a.isControlEvent(e)&&e.shiftKey},handle:function(){var e=embroidery.channels.deviceMode.request("currentMode"),t=this.devices.indexOf(e);++t>=this.devices.length&&(t=0),embroidery.changeDeviceMode(this.devices[t])}}},l[o]={changeEditMode:{isWorthHandling:function(e){return a.isControlEvent(e)},handle:function(){embroidery.getPanelView().modeSwitcher.currentView.toggleMode()}}},l[r]={saveEditor:{isWorthHandling:function(e){return a.isControlEvent(e)},handle:function(){embroidery.saver.saveDraft()}}},_.each(l,function(e,t){_.each(e,function(e,n){a.addHotKeyHandler(t,n,e)})}),a.bindListener(this.$window.add(embroideryFrontend.getElements("$window")))},preventClicksInsideEditor:function(){this.$previewContents.on("click",function(e){var t=jQuery(e.target),n=embroidery.channels.dataEditMode.request("activeMode"),i=!!t.closest("#embroidery, .pen-menu").length,o=this.contains(t[0]);if((!i||"edit"!==n)&&o&&(t.closest("a:not(.embroidery-clickable)").length&&e.preventDefault(),!i)){var r=embroidery.getPanelView();"elements"!==r.getCurrentPageName()&&r.setPage("elements")}})},addBackgroundClickArea:function(e){e.addEventListener("click",this.onBackgroundClick.bind(this),!0)},addBackgroundClickListener:function(e,t){this.backgroundClickListeners[e]=t},showFatalErrorDialog:function(e){var t={id:"embroidery-fatal-error-dialog",headerMessage:"",message:"",position:{my:"center center",at:"center center"},strings:{confirm:embroidery.translate("learn_more"),cancel:embroidery.translate("go_back")},onConfirm:null,onCancel:function(){parent.history.go(-1)},hide:{onBackgroundClick:!1,onButtonClick:!1}};e=jQuery.extend(!0,t,e),this.dialogsManager.createWidget("confirm",e).show()},checkPageStatus:function(){embroidery.config.current_revision_id!==embroidery.config.post_id&&this.notifications.showToast({message:this.translate("working_on_draft_notification"),buttons:[{name:"view_revisions",text:embroidery.translate("view_all_revisions"),callback:function(){var e=embroidery.getPanelView();e.setPage("historyPage"),e.getCurrentPageView().activateTab("revisions")}}]})},onStart:function(){this.$window=jQuery(window),NProgress.start(),NProgress.inc(.2),this.config=EmbroideryConfig,Backbone.Radio.DEBUG=!1,Backbone.Radio.tuneIn("EMBROIDERY"),this.initComponents(),this.initEnvData(),this.checkEnvCompatibility()||this.onEnvNotCompatible(),this.channels.dataEditMode.reply("activeMode","edit"),this.listenTo(this.channels.dataEditMode,"switch",this.onEditModeSwitched),this.initClearPageDialog(),this.addBackgroundClickArea(document),this.$window.trigger("embroidery:init"),this.initPreview(),this.logSite()},onPreviewLoaded:function(){NProgress.done();if(this.$preview[0].contentWindow.embroideryFrontend){this.$previewContents=this.$preview.contents();var t=this.$previewContents.find("#embroidery");if(t.length){this.initFrontend(),this.initElements(),this.initHotKeys(),this.heartbeat.init();var n=new Marionette.Region({el:t[0]});this.schemes.init(),this.schemes.printSchemesStyle(),this.preventClicksInsideEditor(),this.addBackgroundClickArea(embroideryFrontend.getElements("$document")[0]);var i=e("embroidery-views/preview"),o=e("embroidery-layouts/panel/panel");this.addRegions({sections:n,panel:"#embroidery-panel"}),this.getRegion("sections").show(new i({collection:this.elements})),this.getRegion("panel").show(new o),this.$previewContents.children().addClass("embroidery-html").children("body").addClass("embroidery-editor-active"),this.setResizablePanel(),this.changeDeviceMode(this._defaultDeviceMode),jQuery("#embroidery-loading, #embroidery-preview-loading").fadeOut(600),_.defer(function(){embroideryFrontend.getElements("window").jQuery.holdReady(!1)}),this.enqueueTypographyFonts(),this.onEditModeSwitched(),this.trigger("preview:loaded")}else this.onPreviewElNotFound()}else this.onPreviewLoadingError()},onEditModeSwitched:function(){var e=this.channels.dataEditMode.request("activeMode");"edit"===e?this.exitPreviewMode():this.enterPreviewMode("preview"===e)},onEnvNotCompatible:function(){this.showFatalErrorDialog({headerMessage:this.translate("device_incompatible_header"),message:this.translate("device_incompatible_message"),strings:{confirm:embroidery.translate("proceed_anyway")},hide:{onButtonClick:!0},onConfirm:function(){this.hide()}})},onPreviewLoadingError:function(){this.showFatalErrorDialog({headerMessage:this.translate("preview_not_loading_header"),message:this.translate("preview_not_loading_message"),onConfirm:function(){open(embroidery.config.help_preview_error_url,"_blank")}})},onPreviewElNotFound:function(){this.showFatalErrorDialog({headerMessage:this.translate("preview_el_not_found_header"),message:this.translate("preview_el_not_found_message"),onConfirm:function(){open(embroidery.config.help_the_content_url,"_blank")}})},onBackgroundClick:function(e){jQuery.each(this.backgroundClickListeners,function(){var t=this.element,n=jQuery(e.target);if(n[0].control&&(n=n.add(n[0].control)),!this.ignore||!n.closest(this.ignore).length){var i=n.closest(t);jQuery(t).not(i).hide()}})},setResizablePanel:function(){var e=this,t=embroidery.config.is_rtl?"right":"left";e.panel.$el.resizable({handles:embroidery.config.is_rtl?"w":"e",minWidth:200,maxWidth:680,start:function(){e.$previewWrapper.addClass("ui-resizable-resizing").css("pointer-events","none")},stop:function(){e.$previewWrapper.removeClass("ui-resizable-resizing").css("pointer-events",""),embroidery.channels.data.trigger("scrollbar:update")},resize:function(n,i){e.$previewWrapper.css(t,i.size.width)}})},enterPreviewMode:function(e){var t=this.$previewContents.find("body");e&&(t=t.add("body")),t.removeClass("embroidery-editor-active").addClass("embroidery-editor-preview"),e&&(this.$previewWrapper.css(embroidery.config.is_rtl?"right":"left",""),this.panel.$el.css("width",""))},exitPreviewMode:function(){this.$previewContents.find("body").add("body").removeClass("embroidery-editor-preview").addClass("embroidery-editor-active")},changeEditMode:function(e){var t=embroidery.channels.dataEditMode,n=t.request("activeMode");t.reply("activeMode",e),e!==n&&t.trigger("switch",e)},reloadPreview:function(){jQuery("#embroidery-preview-loading").show(),this.$preview[0].contentWindow.location.reload(!0)},clearPage:function(){this.getClearPageDialog().show()},changeDeviceMode:function(e){var t=this.channels.deviceMode.request("currentMode");t!==e&&(jQuery("body").removeClass("embroidery-device-"+t).addClass("embroidery-device-"+e),this.channels.deviceMode.reply("previousMode",t).reply("currentMode",e).trigger("change"))},enqueueTypographyFonts:function(){var e=this,t=this.schemes.getScheme("typography");_.each(t.items,function(t){e.helpers.enqueueFont(t.value.font_family)})},translate:function(e,t,n){n||(n=this.config.i18n);var i=n[e];return void 0===i&&(i=e),t&&(i=i.replace(/{(\d+)}/g,function(e,n){return void 0!==t[n]?t[n]:e})),i},compareVersions:function(e,t,n){var i=function(e){return(e+="").replace(/[^\d.]+/,".-1.")};if((e=i(e))===(t=i(t)))return!n||/^={2,3}$/.test(n);for(var o=e.split(".").map(Number),r=t.split(".").map(Number),s=Math.max(o.length,r.length),l=0;l<s;l++){var a=o[l]||0,c=r[l]||0;if(a!==c)return this.conditions.compare(a,c,n)}},logSite:function(){var e="",t="";if(this.envData.gecko){e+="%c"+[" ;;;;;;;;;;;;;;; ",";;;  ;;       ;;;",";;;  ;;;;;;;;;;;;",";;;  ;;;;;;;;;;;;",";;;  ;;       ;;;",";;;  ;;;;;;;;;;;;",";;;  ;;;;;;;;;;;;",";;;  ;;       ;;;"," ;;;;;;;;;;;;;;; "].join("\n")+"\n",t="color: #C42961"}else e+="%c00",t='line-height: 1.6; font-size: 20px; background-image: url("'+embroidery.config.assets_url+'images/logo-icon.png"); color: transparent; background-repeat: no-repeat; background-size: cover';e+="%c\nLove using Embroidery? Join our growing community of Embroidery developers: %chttps://github.com/pojome/embroidery",setTimeout(console.log.bind(console,e,t,"color: #9B0A46",""))}}),t.exports=(window.embroidery=new i).start()},{"./components/saver/behaviors/footer-saver":1,"embroidery-controls/base":33,"embroidery-controls/base-data":30,"embroidery-controls/base-multiple":31,"embroidery-controls/box-shadow":34,"embroidery-controls/button":35,"embroidery-controls/choose":36,"embroidery-controls/code":37,"embroidery-controls/color":38,"embroidery-controls/date-time":39,"embroidery-controls/dimensions":40,"embroidery-controls/font":41,"embroidery-controls/gallery":42,"embroidery-controls/icon":43,"embroidery-controls/image-dimensions":44,"embroidery-controls/media":45,"embroidery-controls/number":46,"embroidery-controls/order":47,"embroidery-controls/popover-toggle":48,"embroidery-controls/repeater":50,"embroidery-controls/repeater-row":49,"embroidery-controls/section":51,"embroidery-controls/select2":52,"embroidery-controls/slider":53,"embroidery-controls/structure":54,"embroidery-controls/switcher":55,"embroidery-controls/tab":56,"embroidery-controls/wp_widget":57,"embroidery-controls/wysiwyg":58,"embroidery-editor-utils/ajax":101,"embroidery-editor-utils/conditions":102,"embroidery-editor-utils/debug":104,"embroidery-editor-utils/heartbeat":105,"embroidery-editor-utils/helpers":106,"embroidery-editor-utils/images-manager":107,"embroidery-editor-utils/notifications":110,"embroidery-editor-utils/presets-factory":111,"embroidery-editor-utils/schemes":112,"embroidery-editor/components/saver/manager":2,"embroidery-editor/components/settings/settings":7,"embroidery-elements/collections/elements":60,"embroidery-elements/models/base-settings":61,"embroidery-elements/models/element":63,"embroidery-elements/views/widget":74,"embroidery-layouts/panel/panel":100,"embroidery-panel/pages/elements/views/elements":86,"embroidery-panel/pages/menu/menu":89,"embroidery-templates/manager":10,"embroidery-utils/hooks":121,"embroidery-utils/hot-keys":122,"embroidery-utils/module":123,"embroidery-views/controls-stack":119,"embroidery-views/preview":120,"modules/history/assets/js/module":132}],60:[function(e,t,n){var i=e("embroidery-elements/models/element"),o=Backbone.Collection.extend({add:function(e,t,n){if(!(t&&t.silent||n))throw"Call Error: Adding model to element collection is allowed only by the dedicated addChildModel() method.";return Backbone.Collection.prototype.add.call(this,e,t)},model:function(e,t){var n=Backbone.Model;return e.elType&&(n=embroidery.hooks.applyFilters("element/model",i,e)),new n(e,t)},clone:function(){var e=Backbone.Collection.prototype.clone.apply(this,arguments),t=new o;return e.forEach(function(e){t.add(e.clone(),null,!0)}),t}});o.prototype.sync=o.prototype.fetch=o.prototype.save=_.noop,t.exports=o},{"embroidery-elements/models/element":63}],61:[function(e,t,n){var i;i=Backbone.Model.extend({options:{},initialize:function(e,t){var n=this;if(t&&(n.options=t),n.controls=t&&t.controls?t.controls:embroidery.getElementControls(n),n.validators={},n.controls){var i=e||{},o={};_.each(n.controls,function(e){var t=embroidery.config.controls[e.type];if(!(-1!==t.features.indexOf("ui"))){var r=jQuery.isPlainObject(t.default_value);o[e.name]=r?_.extend({},t.default_value,e.default||{}):e.default||t.default_value,void 0!==i[e.name]&&r&&!_.isObject(i[e.name])&&(embroidery.debug.addCustomError(new TypeError("An invalid argument supplied as multiple control value"),"InvalidElementData","Element `"+(n.get("widgetType")||n.get("elType"))+"` got <"+i[e.name]+"> as `"+e.name+"` value. Expected array or object."),delete i[e.name]),void 0===i[e.name]&&(i[e.name]=o[e.name])}}),n.defaults=o,n.handleRepeaterData(i),n.set(i)}},handleRepeaterData:function(e){_.each(this.controls,function(t){t.is_repeater&&(e[t.name]instanceof Backbone.Collection||(e[t.name]=new Backbone.Collection(e[t.name],{model:function(e,n){return(n=n||{}).controls=t.fields,e._id||(e._id=embroidery.helpers.getUniqueID()),new i(e,n)}})))})},getFontControls:function(){return _.filter(this.getActiveControls(),function(e){return"font"===e.type})},getStyleControls:function(e){var t=this;return e=e||t.getActiveControls(),_.filter(e,function(n){return n.fields?(n.styleFields=t.getStyleControls(n.fields),!0):t.isStyleControl(n.name,e)})},isStyleControl:function(e,t){t=t||this.controls;var n=_.find(t,function(t){return e===t.name});return n&&!_.isEmpty(n.selectors)},getClassControls:function(e){return e=e||this.controls,_.filter(e,function(e){return!_.isUndefined(e.prefix_class)})},isClassControl:function(e){var t=_.find(this.controls,function(t){return e===t.name});return t&&!_.isUndefined(t.prefix_class)},getControl:function(e){return _.find(this.controls,function(t){return e===t.name})},getActiveControls:function(){var e=this,t={};return _.each(e.controls,function(n,i){embroidery.helpers.isActiveControl(n,e.attributes)&&(t[i]=n)}),t},clone:function(){return new i(embroidery.helpers.cloneObject(this.attributes),embroidery.helpers.cloneObject(this.options))},setExternalChange:function(e,t){this.set(e,t),this.trigger("change:external",e,t).trigger("change:external:"+e,t)},toJSON:function(e){var t=Backbone.Model.prototype.toJSON.call(this);if(e=e||{},delete t.widgetType,delete t.elType,delete t.isInner,_.each(t,function(e,n){e&&e.toJSON&&(t[n]=e.toJSON())}),e.removeDefault){var n=this.controls;_.each(t,function(e,i){var o=n[i];if(o){if(("text"===o.type||"textarea"===o.type)&&t[i])return;if(t[i]&&"object"==typeof t[i]){if(Object.keys(t[i]).length!==Object.keys(o.default).length)return;var r=!0;_.each(t[i],function(e,n){if(t[i][n]!==o.default[n])return r=!1}),r&&delete t[i]}else t[i]===o.default&&delete t[i]}})}return t}}),t.exports=i},{}],62:[function(e,t,n){var i;i=e("embroidery-elements/models/base-settings").extend({defaults:{_column_size:100}}),t.exports=i},{"embroidery-elements/models/base-settings":61}],63:[function(e,t,n){var i,o=e("embroidery-elements/models/base-settings"),r=e("embroidery-elements/models/column-settings");(i=Backbone.Model.extend({defaults:{id:"",elType:"",isInner:!1,settings:{},defaultEditSettings:{}},remoteRender:!1,_htmlCache:null,_jqueryXhr:null,renderOnLeave:!1,initialize:function(t){var n=this.get("elType"),i=this.get("elements");if(void 0!==i){var o=e("embroidery-elements/collections/elements");this.set("elements",new o(i))}"widget"===n&&(this.remoteRender=!0,this.setHtmlCache(t.htmlCache||"")),delete t.htmlCache,this.renderRemoteServer=_.throttle(this.renderRemoteServer,1e3),this.initSettings(),this.initEditSettings(),this.on({destroy:this.onDestroy,"editor:close":this.onCloseEditor})},initSettings:function(){var e=this.get("elType"),t=this.get("settings"),n={column:r}[e]||o;jQuery.isEmptyObject(t)&&(t=embroidery.helpers.cloneObject(t)),"widget"===e&&(t.widgetType=this.get("widgetType")),t.elType=e,t.isInner=this.get("isInner"),t=new n(t),this.set("settings",t),embroideryFrontend.config.elements.data[this.cid]=t},initEditSettings:function(){var e=new Backbone.Model(this.get("defaultEditSettings"));this.set("editSettings",e),embroideryFrontend.config.elements.editSettings[this.cid]=e},onDestroy:function(){var e=this.get("settings"),t=this.get("elements");void 0!==t&&_.each(_.clone(t.models),function(e){e.destroy()}),e instanceof o&&e.destroy()},onCloseEditor:function(){this.initEditSettings(),this.renderOnLeave&&this.renderRemoteServer()},setSetting:function(e,t){var n=e.split("."),i=3===n.length,o=this.get("settings");e=n[0],i&&(o=o.get(e).models[n[1]],e=n[2]),o.setExternalChange(e,t)},getSetting:function(e){var t=e.split("."),n=3===t.length,i=this.get("settings");e=t[0];var o=i.get(e);return void 0===o?"":(n&&(o=o.models[t[1]].get(t[2])),o)},setHtmlCache:function(e){this._htmlCache=e},getHtmlCache:function(){return this._htmlCache},getTitle:function(){var e=embroidery.getElementData(this);return e?e.title:"Unknown"},getIcon:function(){var e=embroidery.getElementData(this);return e?e.icon:"unknown"},createRemoteRenderRequest:function(){var e=this.toJSON();return embroidery.ajax.send("render_widget",{data:{post_id:embroidery.config.post_id,data:JSON.stringify(e),_nonce:embroidery.config.nonce},success:this.onRemoteGetHtml.bind(this)})},renderRemoteServer:function(){this.remoteRender&&(this.renderOnLeave=!1,this.trigger("before:remote:render"),this.isRemoteRequestActive()&&this._jqueryXhr.abort(),this._jqueryXhr=this.createRemoteRenderRequest())},isRemoteRequestActive:function(){return this._jqueryXhr&&4!==this._jqueryXhr.readyState},onRemoteGetHtml:function(e){this.setHtmlCache(e.render),this.trigger("remote:render")},clone:function(){var e=new this.constructor(embroidery.helpers.cloneObject(this.attributes));e.set("id",embroidery.helpers.getUniqueID()),e.setHtmlCache(this.getHtmlCache());var t=this.get("elements");return _.isEmpty(t)||e.set("elements",t.clone()),e},toJSON:function(e){e=_.extend({copyHtmlCache:!1},e);var t=Backbone.Model.prototype.toJSON.call(this);return _.each(t,function(n,i){n&&n.toJSON&&(t[i]=n.toJSON(e))}),e.copyHtmlCache?t.htmlCache=this.getHtmlCache():delete t.htmlCache,t}})).prototype.sync=i.prototype.fetch=i.prototype.save=_.noop,t.exports=i},{"embroidery-elements/collections/elements":60,"embroidery-elements/models/base-settings":61,"embroidery-elements/models/column-settings":62}],64:[function(e,t,n){var i,o=e("embroidery-elements/models/base-settings"),r=e("embroidery-editor-utils/controls-css-parser"),s=e("embroidery-validator/base"),l=e("embroidery-views/base-container");i=l.extend({tagName:"div",controlsCSSParser:null,toggleEditTools:!0,allowRender:!0,renderAttributes:{},className:function(){return"embroidery-element embroidery-element-edit-mode "+this.getElementUniqueID()},attributes:function(){var e=this.model.get("elType");return"widget"===e&&(e=this.model.get("widgetType")),{"data-id":this.getID(),"data-element_type":e}},ui:function(){return{triggerButton:"> .embroidery-element-overlay .embroidery-editor-element-trigger",duplicateButton:"> .embroidery-element-overlay .embroidery-editor-element-duplicate",removeButton:"> .embroidery-element-overlay .embroidery-editor-element-remove",saveButton:"> .embroidery-element-overlay .embroidery-editor-element-save",settingsList:"> .embroidery-element-overlay .embroidery-editor-element-settings",addButton:"> .embroidery-element-overlay .embroidery-editor-element-add"}},behaviors:function(){return embroidery.hooks.applyFilters("elements/base/behaviors",{},this)},getBehavior:function(e){return this._behaviors[Object.keys(this.behaviors()).indexOf(e)]},events:function(){return{"click @ui.removeButton":"onClickRemove","click @ui.saveButton":"onClickSave","click @ui.duplicateButton":"onClickDuplicate","click @ui.triggerButton":"onClickEdit"}},getElementType:function(){return this.model.get("elType")},getIDInt:function(){return parseInt(this.getID(),16)},getChildType:function(){return embroidery.helpers.getElementChildType(this.getElementType())},getChildView:function(t){var n,i=t.get("elType");return n="section"===i?e("embroidery-elements/views/section"):"column"===i?e("embroidery-elements/views/column"):embroidery.modules.WidgetView,embroidery.hooks.applyFilters("element/view",n,t,this)},templateHelpers:function(){var e=l.prototype.templateHelpers.apply(this,arguments);return jQuery.extend(e,{editModel:this.getEditModel()})},getTemplateType:function(){return"js"},getEditModel:function(){return this.model},initialize:function(){this.collection=this.model.get("elements"),this.collection&&this.listenTo(this.collection,"add remove reset",this.onCollectionChanged,this);var e=this.getEditModel();this.listenTo(e.get("settings"),"change",this.onSettingsChanged,this),this.listenTo(e.get("editSettings"),"change",this.onEditSettingsChanged,this),this.initControlsCSSParser()},edit:function(){embroidery.getPanelView().openEditor(this.getEditModel(),this)},addElementFromPanel:function(e){var t=embroidery.channels.panelElements.request("element:selected"),n={id:embroidery.helpers.getUniqueID(),elType:t.model.get("elType")};if("widget"===n.elType)n.widgetType=t.model.get("widgetType");else{if("section"!==n.elType)return;n.elements=[],n.isInner=!0}var i=t.model.get("custom");i&&_.extend(n,i),embroidery.channels.data.trigger("element:before:add",n);var o=this.addChildElement(n,e);"section"===o.getElementType()&&o.isInner()&&o.addEmptyColumn(),embroidery.channels.data.trigger("element:after:add",n)},addControlValidator:function(e,t){t=t.bind(this);var n=new s({customValidationMethod:t}),i=this.getEditModel().get("settings").validators;i[e]||(i[e]=[]),i[e].push(n)},addRenderAttribute:function(e,t,n,i){var o=this;return"object"==typeof e?(jQuery.each(e,function(e){o.addRenderAttribute(e,this,null,i)}),o):"object"==typeof t?(jQuery.each(t,function(t){o.addRenderAttribute(e,t,this,i)}),o):(o.renderAttributes[e]||(o.renderAttributes[e]={}),o.renderAttributes[e][t]||(o.renderAttributes[e][t]=[]),Array.isArray(n)||(n=[n]),void(o.renderAttributes[e][t]=i?n:o.renderAttributes[e][t].concat(n)))},getRenderAttributeString:function(e){if(!this.renderAttributes[e])return"";var t=this.renderAttributes[e],n=[];return jQuery.each(t,function(e){n.push(e+'="'+_.escape(this.join(" "))+'"')}),n.join(" ")},isCollectionFilled:function(){return!1},isInner:function(){return!!this.model.get("isInner")},initControlsCSSParser:function(){this.controlsCSSParser=new r({id:this.model.cid})},enqueueFonts:function(){var e=this.getEditModel(),t=e.get("settings");_.each(t.getFontControls(),function(t){var n=e.getSetting(t.name);_.isEmpty(n)||embroidery.helpers.enqueueFont(n)})},renderStyles:function(e){e||(e=this.getEditModel().get("settings")),this.controlsCSSParser.stylesheet.empty(),this.controlsCSSParser.addStyleRules(e.getStyleControls(),e.attributes,this.getEditModel().get("settings").controls,[/{{ID}}/g,/{{WRAPPER}}/g],[this.getID(),"#embroidery ."+this.getElementUniqueID()]),this.controlsCSSParser.addStyleToDocument();var t=embroidery.hooks.applyFilters("editor/style/styleText","",this);t&&this.controlsCSSParser.elements.$stylesheetElement.append(t)},renderCustomClasses:function(){var e=this,t=e.getEditModel().get("settings"),n=t.getClassControls();_.each(n,function(n){var i=t.previous(n.name);n.classes_dictionary&&void 0!==n.classes_dictionary[i]&&(i=n.classes_dictionary[i]),e.$el.removeClass(n.prefix_class+i)}),_.each(n,function(n){var i=t.attributes[n.name],o=i;n.classes_dictionary&&void 0!==n.classes_dictionary[i]&&(o=n.classes_dictionary[i]);embroidery.helpers.isActiveControl(n,t.attributes)&&!_.isEmpty(o)&&e.$el.addClass(n.prefix_class+o).addClass(_.result(e,"className"))})},renderCustomElementID:function(){var e=this.getEditModel().get("settings").get("_element_id");this.$el.attr("id",e)},getModelForRender:function(){return embroidery.hooks.applyFilters("element/templateHelpers/editModel",this.getEditModel(),this)},renderUIOnly:function(){var e=this.getModelForRender();this.renderStyles(e.get("settings")),this.renderCustomClasses(),this.renderCustomElementID(),this.enqueueFonts()},renderUI:function(){this.renderStyles(),this.renderCustomClasses(),this.renderCustomElementID(),this.enqueueFonts()},runReadyTrigger:function(){var e=this;_.defer(function(){embroideryFrontend.elementsHandler.runReadyTrigger(e.$el)})},getID:function(){return this.model.get("id")},getElementUniqueID:function(){return"embroidery-element-"+this.getID()},duplicate:function(){this.trigger("request:duplicate")},renderOnChange:function(e){if(this.allowRender){if(e instanceof o){var t=e.hasChanged(),n=!t,i=!t;if(_.each(e.changedAttributes(),function(t,o){var r=e.getControl(o);if("_column_size"!==o){if(!r)return i=!0,void(n=!0);"none"!==r.render_type&&(i=!0),-1===["none","ui"].indexOf(r.render_type)&&("template"!==r.render_type&&(e.isStyleControl(o)||e.isClassControl(o)||"_element_id"===o)||(n=!0))}else i=!0}),!i)return;if(!n)return void this.renderUIOnly()}var r=this.getTemplateType(),s=this.getEditModel();"js"===r?(this.getEditModel().setHtmlCache(),this.render(),s.renderOnLeave=!0):s.renderRemoteServer()}},onBeforeRender:function(){this.renderAttributes={}},onRender:function(){if(this.renderUI(),this.runReadyTrigger(),this.toggleEditTools){var e=this.ui.triggerButton;this.ui.settingsList.hoverIntent(function(){e.addClass("embroidery-active")},function(){e.removeClass("embroidery-active")},{timeout:500})}},onCollectionChanged:function(){embroidery.saver.setFlagEditorChange(!0)},onEditSettingsChanged:function(e){embroidery.channels.editor.trigger("change:editSettings",e,this)},onSettingsChanged:function(e){embroidery.saver.setFlagEditorChange(!0),this.renderOnChange(e)},onClickEdit:function(e){jQuery(e.target).closest(".embroidery-clickable").length||(e.preventDefault(),e.stopPropagation());"edit"===embroidery.channels.dataEditMode.request("activeMode")&&this.edit()},onClickDuplicate:function(e){e.preventDefault(),e.stopPropagation(),this.duplicate()},removeElement:function(){embroidery.channels.data.trigger("element:before:remove",this.model);var e=this._parent;e.isManualRemoving=!0,this.model.destroy(),e.isManualRemoving=!1,embroidery.channels.data.trigger("element:after:remove",this.model)},onClickRemove:function(e){e.preventDefault(),e.stopPropagation(),this.removeElement()},onClickSave:function(e){e.preventDefault();var t=this.model;embroidery.templates.startModal({onReady:function(){embroidery.templates.getLayout().showSaveTemplateView(t)}})},onDestroy:function(){this.controlsCSSParser.removeStyleFromDocument()}}),t.exports=i},{"embroidery-editor-utils/controls-css-parser":103,"embroidery-elements/models/base-settings":61,"embroidery-elements/views/column":72,"embroidery-elements/views/section":73,"embroidery-validator/base":28,"embroidery-views/base-container":117}],65:[function(e,t,n){var i;i=Marionette.Behavior.extend({onChildviewClickNew:function(e){var t=e.$el.index()+1;this.addChild({at:t})},onRequestNew:function(){this.addChild()},addChild:function(e){if(!this.view.isCollectionFilled()){e=e||{};var t={id:embroidery.helpers.getUniqueID(),elType:this.view.getChildType()[0],settings:{},elements:[]};embroidery.channels.data.trigger("element:before:add",t),this.view.addChildModel(t,e),embroidery.channels.data.trigger("element:after:add",t)}}}),t.exports=i},{}],66:[function(e,t,n){var i;i=Marionette.Behavior.extend({onChildviewRequestDuplicate:function(e){if(!this.view.isCollectionFilled()){var t=this.view.collection.indexOf(e.model),n=e.model.clone();embroidery.channels.data.trigger("element:before:duplicate",n),this.view.addChildModel(n,{at:t+1}),embroidery.channels.data.trigger("element:after:duplicate",n)}}}),t.exports=i},{}],67:[function(e,t,n){var i;i=Marionette.Behavior.extend({editing:!1,$currentEditingArea:null,ui:function(){return{inlineEditingArea:"."+this.getOption("inlineEditingClass")}},events:function(){return{"click @ui.inlineEditingArea":"onInlineEditingClick","input @ui.inlineEditingArea":"onInlineEditingUpdate"}},getEditingSettingKey:function(){return this.$currentEditingArea.data().embroiderySettingKey},startEditing:function(e){if(!this.editing&&"edit"===embroidery.channels.dataEditMode.request("activeMode")&&!this.view.model.isRemoteRequestActive()){this.$currentEditingArea=e;var t=this.$currentEditingArea.data().embroideryInlineEditingToolbar,n="advanced"===t?"advanced":"basic",i=this.view.getEditModel(),o=embroidery.config.inlineEditing,r=i.getSetting(this.getEditingSettingKey());"advanced"===n&&(r=wp.editor.autop(r)),this.$currentEditingArea.html(r);var s=embroideryFrontend.getElements("window").EmbroideryInlineEditor;this.editing=!0,this.view.allowRender=!1,this.view.model.setHtmlCache(""),this.editor=new s({linksInNewWindow:!0,stay:!1,editor:this.$currentEditingArea[0],mode:n,list:"none"===t?[]:o.toolbar[t||"basic"],cleanAttrs:["id","class","name"],placeholder:embroidery.translate("type_here")+"...",toolbarIconsPrefix:"eicon-editor-",toolbarIconsDictionary:{externalLink:{className:"eicon-editor-external-link"},list:{className:"eicon-editor-list-ul"},insertOrderedList:{className:"eicon-editor-list-ol"},insertUnorderedList:{className:"eicon-editor-list-ul"},createlink:{className:"eicon-editor-link"},unlink:{className:"eicon-editor-unlink"},blockquote:{className:"eicon-editor-quote"},p:{className:"eicon-editor-paragraph"},pre:{className:"eicon-editor-code"}}});jQuery(this.editor._menu).children().on("mousedown",function(e){e.preventDefault()}),this.$currentEditingArea.on("blur",this.onInlineEditingBlur.bind(this))}},stopEditing:function(){this.editing=!1,this.editor.destroy(),this.view.allowRender=!0,"advanced"===this.$currentEditingArea.data().embroideryInlineEditingToolbar&&this.view.getEditModel().renderRemoteServer()},onInlineEditingClick:function(e){var t=this,n=jQuery(e.currentTarget);setTimeout(function(){t.startEditing(n)},30)},onInlineEditingBlur:function(){var e=this;setTimeout(function(){var t=embroideryFrontend.getElements("window").getSelection();jQuery(t.focusNode).closest(".pen-input-wrapper").length||e.stopEditing()},20)},onInlineEditingUpdate:function(){this.view.getEditModel().setSetting(this.getEditingSettingKey(),this.editor.getContent())}}),t.exports=i},{}],68:[function(e,t,n){var i;i=Marionette.Behavior.extend({onRenderCollection:function(){this.handleInnerTabs(this.view)},handleInnerTabs:function(e){var t=e.children.filter(function(e){return"tabs"===e.model.get("type")});_.each(t,function(t){t.$el.find(".embroidery-control-content").remove();var n=t.model.get("name"),i=e.children.filter(function(e){return"tab"===e.model.get("type")&&e.model.get("tabs_wrapper")===n});_.each(i,function(n,i){t._addChildView(n);var o=n.model.get("name"),r=e.children.filter(function(e){return o===e.model.get("inner_tab")});0===i?n.$el.addClass("embroidery-tab-active"):_.each(r,function(e){e.$el.addClass("embroidery-tab-close")})})})},onChildviewControlTabClicked:function(e){var t="embroidery-tab-close",n="embroidery-tab-active",i=e.model.get("name"),o=this.view.children.filter(function(t){return"tab"!==t.model.get("type")&&e.model.get("tabs_wrapper")===t.model.get("tabs_wrapper")}),r=this.view.children.filter(function(t){return"tab"===t.model.get("type")&&e.model.get("tabs_wrapper")===t.model.get("tabs_wrapper")});_.each(r,function(e){e.$el.removeClass(n)}),e.$el.addClass(n),_.each(o,function(e){e.model.get("inner_tab")===i?e.$el.removeClass(t):e.$el.addClass(t)}),embroidery.channels.data.trigger("scrollbar:update")}}),t.exports=i},{}],69:[function(e,t,n){var i;i=Marionette.Behavior.extend({defaults:{handles:embroidery.config.is_rtl?"w":"e"},events:{resizestart:"onResizeStart",resizestop:"onResizeStop",resize:"onResize"},initialize:function(){Marionette.Behavior.prototype.initialize.apply(this,arguments),this.listenTo(embroidery.channels.dataEditMode,"switch",this.onEditModeSwitched)},active:function(){this.deactivate();var e=_.clone(this.options);delete e.behaviorClass;var t=this.getChildViewContainer(),n=_.extend({},e);t.resizable(n)},deactivate:function(){this.getChildViewContainer().resizable("instance")&&this.getChildViewContainer().resizable("destroy")},onEditModeSwitched:function(e){"edit"===e?this.active():this.deactivate()},onRender:function(){var e=this;_.defer(function(){e.onEditModeSwitched(embroidery.channels.dataEditMode.request("activeMode"))})},onDestroy:function(){this.deactivate()},onResizeStart:function(e){e.stopPropagation(),this.view.$el.data("originalWidth",this.view.el.getBoundingClientRect().width),this.view.triggerMethod("request:resize:start",e)},onResizeStop:function(e){e.stopPropagation(),this.view.triggerMethod("request:resize:stop")},onResize:function(e,t){e.stopPropagation(),this.view.triggerMethod("request:resize",t,e)},getChildViewContainer:function(){return this.$el}}),t.exports=i},{}],70:[function(e,t,n){var i;i=Marionette.Behavior.extend({defaults:{elChildType:"widget"},events:{sortstart:"onSortStart",sortreceive:"onSortReceive",sortupdate:"onSortUpdate",sortover:"onSortOver",sortout:"onSortOut"},initialize:function(){this.listenTo(embroidery.channels.dataEditMode,"switch",this.onEditModeSwitched).listenTo(embroidery.channels.deviceMode,"change",this.onDeviceModeChange)},onEditModeSwitched:function(e){"edit"===e?this.activate():this.deactivate()},onDeviceModeChange:function(){"desktop"===embroidery.channels.deviceMode.request("currentMode")?this.activate():this.deactivate()},onRender:function(){var e=this;_.defer(function(){e.onEditModeSwitched(embroidery.channels.dataEditMode.request("activeMode"))})},onDestroy:function(){this.deactivate()},activate:function(){if(!this.getChildViewContainer().sortable("instance")){var e=this.getChildViewContainer(),t={connectWith:e.selector,placeholder:"embroidery-sortable-placeholder embroidery-"+this.getOption("elChildType")+"-placeholder",cursorAt:{top:20,left:25},helper:this._getSortableHelper.bind(this),cancel:"input, textarea, button, select, option, .embroidery-inline-editing, .embroidery-tab-title"},n=_.extend(t,this.view.getSortableOptions());e.sortable(n)}},_getSortableHelper:function(e,t){var n=this.view.collection.get({cid:t.data("model-cid")});return'<div style="height: 84px; width: 125px;" class="embroidery-sortable-helper embroidery-sortable-helper-'+n.get("elType")+'"><div class="icon"><i class="'+n.getIcon()+'"></i></div><div class="embroidery-element-title-wrapper"><div class="title">'+n.getTitle()+"</div></div></div>"},getChildViewContainer:function(){return this.view.getChildViewContainer(this.view)},deactivate:function(){this.getChildViewContainer().sortable("instance")&&this.getChildViewContainer().sortable("destroy")},onSortStart:function(e,t){e.stopPropagation();var n=this.view.collection.get({cid:t.item.data("model-cid")});if("column"===this.options.elChildType){var i=0;t.item.data("sortableItem").items.forEach(function(e){if(e.item[0]===t.item[0])return i=e.height,!1}),t.placeholder.height(i)}embroidery.channels.data.reply("dragging:model",n).reply("dragging:parent:view",this.view).trigger("drag:start",n).trigger(n.get("elType")+":drag:start")},onSortOver:function(e){e.stopPropagation();var t=embroidery.channels.data.request("dragging:model");jQuery(e.target).addClass("embroidery-draggable-over").attr({"data-dragged-element":t.get("elType"),"data-dragged-is-inner":t.get("isInner")}),this.$el.addClass("embroidery-dragging-on-child")},onSortOut:function(e){e.stopPropagation(),jQuery(e.target).removeClass("embroidery-draggable-over").removeAttr("data-dragged-element data-dragged-is-inner"),this.$el.removeClass("embroidery-dragging-on-child")},onSortReceive:function(e,t){if(e.stopPropagation(),this.view.isCollectionFilled())jQuery(t.sender).sortable("cancel");else{var n=embroidery.channels.data.request("dragging:model"),i="section"===n.get("elType")&&n.get("isInner"),o="column"===this.view.getElementType()&&this.view.isInner();if(i&&o)jQuery(t.sender).sortable("cancel");else{embroidery.channels.data.trigger("drag:before:update",n);var r=t.item.parent().children().index(t.item),s=n.toJSON({copyHtmlCache:!0}),l=embroidery.channels.data.request("dragging:parent:view");l.isManualRemoving=!0,n.destroy(),l.isManualRemoving=!1,this.view.addChildElement(s,{at:r}),embroidery.channels.data.trigger("drag:after:update",n)}}},onSortUpdate:function(e,t){if(e.stopPropagation(),this.getChildViewContainer()[0]===t.item.parent()[0]){var n=embroidery.channels.data.request("dragging:model"),i=t.item,o=this.view.collection,r=i.parent().children().index(i);embroidery.channels.data.trigger("drag:before:update",n);this.view.children.findByModelCid(n.cid)._isRendering=!0,o.remove(n),this.view.addChildElement(n,{at:r}),embroidery.saver.setFlagEditorChange(!0),embroidery.channels.data.trigger("drag:after:update",n)}},onAddChild:function(e){e.$el.attr("data-model-cid",e.model.cid)}}),t.exports=i},{}],71:[function(e,t,n){var i;i=Marionette.ItemView.extend({template:"#tmpl-embroidery-empty-preview",className:"embroidery-empty-view",events:{click:"onClickAdd"},onClickAdd:function(){embroidery.getPanelView().setPage("elements")}}),t.exports=i},{}],72:[function(e,t,n){var i,o=e("embroidery-elements/views/base"),r=e("embroidery-elements/views/column-empty");i=o.extend({template:Marionette.TemplateCache.get("#tmpl-embroidery-element-column-content"),emptyView:r,childViewContainer:"> .embroidery-column-wrap > .embroidery-widget-wrap",behaviors:function(){var t=o.prototype.behaviors.apply(this,arguments);return _.extend(t,{Sortable:{behaviorClass:e("embroidery-behaviors/sortable"),elChildType:"widget"},Resizable:{behaviorClass:e("embroidery-behaviors/resizable")},HandleDuplicate:{behaviorClass:e("embroidery-behaviors/handle-duplicate")},HandleAddMode:{behaviorClass:e("embroidery-behaviors/duplicate")}}),embroidery.hooks.applyFilters("elements/column/behaviors",t,this)},className:function(){return o.prototype.className.apply(this,arguments)+" embroidery-column embroidery-"+(this.isInner()?"inner":"top")+"-column"},tagName:function(){return this.model.getSetting("html_tag")||"div"},ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.columnInner="> .embroidery-column-wrap",e.percentsTooltip="> .embroidery-element-overlay .embroidery-column-percents-tooltip",e},triggers:{"click @ui.addButton":"click:new"},initialize:function(){o.prototype.initialize.apply(this,arguments),this.addControlValidator("_inline_size",this.onEditorInlineSizeInputChange)},isDroppingAllowed:function(){var e=embroidery.channels.panelElements.request("element:selected");if(!e)return!1;var t=e.model.get("elType");return"section"===t?!this.isInner():"widget"===t},getPercentsForDisplay:function(){return(+this.model.getSetting("_inline_size")||this.getPercentSize()).toFixed(1)+"%"},changeSizeUI:function(){var e=this,t=e.model.getSetting("_column_size");e.$el.attr("data-col",t),_.defer(function(){e.ui.percentsTooltip&&e.ui.percentsTooltip.text(e.getPercentsForDisplay())})},getPercentSize:function(e){return e||(e=this.el.getBoundingClientRect().width),+(e/this.$el.parent().width()*100).toFixed(3)},getSortableOptions:function(){return{connectWith:".embroidery-widget-wrap",items:"> .embroidery-element"}},changeChildContainerClasses:function(){var e="embroidery-element-empty",t="embroidery-element-populated";this.collection.isEmpty()?this.ui.columnInner.removeClass(t).addClass(e):this.ui.columnInner.removeClass(e).addClass(t)},onCollectionChanged:function(){o.prototype.onCollectionChanged.apply(this,arguments),this.changeChildContainerClasses()},onRender:function(){var e=this;o.prototype.onRender.apply(e,arguments),e.changeChildContainerClasses(),e.changeSizeUI(),e.$el.html5Droppable({items:" > .embroidery-column-wrap > .embroidery-widget-wrap > .embroidery-element, >.embroidery-column-wrap > .embroidery-widget-wrap > .embroidery-empty-view > .embroidery-first-add",axis:["vertical"],groups:["embroidery-element"],isDroppingAllowed:e.isDroppingAllowed.bind(e),currentElementClass:"embroidery-html5dnd-current-element",placeholderClass:"embroidery-sortable-placeholder embroidery-widget-placeholder",hasDraggingOnChildClass:"embroidery-dragging-on-child",onDropping:function(t,n){n.stopPropagation();var i=jQuery(this).index();"bottom"===t&&i++,e.addElementFromPanel({at:i})}})},onSettingsChanged:function(e){o.prototype.onSettingsChanged.apply(this,arguments);var t=e.changedAttributes();("_column_size"in t||"_inline_size"in t)&&this.changeSizeUI()},onEditorInlineSizeInputChange:function(e,t){var n=[],i=this.model.getSetting("_column_size");if(100===i)return n.push("Could not resize one column"),n;t||(t=i);try{this._parent.resizeChild(this,+t,+e)}catch(e){e.message===this._parent.errors.columnWidthTooLarge&&n.push(e.message)}return n}}),t.exports=i},{"embroidery-behaviors/duplicate":65,"embroidery-behaviors/handle-duplicate":66,"embroidery-behaviors/resizable":69,"embroidery-behaviors/sortable":70,"embroidery-elements/views/base":64,"embroidery-elements/views/column-empty":71}],73:[function(e,t,n){var i,o=e("embroidery-elements/views/base"),r=e("embroidery-views/add-section/inline");i=o.extend({template:Marionette.TemplateCache.get("#tmpl-embroidery-element-section-content"),addSectionView:null,toggleEditTools:!1,className:function(){return o.prototype.className.apply(this,arguments)+" embroidery-section embroidery-"+(this.isInner()?"inner":"top")+"-section"},tagName:function(){return this.model.getSetting("html_tag")||"section"},childViewContainer:"> .embroidery-container > .embroidery-row",behaviors:function(){var t=o.prototype.behaviors.apply(this,arguments);return _.extend(t,{Sortable:{behaviorClass:e("embroidery-behaviors/sortable"),elChildType:"column"},HandleDuplicate:{behaviorClass:e("embroidery-behaviors/handle-duplicate")},HandleAddMode:{behaviorClass:e("embroidery-behaviors/duplicate")}}),embroidery.hooks.applyFilters("elements/section/behaviors",t,this)},errors:{columnWidthTooLarge:"New column width is too large",columnWidthTooSmall:"New column width is too small"},events:function(){var e=o.prototype.events.apply(this,arguments);return e["click @ui.addButton"]="onClickAdd",e},initialize:function(){o.prototype.initialize.apply(this,arguments),this.listenTo(this.collection,"add remove reset",this._checkIsFull),this._checkIsEmpty()},addEmptyColumn:function(){this.addChildModel({id:embroidery.helpers.getUniqueID(),elType:"column",settings:{},elements:[]})},addChildModel:function(e,t){var n=e instanceof Backbone.Model,i=this.isInner();return n?e.set("isInner",i):e.isInner=i,o.prototype.addChildModel.apply(this,arguments)},getSortableOptions:function(){return{connectWith:(this.isInner()?".embroidery-inner-section":".embroidery-top-section")+" > .embroidery-container > .embroidery-row",handle:"> .embroidery-element-overlay .embroidery-editor-column-settings .embroidery-editor-element-trigger",items:"> .embroidery-column",forcePlaceholderSize:!0,tolerance:"pointer"}},onSettingsChanged:function(e){o.prototype.onSettingsChanged.apply(this,arguments),e.changed.structure&&this.redefineLayout()},getColumnPercentSize:function(e,t){return+(t/e.parent().width()*100).toFixed(3)},getDefaultStructure:function(){return this.collection.length+"0"},getStructure:function(){return this.model.getSetting("structure")},setStructure:function(e){if(+embroidery.presetsFactory.getParsedStructure(e).columnsCount!==this.collection.length)throw new TypeError("The provided structure doesn't match the columns count.");this.model.setSetting("structure",e)},redefineLayout:function(){var e=embroidery.presetsFactory.getPresetByStructure(this.getStructure());this.collection.each(function(t,n){t.setSetting("_column_size",e.preset[n]),t.setSetting("_inline_size",null)})},resetLayout:function(){this.setStructure(this.getDefaultStructure())},resetColumnsCustomSize:function(){this.collection.each(function(e){e.setSetting("_inline_size",null)})},isCollectionFilled:function(){return 10<=this.collection.length},_checkIsFull:function(){this.$el.toggleClass("embroidery-section-filled",this.isCollectionFilled())},_checkIsEmpty:function(){this.collection.length||this.model.get("dontFillEmpty")||this.addEmptyColumn()},getColumnAt:function(e){var t=this.collection.at(e);return t?this.children.findByModelCid(t.cid):null},getNextColumn:function(e){return this.getColumnAt(this.collection.indexOf(e.model)+1)},getPreviousColumn:function(e){return this.getColumnAt(this.collection.indexOf(e.model)-1)},showChildrenPercentsTooltip:function(e,t){e.ui.percentsTooltip.show(),e.ui.percentsTooltip.attr("data-side",embroidery.config.is_rtl?"right":"left"),t.ui.percentsTooltip.show(),t.ui.percentsTooltip.attr("data-side",embroidery.config.is_rtl?"left":"right")},hideChildrenPercentsTooltip:function(e,t){e.ui.percentsTooltip.hide(),t.ui.percentsTooltip.hide()},resizeChild:function(e,t,n){var i=this.getNextColumn(e)||this.getPreviousColumn(e);if(!i)throw new ReferenceError("There is not any next column");var o=i.$el,r=+(t+(+i.model.getSetting("_inline_size")||this.getColumnPercentSize(o,o[0].getBoundingClientRect().width))-n).toFixed(3);if(r<10)throw new RangeError(this.errors.columnWidthTooLarge);if(n<10)throw new RangeError(this.errors.columnWidthTooSmall);return i.model.setSetting("_inline_size",r),!0},destroyAddSectionView:function(){this.addSectionView&&!this.addSectionView.isDestroyed&&this.addSectionView.destroy()},onRender:function(){o.prototype.onRender.apply(this,arguments),this._checkIsFull()},onClickAdd:function(){if(!this.addSectionView||this.addSectionView.isDestroyed){var e=this.model.collection.indexOf(this.model),t=new r({atIndex:e});t.render(),this.$el.before(t.$el),t.$el.hide(),setTimeout(function(){t.$el.slideDown()}),this.addSectionView=t}else this.addSectionView.fadeToDeath()},onAddChild:function(){this.isBuffering||this.model.get("dontFillEmpty")||this.resetLayout()},onRemoveChild:function(){this.isManualRemoving&&(this._checkIsEmpty(),this.resetLayout())},onChildviewRequestResizeStart:function(e){var t=this.getNextColumn(e);if(t){this.showChildrenPercentsTooltip(e,t);var n=e.$el.find("iframe").add(t.$el.find("iframe"));embroidery.helpers.disableElementEvents(n)}},onChildviewRequestResizeStop:function(e){var t=this.getNextColumn(e);if(t){this.hideChildrenPercentsTooltip(e,t);var n=e.$el.find("iframe").add(t.$el.find("iframe"));embroidery.helpers.enableElementEvents(n)}},onChildviewRequestResize:function(e,t,n){var i=+e.model.getSetting("_inline_size")||this.getColumnPercentSize(e.$el,e.$el.data("originalWidth"));t.element.css({width:"",left:"initial"});var o=this.getColumnPercentSize(t.element,t.size.width);try{this.resizeChild(e,i,o)}catch(e){return}e.model.setSetting("_inline_size",o)},onDestroy:function(){o.prototype.onDestroy.apply(this,arguments),this.destroyAddSectionView()}}),t.exports=i},{"embroidery-behaviors/duplicate":65,"embroidery-behaviors/handle-duplicate":66,"embroidery-behaviors/sortable":70,"embroidery-elements/views/base":64,"embroidery-views/add-section/inline":116}],74:[function(e,t,n){var i,o=e("embroidery-elements/views/base");i=o.extend({_templateType:null,getTemplate:function(){var e=this.getEditModel();return"remote"!==this.getTemplateType()?Marionette.TemplateCache.get("#tmpl-embroidery-"+e.get("elType")+"-"+e.get("widgetType")+"-content"):_.template("")},className:function(){return o.prototype.className.apply(this,arguments)+" embroidery-widget"},events:function(){var e=o.prototype.events.apply(this,arguments);return e.click="onClickEdit",e},behaviors:function(){var t=o.prototype.behaviors.apply(this,arguments);return _.extend(t,{InlineEditing:{behaviorClass:e("embroidery-behaviors/inline-editing"),inlineEditingClass:"embroidery-inline-editing"}}),embroidery.hooks.applyFilters("elements/widget/behaviors",t,this)},initialize:function(){o.prototype.initialize.apply(this,arguments);var e=this.getEditModel();e.on({"before:remote:render":this.onModelBeforeRemoteRender.bind(this),"remote:render":this.onModelRemoteRender.bind(this)}),"remote"!==this.getTemplateType()||this.getEditModel().getHtmlCache()||e.renderRemoteServer();var t=this.onRender;this.render=_.throttle(this.render,300),this.onRender=function(){_.defer(t.bind(this))}},render:function(){if(this.model.isRemoteRequestActive())return this.handleEmptyWidget(),void this.$el.addClass("embroidery-element");Marionette.CompositeView.prototype.render.apply(this,arguments)},handleEmptyWidget:function(){this.$el.addClass("embroidery-widget-empty").append('<i class="embroidery-widget-empty-icon '+this.getEditModel().getIcon()+'"></i>')},getTemplateType:function(){if(null===this._templateType){var e=this.getEditModel(),t=jQuery("#tmpl-embroidery-"+e.get("elType")+"-"+e.get("widgetType")+"-content");this._templateType=t.length?"js":"remote"}return this._templateType},getHTMLContent:function(e){return this.getEditModel().getHtmlCache()||e},attachElContent:function(e){var t=this,n=t.getHTMLContent(e);return _.defer(function(){embroideryFrontend.getElements("window").jQuery(t.el).html(n),t.bindUIElements()}),this},addInlineEditingAttributes:function(e,t){this.addRenderAttribute(e,{class:"embroidery-inline-editing","data-embroidery-setting-key":e}),t&&this.addRenderAttribute(e,{"data-embroidery-inline-editing-toolbar":t})},getRepeaterSettingKey:function(e,t,n){return[t,n,e].join(".")},onModelBeforeRemoteRender:function(){this.$el.addClass("embroidery-loading")},onBeforeDestroy:function(){embroidery.$previewContents.find("#embroidery-style-"+this.model.cid).remove()},onModelRemoteRender:function(){this.isDestroyed||(this.$el.removeClass("embroidery-loading"),this.render())},onRender:function(){var e=this;o.prototype.onRender.apply(e,arguments);var t=e.getEditModel(),n=t.getSetting("_skin")||"default";e.$el.attr("data-element_type",t.get("widgetType")+"."+n).removeClass("embroidery-widget-empty").addClass("embroidery-widget-"+t.get("widgetType")+" embroidery-widget-can-edit").children(".embroidery-widget-empty-icon").remove(),e.$el.imagesLoaded().always(function(){setTimeout(function(){1>e.$el.height()&&e.handleEmptyWidget()},200)})}}),t.exports=i},{"embroidery-behaviors/inline-editing":67,"embroidery-elements/views/base":64}],75:[function(e,t,n){var i;i=Marionette.ItemView.extend({template:"#tmpl-embroidery-mode-switcher-content",id:"embroidery-mode-switcher-inner",ui:{previewButton:"#embroidery-mode-switcher-preview-input",previewLabel:"#embroidery-mode-switcher-preview",previewLabelA11y:"#embroidery-mode-switcher-preview .embroidery-screen-only"},events:{"change @ui.previewButton":"onPreviewButtonChange"},initialize:function(){this.listenTo(embroidery.channels.dataEditMode,"switch",this.onEditModeChanged)},getCurrentMode:function(){return this.ui.previewButton.is(":checked")?"preview":"edit"},setMode:function(e){this.ui.previewButton.prop("checked","preview"===e).trigger("change")},toggleMode:function(){this.setMode(this.ui.previewButton.prop("checked")?"edit":"preview")},onRender:function(){this.onEditModeChanged()},onPreviewButtonChange:function(){embroidery.changeEditMode(this.getCurrentMode())},onEditModeChanged:function(){var e=embroidery.channels.dataEditMode.request("activeMode"),t=embroidery.translate("preview"===e?"back_to_editor":"preview");this.ui.previewLabel.attr("title",t),this.ui.previewLabelA11y.text(t)}}),t.exports=i},{}],76:[function(e,t,n){t.exports=Marionette.ItemView.extend({template:"#tmpl-embroidery-panel-footer-content",tagName:"nav",id:"embroidery-panel-footer-tools",possibleRotateModes:["portrait","landscape"],ui:{buttonSave:"#embroidery-panel-saver-button-publish, #embroidery-panel-saver-menu-save-draft",menuButtons:".embroidery-panel-footer-tool",settings:"#embroidery-panel-footer-settings",deviceModeIcon:"#embroidery-panel-footer-responsive > i",deviceModeButtons:"#embroidery-panel-footer-responsive .embroidery-panel-footer-sub-menu-item",saveTemplate:"#embroidery-panel-saver-menu-save-template",history:"#embroidery-panel-footer-history"},events:{"click @ui.settings":"onClickSettings","click @ui.deviceModeButtons":"onClickResponsiveButtons","click @ui.saveTemplate":"onClickSaveTemplate","click @ui.history":"onClickHistory"},behaviors:function(){var e={saver:{behaviorClass:embroidery.modules.saver.footerBehavior}};return embroidery.hooks.applyFilters("panel/footer/behaviors",e,this)},initialize:function(){this.listenTo(embroidery.channels.deviceMode,"change",this.onDeviceModeChange)},getDeviceModeButton:function(e){return this.ui.deviceModeButtons.filter('[data-device-mode="'+e+'"]')},onPanelClick:function(e){var t=jQuery(e.target);if(!t.closest(".embroidery-panel-footer-sub-menu-wrapper").length){var n=t.closest(".embroidery-panel-footer-tool"),i=n.length&&!n.hasClass("embroidery-open");this.ui.menuButtons.filter(":not(.embroidery-leave-open)").removeClass("embroidery-open"),i&&n.addClass("embroidery-open")}},onClickSettings:function(){var e=this;"page_settings"!==embroidery.getPanelView().getCurrentPageName()&&(embroidery.getPanelView().setPage("page_settings"),embroidery.getPanelView().getCurrentPageView().once("destroy",function(){e.ui.settings.removeClass("embroidery-open")}))},onDeviceModeChange:function(){var e=embroidery.channels.deviceMode.request("previousMode"),t=embroidery.channels.deviceMode.request("currentMode");this.getDeviceModeButton(e).removeClass("active"),this.getDeviceModeButton(t).addClass("active"),this.ui.deviceModeIcon.removeClass("eicon-device-"+e).addClass("eicon-device-"+t)},onClickResponsiveButtons:function(e){var t=this.$(e.currentTarget).data("device-mode");embroidery.changeDeviceMode(t)},onClickSaveTemplate:function(){embroidery.templates.startModal({onReady:function(){embroidery.templates.getLayout().showSaveTemplateView()}})},onClickHistory:function(){"historyPage"!==embroidery.getPanelView().getCurrentPageName()&&embroidery.getPanelView().setPage("historyPage")},onRender:function(){var e=this;_.defer(function(){embroidery.getPanelView().$el.on("click",e.onPanelClick.bind(e))})}})},{}],77:[function(e,t,n){var i;i=Marionette.ItemView.extend({template:"#tmpl-embroidery-panel-header",id:"embroidery-panel-header",ui:{menuButton:"#embroidery-panel-header-menu-button",menuIcon:"#embroidery-panel-header-menu-button i",title:"#embroidery-panel-header-title",addButton:"#embroidery-panel-header-add-button"},events:{"click @ui.addButton":"onClickAdd","click @ui.menuButton":"onClickMenu"},setTitle:function(e){this.ui.title.html(e)},onClickAdd:function(){embroidery.getPanelView().setPage("elements")},onClickMenu:function(){var e=embroidery.getPanelView(),t="menu"===e.getCurrentPageName()?"elements":"menu";if("menu"===t){var n="eicon-arrow-"+(embroidery.config.is_rtl?"right":"left");this.ui.menuIcon.removeClass("eicon-menu-bar").addClass(n)}e.setPage(t)}}),t.exports=i},{}],78:[function(e,t,n){var i,o=e("embroidery-views/controls-stack");i=o.extend({template:Marionette.TemplateCache.get("#tmpl-editor-content"),id:"embroidery-panel-page-editor",childViewContainer:"#embroidery-controls",childViewOptions:function(){return{elementSettingsModel:this.model.get("settings"),elementEditSettings:this.model.get("editSettings")}},openActiveSection:function(){o.prototype.openActiveSection.apply(this,arguments),embroidery.channels.editor.trigger("section:activated",this.activeSection,this)},isVisibleSectionControl:function(e){return o.prototype.isVisibleSectionControl.apply(this,arguments)&&embroidery.helpers.isActiveControl(e,this.model.get("settings").attributes)},scrollToEditedElement:function(){embroidery.helpers.scrollToView(this.getOption("editedElementView"))},onBeforeRender:function(){var e=embroidery.getElementControls(this.model);if(!e)throw new Error("Editor controls not found");this.collection=new Backbone.Collection(_.values(e))},onDestroy:function(){var e=this.getOption("editedElementView");e&&e.$el.removeClass("embroidery-element-editable"),this.model.trigger("editor:close"),this.triggerMethod("editor:destroy")},onRender:function(){var e=this.getOption("editedElementView");e&&e.$el.addClass("embroidery-element-editable")},onDeviceModeChange:function(){o.prototype.onDeviceModeChange.apply(this,arguments),this.scrollToEditedElement()},onChildviewSettingsChange:function(e){var t=this.getOption("editedElementView"),n=t.model.get("elType");"widget"===n&&(n=t.model.get("widgetType")),embroidery.channels.editor.trigger("change",e,t).trigger("change:"+n,e,t).trigger("change:"+n+":"+e.model.get("name"),e,t)}}),t.exports=i},{"embroidery-views/controls-stack":119}],79:[function(e,t,n){var i,o=e("../models/element");i=Backbone.Collection.extend({model:o}),t.exports=i},{"../models/element":82}],80:[function(e,t,n){var i,o=e("../models/element");i=Backbone.Collection.extend({model:o}),t.exports=i},{"../models/element":82}],81:[function(e,t,n){var i,o=e("./collections/categories"),r=e("./collections/elements"),s=e("./views/categories"),l=embroidery.modules.templateLibrary.ElementsCollectionView,a=e("./views/search"),c=e("./views/global");i=Marionette.LayoutView.extend({template:"#tmpl-embroidery-panel-elements",regions:{elements:"#embroidery-panel-elements-wrapper",search:"#embroidery-panel-elements-search-area"},ui:{tabs:".embroidery-panel-navigation-tab"},events:{"click @ui.tabs":"onTabClick"},regionViews:{},elementsCollection:null,categoriesCollection:null,initialize:function(){this.listenTo(embroidery.channels.panelElements,"element:selected",this.destroy),this.initElementsCollection(),this.initCategoriesCollection(),this.initRegionViews()},initRegionViews:function(){var e={elements:{region:this.elements,view:l,options:{collection:this.elementsCollection}},categories:{region:this.elements,view:s,options:{collection:this.categoriesCollection}},search:{region:this.search,view:a},global:{region:this.elements,view:c}};this.regionViews=embroidery.hooks.applyFilters("panel/elements/regionViews",e)},initElementsCollection:function(){var e=new r,t=embroidery.config.elements.section;e.add({title:embroidery.translate("inner_section"),elType:"section",categories:["basic"],icon:t.icon}),_.each(embroidery.config.widgets,function(t){e.add({title:t.title,elType:t.elType,categories:t.categories,keywords:t.keywords,icon:t.icon,widgetType:t.widget_type,custom:t.custom})}),this.elementsCollection=e},initCategoriesCollection:function(){var e={};this.elementsCollection.each(function(t){_.each(t.get("categories"),function(n){e[n]||(e[n]=[]),e[n].push(t)})});var t=new o;_.each(embroidery.config.elements_categories,function(n,i){e[i]&&t.add({name:i,title:n.title,icon:n.icon,items:e[i]})}),this.categoriesCollection=t},activateTab:function(e){this.ui.tabs.removeClass("active").filter('[data-view="'+e+'"]').addClass("active"),this.showView(e)},showView:function(e){var t=this.regionViews[e],n=t.options||{};t.region.show(new t.view(n))},clearSearchInput:function(){this.getChildView("search").clearInput()},changeFilter:function(e){embroidery.channels.panelElements.reply("filter:value",e).trigger("filter:change")},clearFilters:function(){this.changeFilter(null),this.clearSearchInput()},onChildviewChildrenRender:function(){this.updateElementsScrollbar()},onChildviewSearchChangeInput:function(e){this.changeFilter(e.ui.input.val(),"search")},onDestroy:function(){embroidery.channels.panelElements.reply("filter:value",null)},onShow:function(){this.showView("categories"),this.showView("search")},onTabClick:function(e){this.activateTab(e.currentTarget.dataset.view)},updateElementsScrollbar:function(){embroidery.channels.data.trigger("scrollbar:update")}}),t.exports=i},{"./collections/categories":79,"./collections/elements":80,"./views/categories":83,"./views/global":87,"./views/search":88}],82:[function(e,t,n){var i;i=Backbone.Model.extend({defaults:{title:"",categories:[],keywords:[],icon:"",elType:"widget",widgetType:""}}),t.exports=i},{}],83:[function(e,t,n){var i,o=e("./category");i=Marionette.CompositeView.extend({template:"#tmpl-embroidery-panel-categories",childView:o,childViewContainer:"#embroidery-panel-categories",id:"embroidery-panel-elements-categories",initialize:function(){this.listenTo(embroidery.channels.panelElements,"filter:change",this.onPanelElementsFilterChange)},onPanelElementsFilterChange:function(){embroidery.channels.panelElements.request("filter:value")&&embroidery.getPanelView().getCurrentPageView().showView("elements")}}),t.exports=i},{"./category":84}],84:[function(e,t,n){var i,o=e("../collections/elements");i=Marionette.CompositeView.extend({template:"#tmpl-embroidery-panel-elements-category",className:"embroidery-panel-category",childView:e("embroidery-panel/pages/elements/views/element"),childViewContainer:".panel-elements-category-items",initialize:function(){this.collection=new o(this.model.get("items"))}}),t.exports=i},{"../collections/elements":80,"embroidery-panel/pages/elements/views/element":85}],85:[function(e,t,n){var i;i=Marionette.ItemView.extend({template:"#tmpl-embroidery-element-library-element",className:"embroidery-element-wrapper",onRender:function(){var e=this;this.$el.html5Draggable({onDragStart:function(){embroidery.channels.panelElements.reply("element:selected",e).trigger("element:drag:start")},onDragEnd:function(){embroidery.channels.panelElements.trigger("element:drag:end")},groups:["embroidery-element"]})}}),t.exports=i},{}],86:[function(e,t,n){var i;i=Marionette.CollectionView.extend({childView:e("embroidery-panel/pages/elements/views/element"),id:"embroidery-panel-elements",initialize:function(){this.listenTo(embroidery.channels.panelElements,"filter:change",this.onFilterChanged)},filter:function(e){var t=embroidery.channels.panelElements.request("filter:value");return!t||(-1!==e.get("title").toLowerCase().indexOf(t.toLowerCase())||_.any(e.get("keywords"),function(e){return-1!==e.toLowerCase().indexOf(t.toLowerCase())}))},onFilterChanged:function(){embroidery.channels.panelElements.request("filter:value")||this.onFilterEmpty(),this._renderChildren(),this.triggerMethod("children:render")},onFilterEmpty:function(){embroidery.getPanelView().getCurrentPageView().showView("categories")}}),t.exports=i},{"embroidery-panel/pages/elements/views/element":85}],87:[function(e,t,n){t.exports=Marionette.ItemView.extend({template:"#tmpl-embroidery-panel-global",id:"embroidery-panel-global",initialize:function(){embroidery.getPanelView().getCurrentPageView().search.reset()},onDestroy:function(){embroidery.getPanelView().getCurrentPageView().showView("search")}})},{}],88:[function(e,t,n){var i;i=Marionette.ItemView.extend({template:"#tmpl-embroidery-panel-element-search",id:"embroidery-panel-elements-search-wrapper",ui:{input:"input"},events:{"keyup @ui.input":"onInputChanged"},clearInput:function(){this.ui.input.val("")},onInputChanged:function(e){27===e.keyCode&&this.clearInput(),this.triggerMethod("search:change:input")},onRender:function(){var e=this.ui.input;setTimeout(function(){e.focus()})}}),t.exports=i},{}],89:[function(e,t,n){var i,o=e("embroidery-panel/pages/menu/views/group");i=Marionette.CompositeView.extend({id:"embroidery-panel-page-menu",template:"#tmpl-embroidery-panel-menu",childView:o,childViewContainer:"#embroidery-panel-page-menu-content",initialize:function(){this.collection=i.getGroups()},onDestroy:function(){var e="eicon-arrow-"+(embroidery.config.is_rtl?"right":"left");embroidery.panel.currentView.getHeaderView().ui.menuIcon.removeClass(e).addClass("eicon-menu-bar")}},{groups:null,initGroups:function(){this.groups=new Backbone.Collection([{name:"style",title:embroidery.translate("global_style"),items:[{name:"global-colors",icon:"fa fa-paint-brush",title:embroidery.translate("global_colors"),type:"page",pageName:"colorScheme"},{name:"global-fonts",icon:"fa fa-font",title:embroidery.translate("global_fonts"),type:"page",pageName:"typographyScheme"},{name:"color-picker",icon:"fa fa-eyedropper",title:embroidery.translate("color_picker"),type:"page",pageName:"colorPickerScheme"}]},{name:"settings",title:embroidery.translate("settings"),items:[{name:"embroidery-settings",icon:"fa fa-external-link",title:embroidery.translate("embroidery_settings"),type:"link",link:embroidery.config.settings_page_link,newTab:!0},{name:"about-embroidery",icon:"fa fa-info-circle",title:embroidery.translate("about_embroidery"),type:"link",link:embroidery.config.embroidery_site,newTab:!0}]}])},getGroups:function(){return this.groups||this.initGroups(),this.groups},addItem:function(e,t,n){var i=this.getGroups().findWhere({name:t});if(i){var o,r=i.get("items");n&&(o=_.findWhere(r,{name:n})),o?r.splice(r.indexOf(o),0,e):r.push(e)}}}),t.exports=i},{"embroidery-panel/pages/menu/views/group":90}],90:[function(e,t,n){var i=e("embroidery-panel/pages/menu/views/item");t.exports=Marionette.CompositeView.extend({template:"#tmpl-embroidery-panel-menu-group",className:"embroidery-panel-menu-group",childView:i,childViewContainer:".embroidery-panel-menu-items",initialize:function(){this.collection=new Backbone.Collection(this.model.get("items"))},onChildviewClick:function(e){switch(e.model.get("type")){case"page":var t=e.model.get("pageName"),n=e.model.get("title");embroidery.getPanelView().setPage(t,n);break;case"link":var i=e.model.get("link");e.model.get("newTab")?open(i,"_blank"):location.href=e.model.get("link");break;default:var o=e.model.get("callback");_.isFunction(o)&&o.call(e)}}})},{"embroidery-panel/pages/menu/views/item":91}],91:[function(e,t,n){t.exports=Marionette.ItemView.extend({template:"#tmpl-embroidery-panel-menu-item",className:"embroidery-panel-menu-item",triggers:{click:"click"}})},{}],92:[function(e,t,n){var i,o={color:e("embroidery-panel/pages/schemes/items/color"),typography:e("embroidery-panel/pages/schemes/items/typography")};i=Marionette.CompositeView.extend({id:function(){return"embroidery-panel-scheme-"+this.getType()},className:function(){return"embroidery-panel-scheme embroidery-panel-scheme-"+this.getUIType()},childViewContainer:".embroidery-panel-scheme-items",getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-embroidery-panel-schemes-"+this.getType())},getChildView:function(){return o[this.getUIType()]},getUIType:function(){return this.getType()},ui:function(){return{saveButton:".embroidery-panel-scheme-save .embroidery-button",discardButton:".embroidery-panel-scheme-discard .embroidery-button",resetButton:".embroidery-panel-scheme-reset .embroidery-button"}},events:function(){return{"click @ui.saveButton":"saveScheme","click @ui.discardButton":"discardScheme","click @ui.resetButton":"setDefaultScheme"}},initialize:function(){this.model=new Backbone.Model,this.resetScheme()},getType:function(){},getScheme:function(){return embroidery.schemes.getScheme(this.getType())},changeChildrenUIValues:function(e){var t=this;_.each(e,function(e,n){var i=t.collection.findWhere({key:n});t.children.findByModelCid(i.cid).changeUIValue(e)})},discardScheme:function(){embroidery.schemes.resetSchemes(this.getType()),this.onSchemeChange(),this.ui.saveButton.prop("disabled",!0),this._renderChildren()},setSchemeValue:function(e,t){embroidery.schemes.setSchemeValue(this.getType(),e,t),this.onSchemeChange()},saveScheme:function(){embroidery.schemes.saveScheme(this.getType()),this.ui.saveButton.prop("disabled",!0),this.resetScheme(),this._renderChildren()},setDefaultScheme:function(){var e=embroidery.config.default_schemes[this.getType()].items;this.changeChildrenUIValues(e)},resetItems:function(){this.model.set("items",this.getScheme().items)},resetCollection:function(){var e=this,t=e.model.get("items");e.collection=new Backbone.Collection,_.each(t,function(t,n){t.type=e.getType(),t.key=n,e.collection.add(t)})},resetScheme:function(){this.resetItems(),this.resetCollection()},onSchemeChange:function(){embroidery.schemes.printSchemesStyle()},onChildviewValueChange:function(e,t){this.ui.saveButton.removeProp("disabled"),this.setSchemeValue(e.model.get("key"),t)}}),t.exports=i},{"embroidery-panel/pages/schemes/items/color":97,"embroidery-panel/pages/schemes/items/typography":98}],93:[function(e,t,n){var i;i=e("embroidery-panel/pages/schemes/colors").extend({getType:function(){return"color-picker"},getUIType:function(){return"color"},onSchemeChange:function(){},getViewComparator:function(){return this.orderView},orderView:function(e){return embroidery.helpers.getColorPickerPaletteIndex(e.get("key"))}}),t.exports=i},{"embroidery-panel/pages/schemes/colors":94}],94:[function(e,t,n){var i,o=e("embroidery-panel/pages/schemes/base");i=o.extend({ui:function(){var e=o.prototype.ui.apply(this,arguments);return e.systemSchemes=".embroidery-panel-scheme-color-system-scheme",e},events:function(){var e=o.prototype.events.apply(this,arguments);return e["click @ui.systemSchemes"]="onSystemSchemeClick",e},getType:function(){return"color"},onSystemSchemeClick:function(e){var t=jQuery(e.currentTarget).data("schemeName"),n=embroidery.config.system_schemes[this.getType()][t].items;this.changeChildrenUIValues(n)}}),t.exports=i},{"embroidery-panel/pages/schemes/base":92}],95:[function(e,t,n){var i;i=Marionette.ItemView.extend({template:"#tmpl-embroidery-panel-schemes-disabled",id:"embroidery-panel-schemes-disabled",className:"embroidery-panel-nerd-box",disabledTitle:"",templateHelpers:function(){return{disabledTitle:this.disabledTitle}}}),t.exports=i},{}],96:[function(e,t,n){var i;i=Marionette.ItemView.extend({getTemplate:function(){return Marionette.TemplateCache.get("#tmpl-embroidery-panel-scheme-"+this.getUIType()+"-item")},className:function(){return"embroidery-panel-scheme-item"}}),t.exports=i},{}],97:[function(e,t,n){var i;i=e("embroidery-panel/pages/schemes/items/base").extend({getUIType:function(){return"color"},ui:{input:".embroidery-panel-scheme-color-value"},changeUIValue:function(e){this.ui.input.wpColorPicker("color",e)},onBeforeDestroy:function(){this.ui.input.wpColorPicker("instance")&&this.ui.input.wpColorPicker("close")},onRender:function(){var e=this;embroidery.helpers.wpColorPicker(e.ui.input,{change:function(t,n){e.triggerMethod("value:change",n.color.toString())}})}}),t.exports=i},{"embroidery-panel/pages/schemes/items/base":96}],98:[function(e,t,n){var i,o=e("embroidery-panel/pages/schemes/items/base");i=o.extend({getUIType:function(){return"typography"},className:function(){return o.prototype.className.apply(this,arguments)+" embroidery-panel-box"},ui:{heading:".embroidery-panel-heading",allFields:".embroidery-panel-scheme-typography-item-field",inputFields:"input.embroidery-panel-scheme-typography-item-field",selectFields:"select.embroidery-panel-scheme-typography-item-field",selectFamilyFields:'select.embroidery-panel-scheme-typography-item-field[name="font_family"]'},events:{"input @ui.inputFields":"onFieldChange","change @ui.selectFields":"onFieldChange","click @ui.heading":"toggleVisibility"},onRender:function(){var e=this;this.ui.inputFields.add(this.ui.selectFields).each(function(){var t=jQuery(this),n=t.attr("name"),i=e.model.get("value")[n];t.val(i)}),this.ui.selectFamilyFields.select2({dir:embroidery.config.is_rtl?"rtl":"ltr"})},toggleVisibility:function(){this.ui.heading.toggleClass("embroidery-open")},changeUIValue:function(e){this.ui.allFields.each(function(){var t=jQuery(this),n=t.attr("name"),i=e[n];t.val(i).trigger("change")})},onFieldChange:function(e){var t=this.$(e.currentTarget),n=embroidery.schemes.getSchemeValue("typography",this.model.get("key")).value,i=t.attr("name");n[i]=t.val(),"font_family"!==i||_.isEmpty(n[i])||embroidery.helpers.enqueueFont(n[i]),this.triggerMethod("value:change",n)}}),t.exports=i},{"embroidery-panel/pages/schemes/items/base":96}],99:[function(e,t,n){var i;i=e("embroidery-panel/pages/schemes/base").extend({getType:function(){return"typography"}}),t.exports=i},{"embroidery-panel/pages/schemes/base":92}],100:[function(e,t,n){var i,o=e("embroidery-layouts/edit-mode");i=Marionette.LayoutView.extend({template:"#tmpl-embroidery-panel",id:"embroidery-panel-inner",regions:{content:"#embroidery-panel-content-wrapper",header:"#embroidery-panel-header-wrapper",footer:"#embroidery-panel-footer",modeSwitcher:"#embroidery-mode-switcher"},pages:{},childEvents:{"click:add":function(){this.setPage("elements")},"editor:destroy":function(){this.setPage("elements")}},currentPageName:null,currentPageView:null,_isScrollbarInitialized:!1,initialize:function(){this.initPages()},buildPages:function(){var t={elements:{view:e("embroidery-panel/pages/elements/elements"),title:'<img src="'+embroidery.config.assets_url+'images/logo-panel.svg">'},editor:{view:e("embroidery-panel/pages/editor")},menu:{view:embroidery.modules.panel.Menu,title:'<img src="'+embroidery.config.assets_url+'images/logo-panel.svg">'},colorScheme:{view:e("embroidery-panel/pages/schemes/colors")},typographyScheme:{view:e("embroidery-panel/pages/schemes/typography")},colorPickerScheme:{view:e("embroidery-panel/pages/schemes/color-picker")}},n=Object.keys(embroidery.schemes.getSchemes()),i=_.difference(n,embroidery.schemes.getEnabledSchemesTypes());return _.each(i,function(n){var i=embroidery.schemes.getScheme(n);t[n+"Scheme"].view=e("embroidery-panel/pages/schemes/disabled").extend({disabledTitle:i.disabled_title})}),t},initPages:function(){var e;this.getPages=function(t){return e||(e=this.buildPages()),t?e[t]:e},this.addPage=function(t,n){e||(e=this.buildPages()),e[t]=n}},getHeaderView:function(){return this.getChildView("header")},getFooterView:function(){return this.getChildView("footer")},getCurrentPageName:function(){return this.currentPageName},getCurrentPageView:function(){return this.currentPageView},setPage:function(e,t,n){var i=this.getPages(e);if(!i)throw new ReferenceError("Embroidery panel doesn't have page named '"+e+"'");i.options&&(n=_.extend(i.options,n));var o=i.view;i.getView&&(o=i.getView()),this.currentPageView=new o(n),this.showChildView("content",this.currentPageView),this.getHeaderView().setTitle(t||i.title),this.currentPageName=e,this.trigger("set:page",this.currentPageView).trigger("set:page:"+e,this.currentPageView)},openEditor:function(e,t){if("editor"===this.getCurrentPageName()){if(this.getCurrentPageView().model===e)return}var n=embroidery.getElementData(e);this.setPage("editor",embroidery.translate("edit_element",[n.title]),{model:e,editedElementView:t});var i="panel/open_editor/"+e.get("elType");embroidery.hooks.doAction(i,this,e,t),embroidery.hooks.doAction(i+"/"+e.get("widgetType"),this,e,t)},onBeforeShow:function(){var t=e("embroidery-layouts/panel/footer"),n=e("embroidery-layouts/panel/header");this.showChildView("modeSwitcher",new o),this.showChildView("header",new n),this.showChildView("footer",new t),this.updateScrollbar=_.throttle(this.updateScrollbar,100),this.getRegion("content").on("before:show",this.onEditorBeforeShow.bind(this)).on("empty",this.onEditorEmpty.bind(this)).on("show",this.updateScrollbar.bind(this)),this.setPage("elements"),this.listenTo(embroidery.channels.data,"scrollbar:update",this.updateScrollbar)},onEditorBeforeShow:function(){_.defer(this.updateScrollbar.bind(this))},onEditorEmpty:function(){this.updateScrollbar()},updateScrollbar:function(){var e=this.content.$el;if(!this._isScrollbarInitialized)return e.perfectScrollbar(),void(this._isScrollbarInitialized=!0);e.perfectScrollbar("update")}}),t.exports=i},{"embroidery-layouts/edit-mode":75,"embroidery-layouts/panel/footer":76,"embroidery-layouts/panel/header":77,"embroidery-panel/pages/editor":78,"embroidery-panel/pages/elements/elements":81,"embroidery-panel/pages/schemes/color-picker":93,"embroidery-panel/pages/schemes/colors":94,"embroidery-panel/pages/schemes/disabled":95,"embroidery-panel/pages/schemes/typography":99}],101:[function(e,t,n){var i;i={config:{},initConfig:function(){this.config={ajaxParams:{type:"POST",url:embroidery.config.ajaxurl,data:{}},actionPrefix:"embroidery_"}},init:function(){this.initConfig()},send:function(e,t){var n=this,i=embroidery.helpers.cloneObject(this.config.ajaxParams);t=t||{},e=this.config.actionPrefix+e,jQuery.extend(i,t),i.data instanceof FormData?(i.data.append("action",e),i.data.append("_nonce",embroidery.config.nonce)):(i.data.action=e,i.data._nonce=embroidery.config.nonce);var o=i.success,r=i.error;return(o||r)&&(i.success=function(e){e.success&&o&&o(e.data),!e.success&&r&&r(e.data)},i.error=r?function(e){r(e)}:function(e){var t=n.createErrorMessage(e);embroidery.notifications.showToast({message:t})}),jQuery.ajax(i)},createErrorMessage:function(e){var t;return 4===e.readyState?(t=embroidery.translate("server_error"),200!==e.status&&(t+=" ("+e.status+" "+e.statusText+")")):t=0===e.readyState?embroidery.translate("server_connection_lost"):embroidery.translate("unknown_error"),t+"."}},t.exports=i},{}],102:[function(e,t,n){var i;i=function(){var e=this;this.compare=function(e,t,n){switch(n){case"==":return e==t;case"!=":return e!=t;case"!==":return e!==t;case"in":return-1!==t.indexOf(e);case"!in":return-1===t.indexOf(e);case"<":return e<t;case"<=":return e<=t;case">":return e>t;case">=":return e>=t;default:return e===t}},this.check=function(t,n){var i="or"===t.relation,o=!i;return jQuery.each(t.terms,function(){var t;if(this.terms)t=e.check(this,n);else{var r=this.name.match(/(\w+)(?:\[(\w+)])?/),s=n[r[1]];r[2]&&(s=s[r[2]]),t=e.compare(s,this.value,this.operator)}return i?(t&&(o=!0),!t):t?void 0:o=!1}),o}},t.exports=new i},{}],103:[function(e,t,n){var i,o=e("embroidery-utils/view-module"),r=e("embroidery-editor-utils/stylesheet");(i=o.extend({stylesheet:null,getDefaultSettings:function(){return{id:0}},getDefaultElements:function(){return{$stylesheetElement:jQuery("<style>",{id:"embroidery-style-"+this.getSettings("id")})}},initStylesheet:function(){var e=embroidery.config.viewportBreakpoints;this.stylesheet=new r,this.stylesheet.addDevice("mobile",0).addDevice("tablet",e.md).addDevice("desktop",e.lg)},addStyleRules:function(e,t,n,i,o){var r=this;_.each(e,function(e){e.styleFields&&e.styleFields.length&&t[e.name].each(function(t){r.addStyleRules(e.styleFields,t.attributes,n,i.concat(["{{CURRENT_ITEM}}"]),o.concat([".embroidery-repeater-item-"+t.get("_id")]))}),r.addControlStyleRules(e,t,n,i,o)})},addControlStyleRules:function(e,t,n,o,r){var s=this;i.addControlStyleRules(s.stylesheet,e,n,function(e){return s.getStyleControlValue(e,t)},o,r)},getStyleControlValue:function(e,t){var n=t[e.name];if(e.selectors_dictionary&&(n=e.selectors_dictionary[n]||n),_.isNumber(n)||!_.isEmpty(n))return n},addStyleToDocument:function(){embroidery.$previewContents.find("head").append(this.elements.$stylesheetElement),this.elements.$stylesheetElement.text(this.stylesheet)},removeStyleFromDocument:function(){this.elements.$stylesheetElement.remove()},onInit:function(){o.prototype.onInit.apply(this,arguments),this.initStylesheet()}})).addControlStyleRules=function(e,t,n,i,o,r){var s=i(t);void 0!==s&&_.each(t.selectors,function(l,a){var c;try{c=l.replace(/{{(?:([^.}]+)\.)?([^}]*)}}/g,function(e,o,r){var l=t,a=s;if(o){if(!(l=_.findWhere(n,{name:o})))return"";a=i(l)}var c=embroidery.getControlView(l.type).getStyleValue(r.toLowerCase(),a);if(""===c)throw"";return c})}catch(e){return}if(!_.isEmpty(c)){var d=/^(?:\([^)]+\)){1,2}/,m=a.match(d),u={};if(m){m=m[0],a=a.replace(d,"");for(var h,p=/\(([^)]+)\)/g,g=[];h=p.exec(m);)g.push(h[1]);_.each(g,function(e){if("desktop"!==e){var t=e.replace(/\+$/,"");u[t===e?"max":"min"]=t}})}_.each(o,function(e,t){var n=e.source?e.source:e,i=new RegExp(n,"g");a=a.replace(i,r[t])}),!Object.keys(u).length&&t.responsive&&"desktop"===(u=_.pick(embroidery.helpers.cloneObject(t.responsive),["min","max"])).max&&delete u.max,e.addRules(a,c,u)}})},t.exports=i},{"embroidery-editor-utils/stylesheet":113,"embroidery-utils/view-module":124}],104:[function(e,t,n){t.exports=new function(){var e=this,t=[],n={},i={},o=function(t){var i=t.originalEvent,o=i.error;if(o){var r=!1,s=n.urlsToWatch;jQuery.each(s,function(){if(-1!==o.stack.indexOf(this))return r=!0,!1}),r&&e.addError({type:o.name,message:o.message,url:i.filename,line:i.lineno,column:i.colno})}};this.addURLToWatch=function(e){n.urlsToWatch.push(e)},this.addCustomError=function(e,t,n){var i={type:e.name,message:e.message,url:e.fileName||e.sourceURL,line:e.lineNumber||e.line,column:e.columnNumber||e.column,customFields:{category:t||"general",tag:n}};if(!i.url){var o=e.stack.match(/\n {4}at (.*?(?=:(\d+):(\d+)))/);o&&(i.url=o[1],i.line=o[2],i.column=o[3])}this.addError(i)},this.addError=function(n){var i={type:"Error",timestamp:Math.floor((new Date).getTime()/1e3),message:null,url:null,line:null,column:null,customFields:{}};t.push(jQuery.extend(!0,i,n)),e.sendErrors()},this.sendErrors=function(){i.$window.off("error",o),jQuery.ajax({url:EmbroideryConfig.ajaxurl,method:"POST",data:{action:"embroidery_debug_log",data:t},success:function(){t=[],i.$window.on("error",o)}})},n={debounceDelay:500,urlsToWatch:["embroidery/assets"]},i.$window=jQuery(window),i.$window.on("error",o),e.sendErrors=_.debounce(e.sendErrors,n.debounceDelay)}},{}],105:[function(e,t,n){var i;i={init:function(){var e;this.getModal=function(){return e||(e=this.initModal()),e},jQuery(document).on({"heartbeat-send":function(e,t){t.embroidery_post_lock={post_ID:embroidery.config.post_id}},"heartbeat-tick":function(e,t){t.locked_user?(embroidery.saver.isEditorChanged()&&embroidery.saver.saveEditor({status:"autosave"}),i.showLockMessage(t.locked_user)):i.getModal().hide(),embroidery.config.nonce=t.embroideryNonce},"heartbeat-tick.wp-refresh-nonces":function(e,t){var n=t["embroidery-refresh-nonces"];n&&(n.heartbeatNonce&&(embroidery.config.nonce=n.embroideryNonce),n.heartbeatNonce&&(window.heartbeatSettings.nonce=n.heartbeatNonce))}}),embroidery.config.locked_user&&i.showLockMessage(embroidery.config.locked_user)},initModal:function(){var e=embroidery.dialogsManager.createWidget("lightbox",{headerMessage:embroidery.translate("take_over")});return e.addButton({name:"go_back",text:embroidery.translate("go_back"),callback:function(){parent.history.go(-1)}}),e.addButton({name:"take_over",text:embroidery.translate("take_over"),callback:function(){wp.heartbeat.enqueue("embroidery_force_post_lock",!0),wp.heartbeat.connectNow()}}),e},showLockMessage:function(e){i.getModal().setMessage(embroidery.translate("dialog_user_taken_over",[e])).show()}},t.exports=i},{}],106:[function(e,t,n){var i;i={_enqueuedFonts:[],elementsHierarchy:{section:{column:{widget:null,section:null}}},enqueueFont:function(e){if(-1===this._enqueuedFonts.indexOf(e)){var t,n={ru_RU:"cyrillic",uk:"cyrillic",bg_BG:"cyrillic",vi:"vietnamese",el:"greek",he_IL:"hebrew"};switch(embroidery.config.controls.font.options[e]){case"googlefonts":t="https://fonts.googleapis.com/css?family="+e+":100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic",n[embroidery.config.locale]&&(t+="&subset="+n[embroidery.config.locale]);break;case"earlyaccess":t="https://fonts.googleapis.com/earlyaccess/"+e.replace(/\s+/g,"").toLowerCase()+".css"}_.isEmpty(t)||embroidery.$previewContents.find("link:last").after('<link href="'+t+'" rel="stylesheet" type="text/css">'),this._enqueuedFonts.push(e)}},getElementChildType:function(e,t){if(t||(t=this.elementsHierarchy),void 0!==t[e])return jQuery.isPlainObject(t[e])?Object.keys(t[e]):null;for(var n in t)if(t.hasOwnProperty(n)&&jQuery.isPlainObject(t[n])){var i=this.getElementChildType(e,t[n]);if(i)return i}return null},getUniqueID:function(){return Math.random().toString(16).substr(2,7)},stringReplaceAll:function(e,t){var n=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(n,function(e){return t[e]})},isActiveControl:function(e,t){var n,i;if(_.isFunction(e.get)?(n=e.get("condition"),i=e.get("conditions")):(n=e.condition,i=e.conditions),i)return embroidery.conditions.check(i,t);if(_.isEmpty(n))return!0;var o=_.filter(n,function(e,n){var i=n.match(/([a-z_0-9]+)(?:\[([a-z_]+)])?(!?)$/i),o=i[1],r=i[2],s=!!i[3],l=t[o];if(void 0===l)return!0;r&&(l=l[r]);var a;return a=_.isArray(e)&&!_.isEmpty(e)?_.contains(e,l):_.isArray(l)&&!_.isEmpty(l)?_.contains(l,e):_.isEqual(e,l),s?a:!a});return _.isEmpty(o)},cloneObject:function(e){return JSON.parse(JSON.stringify(e))},disableElementEvents:function(e){e.each(function(){var e=this.style.pointerEvents;"none"!==e&&jQuery(this).data("backup-pointer-events",e).css("pointer-events","none")})},enableElementEvents:function(e){e.each(function(){var e=jQuery(this),t=e.data("backup-pointer-events");void 0!==t&&e.removeData("backup-pointer-events").css("pointer-events",t)})},getColorPickerPaletteIndex:function(e){return["7","8","1","5","2","3","6","4"].indexOf(e)},wpColorPicker:function(e,t){var n=this,i=embroidery.schemes.getScheme("color-picker"),o=_.sortBy(i.items,function(e){return n.getColorPickerPaletteIndex(e.key)}),r={width:window.innerWidth>=1440?271:251,palettes:_.pluck(o,"value")};return t&&_.extend(r,t),e.wpColorPicker(r)},isInViewport:function(e,t){var n=e.getBoundingClientRect();return t=t||document.documentElement,n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||t.clientHeight)&&n.right<=(window.innerWidth||t.clientWidth)},scrollToView:function(e){setTimeout(function(){embroidery.$previewContents.find("html, body").animate({scrollTop:e.$el.offset().top-embroidery.$preview[0].contentWindow.innerHeight/2})},500)}},t.exports=i},{}],107:[function(e,t,n){var i;i=function(){var e=this,t={},n=[],i=function(e){var t,n=e.size;if("custom"===n){var i=e.dimension;if(!i.width&&!i.height)return"full";t="custom_"+i.width+"x"+i.height}else t=n;return t};e.onceTriggerChange=_.once(function(e){window.setTimeout(function(){e.get("settings").trigger("change",e.get("settings"))},700)}),e.getImageUrl=function(t){e.registerItem(t);var n=e.getItem(t);if(!n){if("custom"===t.size)return void(embroidery.getPanelView()&&"editor"===embroidery.getPanelView().currentPageName&&t.model&&e.onceTriggerChange(t.model));n=t.url}return n},e.getItem=function(e){var n=i(e),o=e.id;return!!n&&(!(!t[o]||!t[o][n])&&t[o][n])},e.registerItem=function(t){""!==t.id&&(e.getItem(t)||(n.push(t),e.debounceGetRemoteItems()))},e.getRemoteItems=function(){var e,o,r=[],s=Object.keys(n).length;if(0!==s){if(1===s){for(o in n){e=n[o];break}if(e&&e.model)return void e.model.renderRemoteServer()}for(o in n){e=n[o];var l=i(e),a=e.id,c=!t[a]||0===Object.keys(t[a]).length;r.push({id:a,size:l,is_first_time:c})}window.embroidery.ajax.send("get_images_details",{data:{items:r},success:function(e){var i,o;for(i in e){t[i]||(t[i]={});for(o in e[i])t[i][o]=e[i][o]}n=[]}})}},e.debounceGetRemoteItems=_.debounce(e.getRemoteItems,300)},t.exports=new i},{}],108:[function(e,t,n){!function(e){var t=function(e){try{return e.originalEvent.dataTransfer.setData("test","test"),e.originalEvent.dataTransfer.clearData("test"),!0}catch(e){return!1}},n={html5Draggable:function(n){var i=this,o={},r={},s={element:"",groups:null,onDragStart:null,onDragEnd:null},l=function(t){e.isFunction(o.onDragEnd)&&o.onDragEnd.call(r.$element,t,i)},a=function(n){var s={groups:o.groups||[]};t(n)&&n.originalEvent.dataTransfer.setData(JSON.stringify(s),!0),e.isFunction(o.onDragStart)&&o.onDragStart.call(r.$element,n,i)};this.destroy=function(){r.$element.off("dragstart",a),r.$element.removeAttr("draggable")},e.extend(!0,o,s,n),r.$element=e(o.element),r.$element.attr("draggable",!0),r.$element.on("dragstart",a).on("dragend",l)},html5Droppable:function(n){var i,o,r=this,s={},l={},a={element:"",items:">",horizontalSensitivity:"10%",axis:["vertical","horizontal"],placeholder:!0,currentElementClass:"html5dnd-current-element",placeholderClass:"html5dnd-placeholder",hasDraggingOnChildClass:"html5dnd-has-dragging-on-child",groups:null,isDroppingAllowed:null,onDragEnter:null,onDragging:null,onDropping:null,onDragLeave:null},c=function(){return-1!==s.axis.indexOf("vertical")},d=function(e,t){var n;return-1!==s.axis.indexOf("horizontal")&&(c()?!!(n=s.horizontalSensitivity.match(/\d+/))&&(n=n[0],/%$/.test(s.horizontalSensitivity)&&(n=t/n),e>t-n?"right":e<n&&"left"):e>t/2?"right":"left")},m=function(t){var n=e(i),r=n.outerHeight()-l.$placeholder.outerHeight(),s=n.outerWidth();if(t=t.originalEvent,!(o=d(t.offsetX,s)))if(c()){var a=i.getBoundingClientRect();o=t.clientY>a.top+r/2?"bottom":"top"}else o=null},u=function(){if(s.placeholder){var e="top"===o?"prependTo":"appendTo";l.$placeholder[e](i)}},h=function(n){var l,a,c;return!(s.groups&&t(n)&&(l=n.originalEvent.dataTransfer.types,c=!1,(l=Array.prototype.slice.apply(l)).forEach(function(e){try{if(!(a=JSON.parse(e)).groups.slice)return;s.groups.forEach(function(e){if(-1!==a.groups.indexOf(e))return c=!0,!1})}catch(e){}}),!c)||e.isFunction(s.isDroppingAllowed)&&!s.isDroppingAllowed.call(i,o,n,r))},p=function(t){t.stopPropagation(),i||(i=this,l.$element.parents().each(function(){var t=e(this).data("html5Droppable");t&&t.doDragLeave()}),m(t),h(t)&&(u(),l.$element.addClass(s.hasDraggingOnChildClass),e(i).addClass(s.currentElementClass),e.isFunction(s.onDragEnter)&&s.onDragEnter.call(i,o,t,r)))},g=function(t){t.stopPropagation(),i||p.call(this,t);var n=o;m(t),h(t)&&(t.preventDefault(),n!==o&&u(),e.isFunction(s.onDragging)&&s.onDragging.call(this,o,t,r))},f=function(t){var n=this.getBoundingClientRect();("dragleave"!==t.type||t.clientX<n.left||t.clientX>=n.right||t.clientY<n.top||t.clientY>=n.bottom)&&(e(i).removeClass(s.currentElementClass),r.doDragLeave())},v=function(t){m(t),h(t)&&(t.preventDefault(),e.isFunction(s.onDropping)&&s.onDropping.call(this,o,t,r))};this.doDragLeave=function(){s.placeholder&&l.$placeholder.remove(),l.$element.removeClass(s.hasDraggingOnChildClass),e.isFunction(s.onDragLeave)&&s.onDragLeave.call(i,event,r),i=o=null},this.destroy=function(){l.$element.off("dragenter",s.items,p).off("dragover",s.items,g).off("drop",s.items,v).off("dragleave drop",s.items,f)},e.extend(s,a,n),l.$element=e(s.element),l.$placeholder=e("<div>",{class:s.placeholderClass}),l.$element.on("dragenter",s.items,p).on("dragover",s.items,g).on("drop",s.items,v).on("dragleave drop",s.items,f)}};e.each(n,function(t,n){e.fn[t]=function(i){return i=i||{},this.each(function(){var o=e.data(this,t);o instanceof n?"destroy"===i&&(o.destroy(),e.removeData(this,t)):(i.element=this,e.data(this,t,new n(i)))}),this}})}(jQuery)},{}],109:[function(e,t,n){(i=jQuery).fn.embroiderySerializeObject=function(){var e=this.serializeArray(),t={},n=function(e,t,i){var o=/^[^\[\]]+\[]/.test(t),r=/^[^\[\]]+\[[^\[\]]+]/.test(t),s=t.replace(/\[.*/,"");if(o)e[s]||(e[s]=[]);else{if(!r)return void(e.push?e.push(i):e[s]=i);e[s]||(e[s]={})}var l=t.match(/\[[^\[\]]*]/g);return l[0]=l[0].replace(/\[|]/g,""),n(e[s],l.join(""),i)};return i.each(e,function(){n(t,this.name,this.value)}),t};var i},{}],110:[function(e,t,n){var i=e("embroidery-utils/module");t.exports=i.extend({initToast:function(){var e=embroidery.dialogsManager.createWidget("buttons",{id:"embroidery-toast",position:{my:"center bottom",at:"center bottom-10",of:"#embroidery-panel-content-wrapper",autoRefresh:!0},hide:{onClick:!0,auto:!0,autoDelay:1e4},effects:{show:function(){var t=e.getElements("widget");t.show(),e.refreshPosition();var n=parseInt(t.css("top"),10);t.hide().css("top",n+100),t.animate({opacity:"show",height:"show",paddingBottom:"show",paddingTop:"show",top:n},{easing:"linear",duration:300})},hide:function(){var t=e.getElements("widget"),n=parseInt(t.css("top"),10);t.animate({opacity:"hide",height:"hide",paddingBottom:"hide",paddingTop:"hide",top:n+100},{easing:"linear",duration:300})}},buttonTag:"div"});this.getToast=function(){return e}},showToast:function(e){var t=this.getToast();t.setMessage(e.message),t.getElements("buttonsWrapper").empty(),e.buttons&&e.buttons.forEach(function(e){t.addButton(e)}),t.show()},onInit:function(){this.initToast()}})},{"embroidery-utils/module":123}],111:[function(e,t,n){var i;i={getPresetsDictionary:function(){return{11:100/9,12:12.5,14:100/7,16:100/6,33:100/3,66:2/3*100,83:5/6*100}},getAbsolutePresetValues:function(e){var t=embroidery.helpers.cloneObject(e),n=this.getPresetsDictionary();return _.each(t,function(e,i){n[e]&&(t[i]=n[e])}),t},getPresets:function(e,t){var n=embroidery.helpers.cloneObject(embroidery.config.elements.section.presets);return e&&(n=n[e]),t&&(n=n[t]),n},getPresetByStructure:function(e){var t=this.getParsedStructure(e);return this.getPresets(t.columnsCount,t.presetIndex)},getParsedStructure:function(e){return{columnsCount:(e+="").slice(0,-1),presetIndex:e.substr(-1)}},getPresetSVG:function(e,t,n,i){t=t||100,n=n||50,i=i||2;var o=this.getAbsolutePresetValues(e),r=this._generatePresetSVGPath(o,t,n,i);return this._createSVGPreset(r,t,n)},_createSVGPreset:function(e,t,n){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),i.setAttribute("viewBox","0 0 "+t+" "+n);var o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",e),i.appendChild(o),i},_generatePresetSVGPath:function(e,t,n,i){for(var o=t-i*(e.length-1),r=0,s="",l=0;l<e.length;l++){l&&(s+=" ");var a=e[l]/100*o;s+="M"+ +(r+=a).toFixed(4)+",0",s+="V"+n,s+="H"+ +(r-a).toFixed(4),s+="V0Z",r+=i}return s}},t.exports=i},{}],112:[function(e,t,n){var i,o=e("embroidery-editor-utils/stylesheet"),r=e("embroidery-editor-utils/controls-css-parser");i=function(){var e=this,t=new o,n={},i=".embroidery-widget-",s={},l=function(n){var o=e.getWidgetSchemeControls(n);_.each(o,function(s){l=s,a=o,c=n.widget_type,r.addControlStyleRules(t,l,a,function(t){return e.getSchemeValue(t.scheme.type,t.scheme.value,t.scheme.key).value},["{{WRAPPER}}"],[i+c]);var l,a,c})};this.init=function(){return s.$style=jQuery("<style>",{id:"embroidery-style-scheme"}),s.$previewHead=embroidery.$previewContents.find("head"),s.$previewHead.append(s.$style),n=embroidery.helpers.cloneObject(embroidery.config.schemes.items),e},this.getWidgetSchemeControls=function(e){return _.filter(e.controls,function(e){return _.isObject(e.scheme)})},this.getSchemes=function(){return n},this.getEnabledSchemesTypes=function(){return embroidery.config.schemes.enabled_schemes},this.getScheme=function(e){return n[e]},this.getSchemeValue=function(t,n,i){if(this.getEnabledSchemesTypes().indexOf(t)<0)return!1;var o=e.getScheme(t).items[n];if(i&&_.isObject(o)){var r=embroidery.helpers.cloneObject(o);return r.value=o.value[i],r}return o},this.printSchemesStyle=function(){t.empty(),_.each(embroidery.config.widgets,function(e){l(e)}),s.$style.text(t)},this.resetSchemes=function(e){n[e]=embroidery.helpers.cloneObject(embroidery.config.schemes.items[e])},this.saveScheme=function(e){embroidery.config.schemes.items[e].items=embroidery.helpers.cloneObject(n[e].items);var t={};_.each(n[e].items,function(e,n){t[n]=e.value}),NProgress.start(),embroidery.ajax.send("apply_scheme",{data:{scheme_name:e,data:JSON.stringify(t)},success:function(){NProgress.done()}})},this.setSchemeValue=function(e,t,i){n[e].items[t].value=i}},t.exports=new i},{"embroidery-editor-utils/controls-css-parser":103,"embroidery-editor-utils/stylesheet":113}],113:[function(e,t,n){!function(e){var n=function(){var t=this,i={},o={},r={},s=function(e){var t={};return(e=e.split("-").filter(String)).forEach(function(e){var n=e.split("_"),i=n[0],o=n[1];t[i]="max"===i?function(e){var t=Object.keys(r),n=t.indexOf(e)+1;if(n>=t.length)throw new RangeError("Max value for this device is out of range.");return r[t[n]]-1}(o):r[o]}),t};this.addDevice=function(e,n){r[e]=n;var i=Object.keys(r);if(i.length<2)return t;i.sort(function(e,t){return r[e]-r[t]});var o={};return i.forEach(function(e){o[e]=r[e]}),r=o,t},this.addRawCSS=function(e,t){o[e]=t},this.addRules=function(n,o,r){var l="all";if(_.isEmpty(r)||(l=function(t){var n=[];return e.each(t,function(e){n.push(e+"_"+this)}),n.join("-")}(r)),i[l]||function(e){i[e]={};var t=Object.keys(i);if(!(t.length<2)){t.sort(function(e,t){if("all"===e)return-1;if("all"===t)return 1;var n=s(e);return s(t).max-n.max});var n={};t.forEach(function(e){n[e]=i[e]}),i=n}}(l),o){if(i[l][n]||(i[l][n]={}),"string"==typeof o){o=o.split(";").filter(String);var a={};try{e.each(o,function(){var e=this.split(/:(.*)?/);a[e[0].trim()]=e[1].trim().replace(";","")})}catch(e){return}o=a}return e.extend(i[l][n],o),t}var c=n.match(/[^{]+\{[^}]+}/g);e.each(c,function(){var e=this.match(/([^{]+)\{([^}]+)}/);e&&t.addRules(e[1].trim(),e[2].trim(),r)})},this.getRules=function(){return i},this.empty=function(){i={},o={}},this.toString=function(){var t="";return e.each(i,function(i){var o=n.parseRules(this);"all"!==i&&(o=function(t){var n=s(t),i=[];return e.each(n,function(e){i.push("("+e+"-width:"+this+"px)")}),"@media"+i.join(" and ")}(i)+"{"+o+"}"),t+=o}),e.each(o,function(){t+=this}),t}};n.parseRules=function(t){var i="";return e.each(t,function(e){var t=n.parseProperties(this);t&&(i+=e+"{"+t+"}")}),i},n.parseProperties=function(t){var n="";return e.each(t,function(e){this&&(n+=e+":"+this+";")}),n},t.exports=n}(jQuery)},{}],114:[function(e,t,n){var i;i=Marionette.ItemView.extend({template:Marionette.TemplateCache.get("#tmpl-embroidery-add-section"),attributes:{"data-view":"choose-action"},ui:{addNewSection:".embroidery-add-new-section",closeButton:".embroidery-add-section-close",addSectionButton:".embroidery-add-section-button",addTemplateButton:".embroidery-add-template-button",selectPreset:".embroidery-select-preset",presets:".embroidery-preset"},events:{"click @ui.addSectionButton":"onAddSectionButtonClick","click @ui.addTemplateButton":"onAddTemplateButtonClick","click @ui.closeButton":"onCloseButtonClick","click @ui.presets":"onPresetSelected"},className:function(){return"embroidery-add-section embroidery-visible-desktop"},addSection:function(e,t){return embroidery.sections.currentView.addSection(e,t)},setView:function(e){this.$el.attr("data-view",e)},showSelectPresets:function(){this.setView("select-preset")},closeSelectPresets:function(){this.setView("choose-action")},getTemplatesModalOptions:function(){return{onReady:function(){embroidery.templates.showTemplates()}}},onAddSectionButtonClick:function(){this.showSelectPresets()},onAddTemplateButtonClick:function(){embroidery.templates.startModal(this.getTemplatesModalOptions())},onRender:function(){this.$el.html5Droppable({axis:["vertical"],groups:["embroidery-element"],placeholder:!1,currentElementClass:"embroidery-html5dnd-current-element",hasDraggingOnChildClass:"embroidery-dragging-on-child",onDropping:this.onDropping.bind(this)})},onPresetSelected:function(e){this.closeSelectPresets();var t,n=e.currentTarget.dataset.structure,i=embroidery.presetsFactory.getParsedStructure(n),o=[];for(t=0;t<i.columnsCount;t++)o.push({id:embroidery.helpers.getUniqueID(),elType:"column",settings:{},elements:[]});embroidery.channels.data.trigger("element:before:add",{elType:"section"});this.addSection({elements:o}).setStructure(n),embroidery.channels.data.trigger("element:after:add")},onDropping:function(){embroidery.channels.data.trigger("section:before:drop"),this.addSection().addElementFromPanel(),embroidery.channels.data.trigger("section:after:drop")}}),t.exports=i},{}],115:[function(e,t,n){var i=e("embroidery-views/add-section/base");t.exports=i.extend({id:"embroidery-add-new-section",onCloseButtonClick:function(){this.closeSelectPresets()}})},{"embroidery-views/add-section/base":114}],116:[function(e,t,n){var i=e("embroidery-views/add-section/base");t.exports=i.extend({options:{atIndex:null},className:function(){return i.prototype.className.apply(this,arguments)+" embroidery-add-section-inline"},addSection:function(e,t){return(t=t||{}).at=this.getOption("atIndex"),i.prototype.addSection.call(this,e,t)},getTemplatesModalOptions:function(){return _.extend(i.prototype.getTemplatesModalOptions.apply(this,arguments),{importOptions:{at:this.getOption("atIndex")}})},fadeToDeath:function(){var e=this;e.$el.slideUp(function(){e.destroy()})},onCloseButtonClick:function(){this.fadeToDeath()},onPresetSelected:function(){i.prototype.onPresetSelected.apply(this,arguments),this.destroy()},onAddTemplateButtonClick:function(){i.prototype.onAddTemplateButtonClick.apply(this,arguments),this.destroy()},onDropping:function(){i.prototype.onDropping.apply(this,arguments),this.destroy()}})},{"embroidery-views/add-section/base":114}],117:[function(e,t,n){t.exports=Marionette.CompositeView.extend({templateHelpers:function(){return{view:this}},getBehavior:function(e){return this._behaviors[Object.keys(this.behaviors()).indexOf(e)]},addChildModel:function(e,t){return this.collection.add(e,t,!0)},addChildElement:function(e,t){t=t||{};var n=this.getChildType(),i=e.get?e.get("elType"):e.elType;if(-1===n.indexOf(i))return delete t.at,this.children.last().addChildElement(e,t);var o=this.addChildModel(e,t),r=this.children.findByModel(o);return r.edit(),r}})},{}],118:[function(e,t,n){var i,o=e("embroidery-elements/views/section");i=e("embroidery-views/base-container").extend({childView:o,behaviors:function(){var t={Sortable:{behaviorClass:e("embroidery-behaviors/sortable"),elChildType:"section"},HandleDuplicate:{behaviorClass:e("embroidery-behaviors/handle-duplicate")},HandleAddMode:{behaviorClass:e("embroidery-behaviors/duplicate")}};return embroidery.hooks.applyFilters("elements/base-section-container/behaviors",t,this)},getSortableOptions:function(){return{handle:"> .embroidery-element-overlay .embroidery-editor-section-settings .embroidery-editor-element-trigger",items:"> .embroidery-section"}},getChildType:function(){return["section"]},isCollectionFilled:function(){return!1},initialize:function(){this.listenTo(this.collection,"add remove reset",this.onCollectionChanged).listenTo(embroidery.channels.panelElements,"element:drag:start",this.onPanelElementDragStart).listenTo(embroidery.channels.panelElements,"element:drag:end",this.onPanelElementDragEnd)},addSection:function(e,t){var n={id:embroidery.helpers.getUniqueID(),elType:"section",settings:{},elements:[]};e&&_.extend(n,e);var i=this.addChildModel(n,t);return this.children.findByModelCid(i.cid)},onCollectionChanged:function(){embroidery.saver.setFlagEditorChange(!0)},onPanelElementDragStart:function(){embroidery.helpers.disableElementEvents(this.$el.find("iframe"))},onPanelElementDragEnd:function(){embroidery.helpers.enableElementEvents(this.$el.find("iframe"))}}),t.exports=i},{"embroidery-behaviors/duplicate":65,"embroidery-behaviors/handle-duplicate":66,"embroidery-behaviors/sortable":70,"embroidery-elements/views/section":73,"embroidery-views/base-container":117}],119:[function(e,t,n){var i;i=Marionette.CompositeView.extend({className:"embroidery-panel-controls-stack",classes:{popover:"embroidery-controls-popover"},activeTab:null,activeSection:null,templateHelpers:function(){return{elementData:embroidery.getElementData(this.model)}},ui:function(){return{tabs:".embroidery-panel-navigation-tab",reloadButton:".embroidery-update-preview-button"}},events:function(){return{"click @ui.tabs":"onClickTabControl","click @ui.reloadButton":"onReloadButtonClick"}},modelEvents:{destroy:"onModelDestroy"},behaviors:{HandleInnerTabs:{behaviorClass:e("embroidery-behaviors/inner-tabs")}},initialize:function(){this.listenTo(embroidery.channels.deviceMode,"change",this.onDeviceModeChange)},filter:function(e){if(e.get("tab")!==this.activeTab)return!1;if("section"===e.get("type"))return!0;var t=e.get("section");return!t||t===this.activeSection},isVisibleSectionControl:function(e){return this.activeTab===e.get("tab")},activateTab:function(e){var t=this;this.activeTab=e.data("tab");this.ui.tabs.removeClass("active"),e.addClass("active");var n=this.collection.filter(function(e){return"section"===e.get("type")&&t.isVisibleSectionControl(e)});n[0]&&this.activateSection(n[0].get("name"))},activateSection:function(e){this.activeSection=e},getChildView:function(e){var t=e.get("type");return embroidery.getControlView(t)},handlePopovers:function(){var e,t=this,n=!1;t.removePopovers(),t.children.each(function(i){n&&e.append(i.$el);var o=i.model.get("popover");o&&(o.start&&(n=!0,e=jQuery("<div>",{class:t.classes.popover}),i.$el.before(e),e.append(i.$el)),o.end&&(n=!1))})},removePopovers:function(){this.$el.find("."+this.classes.popover).remove()},openActiveSection:function(){var e=this.activeSection,t=this.children.filter(function(t){return e===t.model.get("name")});t[0]&&t[0].ui.heading.addClass("embroidery-open")},onRenderCollection:function(){this.openActiveSection(),this.handlePopovers()},onRenderTemplate:function(){this.activateTab(this.ui.tabs.eq(0))},onModelDestroy:function(){this.destroy()},onClickTabControl:function(e){e.preventDefault();var t=this.$(e.currentTarget);this.activeTab!==t.data("tab")&&(this.activateTab(t),this._renderChildren())},onReloadButtonClick:function(){embroidery.reloadPreview()},onDeviceModeChange:function(){this.$el.removeClass("embroidery-responsive-switchers-open")},onChildviewControlSectionClicked:function(e){var t=e.ui.heading.hasClass("embroidery-open");this.activateSection(t?null:e.model.get("name")),this._renderChildren()},onChildviewResponsiveSwitcherClick:function(e,t){"desktop"===t&&this.$el.toggleClass("embroidery-responsive-switchers-open")}}),t.exports=i},{"embroidery-behaviors/inner-tabs":68}],120:[function(e,t,n){var i,o=e("embroidery-views/base-sections-container"),r=e("embroidery-views/add-section/independent");i=o.extend({template:Marionette.TemplateCache.get("#tmpl-embroidery-preview"),className:"embroidery-inner",childViewContainer:".embroidery-section-wrap",onRender:function(){var e=new r;e.render(),this.$el.append(e.$el)}}),t.exports=i},{"embroidery-views/add-section/independent":115,"embroidery-views/base-sections-container":118}],121:[function(e,t,n){"use strict";t.exports=function(){var e,t=Array.prototype.slice,n={actions:{},filters:{}};function i(e,t,i,o){var r,s,l;if(n[e][t])if(i)if(r=n[e][t],o)for(l=r.length;l--;)(s=r[l]).callback===i&&s.context===o&&r.splice(l,1);else for(l=r.length;l--;)r[l].callback===i&&r.splice(l,1);else n[e][t]=[]}function o(e,t,i,o,r){var s={callback:i,priority:o,context:r},l=n[e][t];if(l){var a=!1;if(jQuery.each(l,function(){if(this.callback===i)return a=!0,!1}),a)return;l.push(s),l=function(e){for(var t,n,i,o=1,r=e.length;o<r;o++){for(t=e[o],n=o;(i=e[n-1])&&i.priority>t.priority;)e[n]=e[n-1],--n;e[n]=t}return e}(l)}else l=[s];n[e][t]=l}function r(e,t,i){var o,r,s=n[e][t];if(!s)return"filters"===e&&i[0];if(r=s.length,"filters"===e)for(o=0;o<r;o++)i[0]=s[o].callback.apply(s[o].context,i);else for(o=0;o<r;o++)s[o].callback.apply(s[o].context,i);return"filters"!==e||i[0]}return e={removeFilter:function(t,n){return"string"==typeof t&&i("filters",t,n),e},applyFilters:function(){var n=t.call(arguments),i=n.shift();return"string"==typeof i?r("filters",i,n):e},addFilter:function(t,n,i,r){return"string"==typeof t&&"function"==typeof n&&o("filters",t,n,i=parseInt(i||10,10),r),e},removeAction:function(t,n){return"string"==typeof t&&i("actions",t,n),e},doAction:function(){var n=t.call(arguments),i=n.shift();return"string"==typeof i&&r("actions",i,n),e},addAction:function(t,n,i,r){return"string"==typeof t&&"function"==typeof n&&o("actions",t,n,i=parseInt(i||10,10),r),e}}}},{}],122:[function(e,t,n){t.exports=new function(){var e=this.hotKeysHandlers={},t=function(t){var n=e[t.which];n&&jQuery.each(n,function(){this.isWorthHandling&&!this.isWorthHandling(t)||!this.allowAltKey&&t.altKey||(t.preventDefault(),this.handle(t))})};this.isControlEvent=function(e){return e[-1!==navigator.userAgent.indexOf("Mac OS X")?"metaKey":"ctrlKey"]},this.addHotKeyHandler=function(t,n,i){e[t]||(e[t]={}),e[t][n]=i},this.bindListener=function(e){e.on("keydown",t)}}},{}],123:[function(e,t,n){var i=function(){var e,t=jQuery,n=arguments,i=this,o={};this.getItems=function(e,t){if(t){var n=t.split("."),i=n.splice(0,1);if(!n.length)return e[i];if(!e[i])return;return this.getItems(e[i],n.join("."))}return e},this.getSettings=function(t){return this.getItems(e,t)},this.setSettings=function(n,o,r){if(r||(r=e),"object"==typeof n)return t.extend(r,n),i;var s=n.split("."),l=s.splice(0,1);return s.length?(r[l]||(r[l]={}),i.setSettings(s.join("."),o,r[l])):(r[l]=o,i)},this.forceMethodImplementation=function(e){var t=e.callee.name;throw new ReferenceError("The method "+t+" must to be implemented in the inheritor child.")},this.on=function(e,t){return o[e]||(o[e]=[]),o[e].push(t),i},this.off=function(e,t){if(!o[e])return i;if(!t)return delete o[e],i;var n=o[e].indexOf(t);return-1!==n&&delete o[e][n],i},this.trigger=function(e){var n="on"+e[0].toUpperCase()+e.slice(1),r=Array.prototype.slice.call(arguments,1);i[n]&&i[n].apply(i,r);var s=o[e];return s?(t.each(s,function(e,t){t.apply(i,r)}),i):i},i.__construct.apply(i,n),t.each(i,function(e){var t=i[e];"function"==typeof t&&(i[e]=function(){return t.apply(i,arguments)})}),function(){e=i.getDefaultSettings();var o=n[0];o&&t.extend(e,o)}(),i.trigger("init")};i.prototype.__construct=function(){},i.prototype.getDefaultSettings=function(){return{}},i.extendsCount=0,i.extend=function(e){var t=jQuery,n=this,o=function(){return n.apply(this,arguments)};t.extend(o,n),(o.prototype=Object.create(t.extend({},n.prototype,e))).constructor=o;var r=++i.extendsCount;return o.prototype.getConstructorID=function(){return r},o.__super__=n.prototype,o},t.exports=i},{}],124:[function(e,t,n){var i;i=e("./module").extend({elements:null,getDefaultElements:function(){return{}},bindEvents:function(){},onInit:function(){this.initElements(),this.bindEvents()},initElements:function(){this.elements=this.getDefaultElements()}}),t.exports=i},{"./module":123}],125:[function(e,t,n){t.exports=Marionette.Behavior.extend({listenerAttached:!1,onBeforeRender:function(){this.view.collection&&!this.listenerAttached&&(this.view.collection.on("update",this.saveCollectionHistory,this),this.listenerAttached=!0)},saveCollectionHistory:function(e,t){if(embroidery.history.history.getActive()){var n,i,o,r;t.add?(o=(i=t.changes.added)[0],r="add"):(o=(i=t.changes.removed)[0],r="remove");var s=embroidery.history.history.getModelLabel(o);if(s){var l=[];_.each(i,function(e){l.push(e.toJSON({copyHtmlCache:!0}))}),n={type:r,elementType:o.get("elType"),elementID:o.get("id"),title:s,history:{behavior:this,collection:e,event:t,models:l}},embroidery.history.history.addItem(n)}}},add:function(e,t,n){"section"===e[0].elType&&_.each(e,function(e){e.dontFillEmpty=!0}),t.addChildModel(e,{at:n,silent:0})},remove:function(e,t){t.remove(e,{silent:0})},restore:function(e,t){var n,i=e.get("type"),o=e.get("history"),r=!1;if(o.behavior.view.model){var s=o.behavior.view.model.get("id"),l=embroidery.history.history.findView(s);l&&(n=l.getBehavior("CollectionHistory"))}switch(n||(n=o.behavior),n.view.collection.off("update",n.saveCollectionHistory),i){case"add":t?this.add(o.models,n.view,o.event.index):this.remove(o.models,n.view.collection),r=!0;break;case"remove":t?this.remove(o.models,n.view.collection):this.add(o.models,n.view,o.event.index),r=!0}return n.view.collection.on("update",n.saveCollectionHistory,o.behavior),r}})},{}],126:[function(e,t,n){var i=e("./item");t.exports=Backbone.Collection.extend({model:i})},{"./item":129}],127:[function(e,t,n){t.exports=Marionette.Behavior.extend({oldValues:[],listenerAttached:!1,initialize:function(){this.lazySaveTextHistory=_.debounce(this.saveTextHistory.bind(this),800)},onBeforeRender:function(){this.listenerAttached||(this.listenTo(this.view.getEditModel().get("settings"),"change",this.saveHistory),this.listenerAttached=!0)},saveTextHistory:function(e,t,n){var i,o={},r=e.get(n.name);i=r instanceof Backbone.Collection?r.toJSON():r,o[n.name]={old:this.oldValues[n.name],new:i};var s={type:"change",elementType:"control",title:embroidery.history.history.getModelLabel(e),subTitle:e.controls[t[0]].label,history:{behavior:this,changed:o,model:this.view.getEditModel().toJSON()}};embroidery.history.history.addItem(s),delete this.oldValues[n.name]},saveHistory:function(e){if(embroidery.history.history.getActive()){var t=Object.keys(e.changed);if(t.length&&e.controls[t[0]]){if(1===t.length){var n=e.controls[t[0]];return _.isUndefined(this.oldValues[n.name])&&(this.oldValues[n.name]=e.previous(n.name)),void(embroidery.history.history.isItemStarted()?this.saveTextHistory(e,t,n):this.lazySaveTextHistory(e,t,n))}var i={};_.each(t,function(t){i[t]={old:e.previous(t),new:e.get(t)}});var o={type:"change",elementType:"control",title:embroidery.history.history.getModelLabel(e),history:{behavior:this,changed:i,model:this.view.getEditModel().toJSON()}};1===t.length&&(o.subTitle=e.controls[t[0]].label),embroidery.history.history.addItem(o)}}},restore:function(e,t){var n=e.get("history"),i=n.model.id,o=embroidery.history.history.findView(i);if(o){var r=(o.getEditModel?o.getEditModel():o.model).get("settings"),s=o.getBehavior("ElementHistory");s.stopListening(r,"change",this.saveHistory);var l={};_.each(n.changed,function(e,n){l[n]=t?e.new:e.old}),r.set(l),_.each(n.changed,function(e,t){r.trigger("change:external:"+t)}),e.set("status",t?"not_applied":"applied"),s.listenTo(r,"change",this.saveHistory)}}})},{}],128:[function(e,t,n){t.exports=Marionette.ItemView.extend({template:"#tmpl-embroidery-panel-history-no-items",id:"embroidery-panel-history-no-items",className:"embroidery-panel-nerd-box"})},{}],129:[function(e,t,n){t.exports=Backbone.Model.extend({defaults:{id:0,type:"",elementType:"",status:"not_applied",title:"",subTitle:"",action:"",history:{}},initialize:function(){this.set("items",new Backbone.Collection)}})},{}],130:[function(e,t,n){var i=e("./collection"),o=e("./item"),r=e("./element-behavior"),s=e("./collection-behavior");t.exports=new function(){var e=this,t=null,n=new i,l=!1,a=!0,c={add:embroidery.translate("added"),remove:embroidery.translate("removed"),change:embroidery.translate("edited"),move:embroidery.translate("moved"),duplicate:embroidery.translate("duplicated")},d=function(e){return e.ElementHistory={behaviorClass:r},e.CollectionHistory={behaviorClass:s},e},m=function(e){return e.CollectionHistory={behaviorClass:s},e},u=function(){embroidery.hotKeys.addHotKeyHandler(90,"historyNavigation",{isWorthHandling:function(e){return n.length&&!jQuery(e.target).is("input, textarea, [contenteditable=true]")},handle:function(t){!function(t){var i=n.find(function(e){return"not_applied"===e.get("status")}),o=n.indexOf(i),r=t?o-1:o+1;!t&&!i||r<0||r>=n.length||e.doItem(r)}(90===t.which&&t.shiftKey)}}),embroidery.hotKeys.addHotKeyHandler(72,"showHistoryPage",{isWorthHandling:function(e){return embroidery.hotKeys.isControlEvent(e)&&e.shiftKey},handle:function(){embroidery.getPanelView().setPage("historyPage")}})},h=function(){if(n.length>=2){var e=n.at(n.length-2);l="not_applied"===e.get("status")}};this.setActive=function(e){a=e},this.getActive=function(){return a},this.getItems=function(){return n},this.startItem=function(e){t=this.addItem(e)},this.endItem=function(){t=null},this.isItemStarted=function(){return null!==t},this.addItem=function(i){if(this.getActive()){for(n.length||n.add({status:"not_applied",title:embroidery.translate("editing_started"),subTitle:"",action:"",editing_started:!0});n.length&&"applied"===n.first().get("status");)n.shift();var r=t||(new Date).getTime(),s=n.findWhere({id:r});s||(s=new o({id:r,title:i.title,subTitle:i.subTitle,action:(l=i,c[l.type]?c[l.type]:l.type),type:i.type,elementType:i.elementType}),e.startItemTitle="",e.startItemAction="");var l,a=0;"column"===i.elementType&&"remove"===i.type&&"column"===s.get("elementType")&&(a=1),s.get("items").add(i,{at:a}),n.add(s,{at:0});var d=embroidery.getPanelView();return"historyPage"===d.getCurrentPageName()&&d.getCurrentPageView().render(),r}},this.doItem=function(t){this.setActive(!1);var i=n.at(t);"not_applied"===i.get("status")?this.undoItem(t):this.redoItem(t),this.setActive(!0);var o,r=embroidery.getPanelView(),s=r.getCurrentPageView();if("editor"===r.getCurrentPageName())s.getOption("editedElementView").isDestroyed?r.setPage("historyPage"):o=s.getOption("editedElementView");else if("historyPage"===r.getCurrentPageName()&&s.render(),i instanceof Backbone.Model&&i.get("items").length){var a=i.get("items").first().get("history").behavior.view;a.model&&(o=e.findView(a.model.get("id")))}o&&!embroidery.helpers.isInViewport(o.$el[0],embroidery.$previewContents.find("html")[0])&&embroidery.helpers.scrollToView(o),i.get("editing_started")&&(l||embroidery.saver.setFlagEditorChange(!1))},this.undoItem=function(e){for(var t,i=0;i<e;i++)"not_applied"===(t=n.at(i)).get("status")&&(t.get("items").each(function(e){var t=e.get("history");t&&t.behavior.restore(e)}),t.set("status","applied"))},this.redoItem=function(e){for(var t=n.length-1;t>=e;t--){var i=n.at(t);if("applied"===i.get("status")){var o=_.toArray(i.get("items").models).reverse();_(o).each(function(e){var t=e.get("history");t&&t.behavior.restore(e,!0)}),i.set("status","not_applied")}}},this.getModelLabel=function(e){return e instanceof Backbone.Model||(e=new Backbone.Model(e)),embroidery.getElementData(e).title},this.findView=function(e,t){var n=this,i=!1;return t||(t=embroidery.sections.currentView.children),_.each(t._views,function(t){if(!i){var o=t.getEditModel?t.getEditModel():t.model;e===o.get("id")?i=t:t.children&&t.children.length&&(i=n.findView(e,t.children))}}),i},this.startMovingItem=function(t){embroidery.history.history.startItem({type:"move",title:e.getModelLabel(t),elementType:t.get("elType")})},this.startInsertTemplate=function(e){embroidery.history.history.startItem({type:"add",title:embroidery.translate("template"),subTitle:e.get("title"),elementType:"template"})},this.startDropElement=function(){var t=embroidery.channels.panelElements.request("element:selected");embroidery.history.history.startItem({type:"add",title:e.getModelLabel(t.model),elementType:t.model.get("widgetType")||t.model.get("elType")})},this.startAddElement=function(t){embroidery.history.history.startItem({type:"add",title:e.getModelLabel(t),elementType:t.elType})},this.startDuplicateElement=function(t){embroidery.history.history.startItem({type:"duplicate",title:e.getModelLabel(t),elementType:t.get("elType")})},this.startRemoveElement=function(t){embroidery.history.history.startItem({type:"remove",title:e.getModelLabel(t),elementType:t.get("elType")})},u(),embroidery.hooks.addFilter("elements/base/behaviors",d),embroidery.hooks.addFilter("elements/base-section-container/behaviors",m),embroidery.channels.data.on("drag:before:update",e.startMovingItem).on("drag:after:update",e.endItem).on("element:before:add",e.startAddElement).on("element:after:add",e.endItem).on("element:before:remove",e.startRemoveElement).on("element:after:remove",e.endItem).on("element:before:duplicate",e.startDuplicateElement).on("element:after:duplicate",e.endItem).on("section:before:drop",e.startDropElement).on("section:after:drop",e.endItem).on("template:before:insert",e.startInsertTemplate).on("template:after:insert",e.endItem),embroidery.channels.editor.on("saved",h)}},{"./collection":126,"./collection-behavior":125,"./element-behavior":127,"./item":129}],131:[function(e,t,n){t.exports=Marionette.CompositeView.extend({id:"embroidery-panel-history",template:"#tmpl-embroidery-panel-history-tab",childView:Marionette.ItemView.extend({template:"#tmpl-embroidery-panel-history-item",ui:{item:".embroidery-history-item"},triggers:{"click @ui.item":"item:click"}}),childViewContainer:"#embroidery-history-list",currentItem:null,onRender:function(){var e=this;_.defer(function(){if(e.children.length){var t=e.collection.find(function(e){return"not_applied"===e.get("status")}),n=e.children.findByModel(t);e.updateCurrentItem(n.$el)}})},updateCurrentItem:function(e){var t="embroidery-history-item-current";this.currentItem&&this.currentItem.removeClass(t),this.currentItem=e,this.currentItem.addClass(t)},onChildviewItemClick:function(e,t){if(e.$el!==this.currentItem){var n=t.model.collection.findIndex(t.model);embroidery.history.history.doItem(n),this.updateCurrentItem(e.$el),this.isDestroyed||this.render()}}})},{}],132:[function(e,t,n){var i,o=e("./panel-page");i=function(){var t=this,n=function(){embroidery.getPanelView().addPage("historyPage",{view:o,title:embroidery.translate("history")})};jQuery(window).on("embroidery:init",function(){embroidery.on("preview:loaded",n),t.history=e("./history/manager"),t.revisions=e("./revisions/manager"),t.revisions.init()})},t.exports=new i},{"./history/manager":130,"./panel-page":133,"./revisions/manager":136}],133:[function(e,t,n){var i=e("./history/panel-tab"),o=e("./history/empty"),r=e("./revisions/panel-tab"),s=e("./revisions/empty");t.exports=Marionette.LayoutView.extend({template:"#tmpl-embroidery-panel-history-page",regions:{content:"#embroidery-panel-history-content"},ui:{tabs:".embroidery-panel-navigation-tab"},events:{"click @ui.tabs":"onTabClick"},regionViews:{},currentTab:null,initialize:function(){this.initRegionViews()},initRegionViews:function(){var e=embroidery.history.history.getItems(),t=embroidery.history.revisions.getItems();this.regionViews={history:{region:this.content,view:function(){return e.length?i:o},options:{collection:e}},revisions:{region:this.content,view:function(){return t.length?r:s},options:{collection:t}}}},activateTab:function(e){this.ui.tabs.removeClass("active").filter('[data-view="'+e+'"]').addClass("active"),this.showView(e)},getCurrentTab:function(){return this.currentTab},showView:function(e){var t=this.regionViews[e],n=t.options||{},i=t.view;"function"==typeof i&&(i=t.view()),n.viewName=e,this.currentTab=new i(n),t.region.show(this.currentTab)},onRender:function(){this.showView("history")},onTabClick:function(e){this.activateTab(e.currentTarget.dataset.view)},onDestroy:function(){embroidery.getPanelView().getFooterView().ui.history.removeClass("embroidery-open")}})},{"./history/empty":128,"./history/panel-tab":131,"./revisions/empty":135,"./revisions/panel-tab":138}],134:[function(e,t,n){var i=e("./model");t.exports=Backbone.Collection.extend({model:i,comparator:function(e){return-e.get("timestamp")}})},{"./model":137}],135:[function(e,t,n){t.exports=Marionette.ItemView.extend({template:"#tmpl-embroidery-panel-revisions-no-revisions",id:"embroidery-panel-revisions-no-revisions",className:"embroidery-panel-nerd-box"})},{}],136:[function(e,t,n){var i,o=e("./collection");i=function(){var e,t=this;this.getItems=function(){return e};var n=function(n){if(n.latest_revisions&&t.addRevisions(n.latest_revisions),n.revisions_ids){var i=e.filter(function(e){return-1!==n.revisions_ids.indexOf(e.get("id"))});e.reset(i)}};this.setEditorData=function(e){embroidery.getRegion("sections").currentView.collection.reset(e)},this.getRevisionDataAsync=function(e,t){return _.extend(t,{data:{id:e}}),embroidery.ajax.send("get_revision_data",t)},this.addRevisions=function(t){t.forEach(function(t){var n=e.findWhere({id:t.id});n&&e.remove(n),e.add(t)})},this.deleteRevision=function(t,n){var i={data:{id:t.get("id")},success:function(){if(n.success&&n.success(),t.destroy(),!e.length){var i=embroidery.getPanelView();"historyPage"===i.getCurrentPageName()&&i.getCurrentPageView().activateTab("revisions")}}};n.error&&(i.error=n.error),embroidery.ajax.send("delete_revision",i)},this.init=function(){e=new o(embroidery.config.revisions),embroidery.channels.editor.on("saved",n),function(){var e={isWorthHandling:function(){var e=embroidery.getPanelView();if("historyPage"!==e.getCurrentPageName())return!1;var t=e.getCurrentPageView().getCurrentTab();return t.currentPreviewId&&t.currentPreviewItem&&t.children.length>1},handle:function(e){embroidery.getPanelView().getCurrentPageView().getCurrentTab().navigate(38===e.which)}};embroidery.hotKeys.addHotKeyHandler(38,"revisionNavigation",e),embroidery.hotKeys.addHotKeyHandler(40,"revisionNavigation",e)}()}},t.exports=new i},{"./collection":134}],137:[function(e,t,n){var i;(i=Backbone.Model.extend()).prototype.sync=function(){return null},t.exports=i},{}],138:[function(e,t,n){t.exports=Marionette.CompositeView.extend({id:"embroidery-panel-revisions",template:"#tmpl-embroidery-panel-revisions",childView:e("./view"),childViewContainer:"#embroidery-revisions-list",ui:{discard:".embroidery-panel-scheme-discard .embroidery-button",apply:".embroidery-panel-scheme-save .embroidery-button"},events:{"click @ui.discard":"onDiscardClick","click @ui.apply":"onApplyClick"},isRevisionApplied:!1,jqueryXhr:null,currentPreviewId:null,currentPreviewItem:null,initialize:function(){this.listenTo(embroidery.channels.editor,"saved",this.onEditorSaved),this.currentPreviewId=embroidery.config.current_revision_id},getRevisionViewData:function(e){var t=this;this.jqueryXhr=embroidery.history.revisions.getRevisionDataAsync(e.model.get("id"),{success:function(n){embroidery.history.revisions.setEditorData(n),t.setRevisionsButtonsActive(!0),t.jqueryXhr=null,e.$el.removeClass("embroidery-revision-item-loading"),t.enterReviewMode()},error:function(){e.$el.removeClass("embroidery-revision-item-loading"),"abort"!==t.jqueryXhr.statusText&&(t.currentPreviewItem=null,t.currentPreviewId=null,alert("An error occurred"))}})},setRevisionsButtonsActive:function(e){this.ui.apply.add(this.ui.discard).prop("disabled",!e)},deleteRevision:function(e){var t=this;e.$el.addClass("embroidery-revision-item-loading"),embroidery.history.revisions.deleteRevision(e.model,{success:function(){e.model.get("id")===t.currentPreviewId&&t.onDiscardClick(),t.currentPreviewId=null},error:function(t){e.$el.removeClass("embroidery-revision-item-loading"),alert("An error occurred")}})},enterReviewMode:function(){embroidery.changeEditMode("review")},exitReviewMode:function(){embroidery.changeEditMode("edit")},navigate:function(e){var t=this.collection.indexOf(this.currentPreviewItem.model),n=e?t-1:t+1;n<0&&(n=this.collection.length-1),n>=this.collection.length&&(n=0),this.children.findByIndex(n).ui.detailsArea.trigger("click")},onEditorSaved:function(){this.exitReviewMode(),this.setRevisionsButtonsActive(!1),this.currentPreviewId=embroidery.config.current_revision_id},onApplyClick:function(){embroidery.saver.setFlagEditorChange(!0),embroidery.saver.saveAutoSave(),this.isRevisionApplied=!0,this.currentPreviewId=null},onDiscardClick:function(){embroidery.history.revisions.setEditorData(embroidery.config.data),embroidery.saver.setFlagEditorChange(this.isRevisionApplied),this.isRevisionApplied=!1,this.setRevisionsButtonsActive(!1),this.currentPreviewId=null,this.exitReviewMode(),this.currentPreviewItem&&this.currentPreviewItem.$el.removeClass("embroidery-revision-current-preview")},onDestroy:function(){this.currentPreviewId&&this.currentPreviewId!==embroidery.config.current_revision_id&&this.onDiscardClick()},onRenderCollection:function(){if(this.currentPreviewId){var e=this.collection.findWhere({id:this.currentPreviewId});e&&(this.currentPreviewItem=this.children.findByModelCid(e.cid),this.currentPreviewItem.$el.addClass("embroidery-revision-current-preview"))}},onChildviewDetailsAreaClick:function(e){var t=this,n=e.model.get("id");n!==t.currentPreviewId&&(this.jqueryXhr&&this.jqueryXhr.abort(),t.currentPreviewItem&&t.currentPreviewItem.$el.removeClass("embroidery-revision-current-preview"),e.$el.addClass("embroidery-revision-current-preview embroidery-revision-item-loading"),embroidery.saver.isEditorChanged()&&null===t.currentPreviewId?embroidery.saver.saveEditor({status:"autosave",onSuccess:function(){t.getRevisionViewData(e)}}):t.getRevisionViewData(e),t.currentPreviewItem=e,t.currentPreviewId=n)},onChildviewDeleteClick:function(e){var t=this,n=e.model.get("type");e.model.get("id");embroidery.dialogsManager.createWidget("confirm",{message:embroidery.translate("dialog_confirm_delete",[n]),headerMessage:embroidery.translate("delete_element",[n]),strings:{confirm:embroidery.translate("delete"),cancel:embroidery.translate("cancel")},defaultOption:"confirm",onConfirm:function(){t.deleteRevision(e)}}).show()}})},{"./view":139}],139:[function(e,t,n){t.exports=Marionette.ItemView.extend({template:"#tmpl-embroidery-panel-revisions-revision-item",className:"embroidery-revision-item",ui:{detailsArea:".embroidery-revision-item__details",deleteButton:".embroidery-revision-item__tools-delete"},triggers:{"click @ui.detailsArea":"detailsArea:click","click @ui.deleteButton":"delete:click"}})},{}]},{},[108,109,59]);